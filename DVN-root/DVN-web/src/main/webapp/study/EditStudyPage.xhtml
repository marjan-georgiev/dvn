<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:jsp="http://java.sun.com/JSP/Page"
      xmlns:o="http://omnifaces.org/ui"
      xmlns:ice="http://www.icesoft.com/icefaces/component">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
</head>
<body>
  <ui:composition template="/template.xhtml">
    <ui:param name="pageTitle" value="#{bundlePageInfo.editStudyTitle} - #{VDCRequest.dataversePageTitle}"/>
    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="studyId" value="#{EditStudyPage.studyId}"/>
            <f:viewParam name="studyListingIndex" value="#{VDCRequest.studyListingIndex}"/>        
            <f:event type="preRenderView" listener="#{EditStudyPage.preRenderView}" />
        </f:metadata>  
    </ui:define>    
    <ui:define name="body">
      <f:loadBundle basename="EditStudyBundle" var="editstudybundle"/>
      <script type="text/javascript">
          // <![CDATA[
          // Functions for hiding and showing study fields
          function addLoadEvent(func) {
              var oldonload = window.onload;
              if (typeof window.onload != 'function') {
                  window.onload = func;
              } else {
                  window.onload = function() {
                      if (oldonload) {
                          oldonload();
                      }
                      func();
                  }
              }
          }
          // functions to work with category selection
          // note a few assumptions that these functions have:
          // the id of the dropdown (including parent nodes); the partial id of the checkboxes;
          // and that the checkbox is two elements before the text field (there is empty text
          // in between, created by the div)
          function updateCategory( checkbox ) {
              if (checkbox.checked) {
                  textField = document.getElementById(checkbox.id).nextSibling;
                  dropdown = document.getElementById("studyForm:fileDataTableWrapper:0:fileDataTable:catDropdown");
                  textField.value = dropdown.value;
              }
          }
          function deselectCategory( textField ) {
              checkbox = document.getElementById(textField.id).previousSibling;
              checkbox.checked = false;
          }
          function updateAllCheckedCategories( dropdown ) {
              checkboxes=document.getElementsByTagName("input");
              for(i=0; i < checkboxes.length; i++) {
                  if (checkboxes[i].id.indexOf("catCheckbox") != -1 && checkboxes[i].checked == true) {
                      textField = checkboxes[i].nextSibling;
                      textField.value = dropdown.value;
                  }
              }
          }
          /** commenting out this code pending
           * input from alpha testing re: validation
           * required or no
           * To activate uncomment the function
           * below and uncomment the related div
           * just below the author name. See below.
           * @author Wendy Bossons
           */
          function validateNameFormat(obj) {
              if (obj.value.length == 0) {
                  return;
              } else {
                  var regexp = /[^\s^]/i;
                  var helpObj = eval("document.getElementById('input_authorNameHelp')");
                  if (regexp.test(obj.value))
                      helpObj.style.display = 'block';
              }
          }
          // ]]>
      </script>
      
      <ice:form id="studyForm">
        <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
        <input type="hidden" name="pageName" value="EditStudyPage"/>
        <ice:inputHidden id="studyId" value="#{EditStudyPage.studyId}"/>

 <div class="dvn_section">
        <div class="dvnstudytitleblock dvn_padBot">
            <div class="dvnstudyadminboxfloat">
                <div jsfc="ice:panelGroup" id="groupPanel10" styleClass="vdcTextRight dvnFormMargin">
                    <ice:commandButton binding="#{EditStudyPage.saveCommand1}" id="saveCommand1" value="Save" tabindex="999996" actionListener="#{EditStudyPage.openPopup}"/>
                    <ice:commandButton id="button2" value="Cancel" tabindex="999997" immediate="true" action="#{EditStudyPage.cancel}"/>
                </div>
            </div>
            <div class="dvnstudytitlefloat">
                <ice:outputText styleClass="dvnstudytitle" value="#{EditStudyPage.currentTitle}" rendered="#{EditStudyPage.study.id != null}"/>
                <div jsfc="ice:panelGroup" styleClass="dvnstudyversioninfo" rendered="#{EditStudyPage.study.id != null}">
                    <ice:outputText value="#{EditStudyPage.study.globalId}"/> <ice:outputText value="#{EditStudyPage.metadata.UNF}" rendered="#{!empty EditStudyPage.metadata.UNF}"/>
                </div>
                <div jsfc="ice:panelGroup" styleClass="dvnstudystatusbox #{EditStudyPage.metadata.studyVersion.inReview ? 'dvnstudystatusreview' : '' or EditStudyPage.metadata.studyVersion.draft ? 'dvnstudystatusdraft' : ''}">
                  <ice:outputText styleClass="dvnstudystatuslabel" value="In Review " rendered="#{EditStudyPage.metadata.studyVersion.inReview}"/>
                  <ice:outputText styleClass="dvnstudystatuslabel" value="Draft " rendered="#{EditStudyPage.metadata.studyVersion.draft}"/>
                  <ice:outputText value="Study Version: #{EditStudyPage.metadata.studyVersion.versionNumber}"/>
                  <ice:outputText nospan="true"><br/></ice:outputText>
                  <ice:outputText value="Created: #{EditStudyPage.metadata.studyVersion.createTime} - Last Updated: #{EditStudyPage.metadata.studyVersion.lastUpdateTime}" rendered="#{!empty EditStudyPage.metadata.studyVersion.lastUpdateTime}"/>
                  <ice:outputText value="Created: &lt;i&gt;Draft study version is not created until the form is saved&lt;/i&gt;" rendered="#{null == EditStudyPage.metadata.studyVersion.lastUpdateTime}" escape="false"/>
                  <ice:outputText nospan="true" rendered="#{!empty EditStudyPage.metadata.studyVersion.versionNote}"><br/></ice:outputText>
                  <ice:outputText value="Study Version Notes: " rendered="#{!empty EditStudyPage.metadata.studyVersion.versionNote}"/>
                  <ice:outputText styleClass="dvnstudystatusversionnote" value="#{EditStudyPage.metadata.studyVersion.versionNote}" rendered="#{!empty EditStudyPage.metadata.studyVersion.versionNote}"/>
                </div>
            </div>
        </div>
     
          <div class="dvn_sectionBox">
            <div id="vdcStudyTemplateBlock" class="vdcStudyTemplateFormTable">
              <div jsfc="ice:panelGroup" styleClass="dvnInformationMessage">
                <div class="dvnMsgBlockContainer">
                  <ice:outputText styleClass="dvnEditStudyHelp" value="#{bundlePageInfo.editStudyCatalogingHelp}" escape="false"/>
                </div>
              </div>
              <!-- validation errors occurred? -->

              <div jsfc="ice:panelGroup" id="messagePanel" styleClass="errorMessage" rendered="#{!empty facesContext.maximumSeverity}">
                <ice:outputText value='Please check messages below.'/>
              </div>
                  <ice:panelGroup panelLayout="flow">
                    <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%">
                      <div jsfc="ice:panelGroup" id="groupPanel9b">
                        <div jsfc="ice:panelGroup" styleClass="dvn_padBot" rendered="#{EditStudyPage.showTemplateList}">
                            <ice:outputText value="Select Study Template: "/>
                            <ice:selectOneMenu value="#{EditStudyPage.selectTemplateId}" binding="#{EditStudyPage.selectTemplate}" onchange="getElementById('studyForm:templateButton').click();">
                                <f:selectItems value="#{EditStudyPage.templatesMap}"/>
                            </ice:selectOneMenu>
                            <!-- hidden button that is clicked by select menu's onchange action -->
                            <ice:commandButton id="templateButton"  visible="false" value="Change" action="#{EditStudyPage.changeTemplateAction}"/>
                        </div>
                        <div jsfc="ice:panelGroup" styleClass="dvn_padBot" rendered="#{!EditStudyPage.showTemplateList}">
                            <ice:outputText value="Study Template: #{EditStudyPage.study.template.name}"/>
                        </div>
                        <div class="dvnEditStudyShowAllFieldsBlock">
                            <ice:selectOneRadio partialSubmit="true" immediate="true" tabindex="999998" value="#{EditStudyPage.showAll}">
                                <f:selectItem itemLabel="Show Required and Recommended Fields" itemValue="false"/>
                                <f:selectItem itemLabel="Show All Fields" itemValue="true"/>
                            </ice:selectOneRadio>
                        </div>
                      </div>
                    </ice:panelGrid>

                  <!-- Data Citation -->
                  <ice:panelGrid cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable">
                    <ice:column>
                      <ice:panelGrid cellpadding="0" cellspacing="0" width="100%" columns="2"
                                     styleClass="vdcEditStudyInnerTable" columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.dataCitationLabel}" title="#{editstudybundle.dataCitationHelpHeading} - #{editstudybundle.dataCitationHelp}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <p>
                            <ice:graphicImage value="/resources/images/icon_information.18.png" styleClass="dvn_icon"/>
                            <ice:outputText styleClass="vdcHelpText" value=" Use the Data Citation Widget below to enter all the metadata needed for your citation."/>
                          </p>
                          <div jsfc="ice:panelGroup" id="dvnDataCitationWidget" styleClass="dvnDataCitationWidget vdcEditStudyFieldFloatWrap">
                            <div>
                                Data Citation Widget
                            </div>
                            
                            <div>
                                
                                <div id="dvnDataCitationWidgetInputBlock">
                                  <!-- None -->
                                  <div class="dvnDataCitationWidgetInput">Click the links below to enter the data citation value metadata.</div>
                                  <!-- Author -->
                                  <div id="dvnDataCitationWidgetAuthorInputBlock" class="dvnDataCitationWidgetInput">
                                      <div class="dvnDataCitationWidgetAuthorInputBoba">
                                        <div class="authorFormBlock">
                                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="Author #{editstudybundle.authorNameLabel}" title="#{editstudybundle.authorNameHelpHeading} - #{editstudybundle.authorNameHelp}"/>
                                            <ice:inputText styleClass="input_authorNameSync"
                                                        size="45"
                                                        maxlength="255" />
                                            <ice:outputText styleClass="vdcEditStudyFormatExample" value="(LastName, FirstName)"/>
                                        </div>
                                        <div class="authorbuttonBlock">
                                            <ice:graphicImage id="add_authorbuttonInputSync" value="/resources/images/icon_add.gif" />
                                            <ice:graphicImage id="remove_authorbuttonInputSync" rendered="#{EditStudyPage.dataTableAuthors.rowCount gt 1}" value="/resources/images/icon_remove.gif" />
                                        </div>
                                      </div>
                                      <div class="dvnDataCitationWidgetAuthorSelectBoba">
                                        <div class="authorFormBlock">
                                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="Author #{editstudybundle.authorNameLabel}" title="#{editstudybundle.authorNameHelpHeading} - #{editstudybundle.authorNameHelp}"/>
                                            <ice:selectOneMenu immediate="false" 
                                                styleClass="select_authorNameSync">
                                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.authorName].templateField.controlledVocabulary.selectItems}"/>
                                            </ice:selectOneMenu>
                                            <ice:outputText styleClass="vdcEditStudyFormatExample" value="(LastName, FirstName)"/>
                                        </div>
                                        <div class="authorbuttonBlock">
                                            <ice:graphicImage id="add_authorbuttonSelectSync" value="/resources/images/icon_add.gif" />
                                            <ice:graphicImage id="remove_authorbuttonSelectSync" rendered="#{EditStudyPage.dataTableAuthors.rowCount gt 1}" value="/resources/images/icon_remove.gif" />
                                        </div>
                                      </div>
                                  </div>
                                  <!-- Date -->
                                  <div id="dvnDataCitationWidgetDateInputBlock" class="dvnDataCitationWidgetInput">
                                      <p>
                                        <ice:graphicImage value="/resources/images/icon_information.18.png" styleClass="dvn_icon"/>
                                        <ice:outputText styleClass="vdcHelpText" value=" In the data citation, the Distribution Date supersedes the Production Date."/>
                                      </p>
                                      <div>
                                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributionDateLabel}" title="#{editstudybundle.distributionDateHelpHeading} - #{editstudybundle.distributionDateHelp}"/>
                                        <ice:inputText id="input_distributionDateSync" styleClass="formDateFormat"/>
                                        <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                                      </div>
                                      <div>
                                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.productionDateLabel}" title="#{editstudybundle.productionDateHelpHeading} - #{editstudybundle.productionDateHelp}"/>
                                        <ice:inputText id="input_productionDateSync" styleClass="formDateFormat"/>
                                        <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                                      </div>
                                  </div>
                                  <!-- Title -->
                                  <div id="dvnDataCitationWidgetTitleInputBlock" class="dvnDataCitationWidgetInput">
                                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.titleLabel}" title="#{editstudybundle.titleHelpHeading} - #{editstudybundle.titleHelp}"/>
                                      <ice:inputText id="input_titleSync" size="90"/>
                                  </div>
                                  <!-- Study ID -->
                                  <div id="dvnDataCitationWidgetStudyIDInputBlock" class="dvnDataCitationWidgetInput">
                                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.studyidLabel}" title="#{editstudybundle.studyidHelpHeading} - #{editstudybundle.studyidHelp}"/><br/>
                                        <ice:outputText id="input_studyIdPrfxSync" value="#{EditStudyPage.study.protocol}:#{EditStudyPage.study.authority}/"/>
                                        <ice:inputText maxlength="255" id="input_studyIdSync"/>
                                  </div>
                                  <!-- Distributor -->
                                  <div id="dvnDataCitationWidgetDistributorInputBlock" class="dvnDataCitationWidgetInput">
                                      <div class="dvnDataCitationWidgetDistributorInputBoba">
                                        <div class="distributorFormBlock">
                                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorLabel}" title="#{editstudybundle.distributorHelpHeading} - #{editstudybundle.distributorHelp}"/>
                                            <ice:inputText styleClass="input_distributorNameSync"
                                                        size="45"
                                                        maxlength="255" />
                                        </div>
                                        <div class="distributorbuttonBlock">
                                            <ice:graphicImage id="add_distributorbuttonInputSync" value="/resources/images/icon_add.gif" />
                                            <ice:graphicImage id="remove_distributorbuttonInputSync" rendered="#{EditStudyPage.dataTableDistributors.rowCount gt 1}" value="/resources/images/icon_remove.gif" />
                                        </div>
                                      </div>
                                      <div class="dvnDataCitationWidgetDistributorSelectBoba">
                                        <div class="distributorFormBlock">
                                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorLabel}" title="#{editstudybundle.distributorHelpHeading} - #{editstudybundle.distributorHelp}"/>
                                            <ice:selectOneMenu immediate="false" 
                                                styleClass="select_distributorNameSync">
                                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorName].templateField.controlledVocabulary.selectItems}"/>
                                            </ice:selectOneMenu>
                                        </div>
                                        <div class="distributorbuttonBlock">
                                            <ice:graphicImage id="add_distributorbuttonSelectSync" value="/resources/images/icon_add.gif" />
                                            <ice:graphicImage id="remove_distributorbuttonSelectSync" rendered="#{EditStudyPage.dataTableDistributors.rowCount gt 1}" value="/resources/images/icon_remove.gif" />
                                        </div>
                                      </div>
                                  </div>
                                </div>
                                
                            </div>
                            
                            <div>
                                
                                <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetBlock vdcEditStudyFieldFloat1">
                                  <!-- Author -->
                                    <div id="dvnDataCitationWidgetBlockAuthor">
                                        &lt;&nbsp;
                                        <a href="#" class="dvnDataCitationWidgetLabel"></a>
                                        &nbsp;&gt;,
                                    </div>
                                  <!-- End Author -->
                                </div>
                                <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetBlock vdcEditStudyFieldFloat2">
                                  <!-- Date -->
                                    <div id="dvnDataCitationWidgetBlockDate">
                                        &lt;&nbsp;
                                        <a href="#" class="dvnDataCitationWidgetLabel">Date</a>
                                        &nbsp;&gt;,
                                    </div>
                                  <!-- End Date -->
                                </div>
                                <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetBlock vdcEditStudyFieldFloat2">
                                  <!-- Title -->
                                    <div id="dvnDataCitationWidgetBlockTitle">
                                        &lt;&nbsp;
                                        <a href="#" class="dvnDataCitationWidgetLabel">Title</a>
                                        &nbsp;&gt;,
                                    </div>
                                  <!-- End Title -->
                                </div>
                                <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetBlock vdcEditStudyFieldFloat2">
                                  <!-- Study ID -->
                                    <div id="dvnDataCitationWidgetBlockStudyID">
                                        &lt;&nbsp;
                                        <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetLabelBlock" rendered="#{EditStudyPage.study.id==null}">
                                            <span class="dvnStudyIDPrfx"></span>
                                            <a href="#" class="dvnDataCitationWidgetLabel dvnDataCitationWidgetNewStudyIdLink">Study ID</a>
                                        </div>
                                        <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetTextBlock" rendered="#{EditStudyPage.study.id!=null}">
                                            <span class="dvnStudyIDPrfx"></span>
                                            <ice:outputText id="input_studyIdTextSync" value="#{EditStudyPage.study.globalId}"/>
                                        </div>
                                        &nbsp;&gt;,
                                    </div>
                                  <!-- End Study ID -->
                                </div>
                                <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetBlock vdcEditStudyFieldFloat2">
                                  <!-- Distributor -->
                                    <div id="dvnDataCitationWidgetBlockDistributor">
                                        &lt;&nbsp;
                                        <a href="#" class="dvnDataCitationWidgetLabel">Distributor</a>
                                        <span id="dvnDataCitationWidgetDistributorLabel"> [Distributor]</span>
                                        &nbsp;&gt;,
                                    </div>
                                  <!-- End Distributor -->
                                </div>
                                <div jsfc="ice:panelGroup" styleClass="dvnDataCitationWidgetBlock vdcEditStudyFieldFloat2">
                                  <!-- Version -->
                                    <div id="dvnDataCitationWidgetBlockVersion">
                                        <ice:outputText value="V#{EditStudyPage.metadata.studyVersion.versionNumber} [Version]"/>
                                    </div>
                                  <!-- End Version -->
                                </div>
                                
                            </div>
                          </div>
<script type="text/javascript">
// <![CDATA[
jQuery(document).ready(function(){
    dataCitationWidgetSync();
});

function dataCitationWidgetSync(){
    // Remove clones incase it is being rerun by an add row button
    jQuery('div[id$=dvnDataCitationWidget] div.dvnDataCitationWidgetAuthorInputClone, div[id$=dvnDataCitationWidget] div.dvnDataCitationWidgetAuthorSelectClone, div[id$=dvnDataCitationWidget] div.dvnDataCitationWidgetDistributorInputClone, div[id$=dvnDataCitationWidget] div.dvnDataCitationWidgetDistributorSelectClone').remove();
    
    // Widget binding functions
    var widgetBind = function( inputField, spanField, spanDefault ) { 
        return function() { 
            var inputValue = jQuery(this).val();
            var addText = '';

            if (inputValue == '') {
                var addText = spanDefault;
            }
            else {
                var addText = inputValue;
            }

            jQuery(inputField).val(jQuery(this).val());
            jQuery(spanField).text(addText);
        };
    }
    // Add-Remove button binding functions
    var buttonBind = function( syncButton ) {
	return function() {
            jQuery(syncButton).click();
	};
    }
    
    // vvvvvvv AUTHOR vvvvvv
    // Multiple author widget fields
    var authorInputs = jQuery('input.input_authorName').length;
    var authorSelects = jQuery('select.select_authorName').length;
        
    jQuery('#dvnDataCitationWidgetAuthorInputBlock div.dvnDataCitationWidgetAuthorInputBoba').hide();
    jQuery('#dvnDataCitationWidgetAuthorInputBlock div.dvnDataCitationWidgetAuthorSelectBoba').hide();
    
    if (authorInputs != 0) {
        // Sync author widget label/links
        jQuery('#dvnDataCitationWidgetBlockAuthor a.dvnDataCitationWidgetLabel').html(
            jQuery('input.input_authorName').map(function(){
                var authorLinkVal = jQuery(this).val();
                var allidsA = /\d+(?=\D*$)/.exec( jQuery(this).map(function() { return this.id; }).get() );
                var authorLinkText = '<span id="authorNameSync' + allidsA + '">' + authorLinkVal + '</span>';
                var authorLinkDefaultText = '<span id="authorNameSync' + allidsA + '">Author</span>';

                if (! authorLinkVal) {
                    return authorLinkDefaultText;
                } 
                else {
                    return authorLinkText;
                }
            }).get().join('; ')
        );
        
        for ( i = 0; i < authorInputs; i++) {
            // clone widget author field
            var bobaA = jQuery('#dvnDataCitationWidgetAuthorInputBlock div.dvnDataCitationWidgetAuthorInputBoba');

            var trooperA = jQuery(bobaA).clone(true);

            jQuery('#dvnDataCitationWidgetAuthorInputBlock').append(jQuery(trooperA).attr({ id: 'input_authorNameSync' + i, 'class': 'dvnDataCitationWidgetAuthorInputClone' }).show());

            // sync cloned author fields
            jQuery('div[id=input_authorNameSync' + i + '] div').children('input.input_authorNameSync').val(jQuery('input[id$=' + i + '\\:input_authorName]').val());

            var input_authorName = 'input[id$=' + i + '\\:input_authorName]';
            var input_authorNameSync = 'div#input_authorNameSync' + i + ' input.input_authorNameSync';
            var span_authorName = 'span#authorNameSync' + i;

            jQuery(input_authorNameSync).bind("change input keyup cut paste", widgetBind(input_authorName, span_authorName, 'Author') );
            jQuery(input_authorName).bind("change input keyup cut paste", widgetBind(input_authorNameSync, span_authorName, 'Author') );
            
            // Sync add/remove buttons
            var input_addAuthorSync = jQuery('div#input_authorNameSync' + i).children('div.authorbuttonBlock').children('img[id$=add_authorbuttonInputSync]');
            var input_addAuthor = 'input[id$=' + i + '\\:add_authorbutton]';
            
            var input_removeAuthorSync = jQuery('div#input_authorNameSync' + i).children('div.authorbuttonBlock').children('img[id$=remove_authorbuttonInputSync]');
            var input_removeAuthor = 'input[id$=' + i + '\\:remove_authorbutton]';
            
            jQuery(input_addAuthorSync).bind('click', buttonBind(input_addAuthor) );
            jQuery(input_removeAuthorSync).bind('click', buttonBind(input_removeAuthor) );
        };
        
        // Apply focus to new widget fields
        jQuery('#dvnDataCitationWidgetAuthorInputBlock').find(':input[value=""]:visible:enabled:first').focus();
    }
    
    else {
        jQuery('#dvnDataCitationWidgetBlockAuthor a.dvnDataCitationWidgetLabel').html(
            jQuery('select.select_authorName').map(function(){
                var authorLinkVal = jQuery(this).val();
                var allidsA = /\d+(?=\D*$)/.exec( jQuery(this).map(function() { return this.id; }).get() );
                var authorLinkText = '<span id="authorNameSync' + allidsA + '">' + authorLinkVal + '</span>';
                var authorLinkDefaultText = '<span id="authorNameSync' + allidsA + '">Author</span>';

                if (! authorLinkVal) {
                    return authorLinkDefaultText;
                } 
                else {
                    return authorLinkText;
                }
            }).get().join('; ')
        );
        
        for ( i = 0; i < authorSelects; i++) {
            // clone widget author select
            var bobaSelectA = jQuery('#dvnDataCitationWidgetAuthorInputBlock div.dvnDataCitationWidgetAuthorSelectBoba');
            
            var trooperSelectA = jQuery(bobaSelectA).clone(true);
            
            jQuery('#dvnDataCitationWidgetAuthorInputBlock').append(jQuery(trooperSelectA).attr({ id: 'select_authorNameSync' + i, 'class': 'dvnDataCitationWidgetAuthorSelectClone' }).show());

            // sync cloned author select
            // changed this to clone the children option elements
            jQuery('div[id=select_authorNameSync' + i + '] div').children('select.select_authorNameSync').html(jQuery('select[id$=' + i + '\\:selectOneAuthorName] option').clone(true));

            var select_authorName = 'select[id$=' + i + '\\:selectOneAuthorName]';
            var select_authorNameSync = 'div#select_authorNameSync' + i + ' select.select_authorNameSync';
            var span_authorName = 'span#authorNameSync' + i;

            jQuery(select_authorNameSync).bind("change input keyup cut paste", widgetBind(select_authorName, span_authorName, 'Author') );
            jQuery(select_authorName).bind("change input keyup cut paste", widgetBind(select_authorNameSync, span_authorName, 'Author') );
            
            // Sync add/remove buttons
            var select_addAuthorSync = jQuery('div#select_authorNameSync' + i).children('div.authorbuttonBlock').children('img[id$=add_authorbuttonSelectSync]');
            var select_addAuthor = 'input[id$=' + i + '\\:add_authorbutton]';
            
            var select_removeAuthorSync = jQuery('div#select_authorNameSync' + i).children('div.authorbuttonBlock').children('img[id$=remove_authorbuttonSelectSync]');
            var select_removeAuthor = 'input[id$=' + i + '\\:remove_authorbutton]';
            
            jQuery(select_addAuthorSync).bind('click', buttonBind(select_addAuthor) );
            jQuery(select_removeAuthorSync).bind('click', buttonBind(select_removeAuthor) );
        };
        
        // Apply focus to new widget fields
        jQuery('#dvnDataCitationWidgetAuthorInputBlock').find(':input[value=""]:visible:enabled:first').focus();
    }
    // ^^^^^^^ AUTHOR ^^^^^^^
    
    // vvvvvvv DISTRIBUTOR vvvvvv
    // Multiple distributor widget fields
    var distributorInputs = jQuery('input.input_distributorName').length;
    var distributorSelects = jQuery('select.select_distributorName').length;
    
    jQuery('#dvnDataCitationWidgetDistributorInputBlock div.dvnDataCitationWidgetDistributorInputBoba').hide();
    jQuery('#dvnDataCitationWidgetDistributorInputBlock div.dvnDataCitationWidgetDistributorSelectBoba').hide();
    
    if (distributorInputs != 0) {
        jQuery('#dvnDataCitationWidgetBlockDistributor a.dvnDataCitationWidgetLabel').html(
            jQuery('input.input_distributorName').map(function(){
                var distributorLinkVal = jQuery(this).val();
                var allidsD = /\d+(?=\D*$)/.exec( jQuery(this).map(function() { return this.id; }).get() );
                var distributorLinkText = '<span id="distributorNameSync' + allidsD + '">' + distributorLinkVal + '</span>';
                var distributorLinkDefaultText = '<span id="distributorNameSync' + allidsD + '">Distributor</span>';

                if (! distributorLinkVal) {
                    return distributorLinkDefaultText;
                } 
                else {
                    return distributorLinkText;
                }
            }).get().join('; ')
        );
    
        for ( i = 0; i < distributorInputs; i++) {
            // clone widget distributor field
            var bobaD = jQuery('#dvnDataCitationWidgetDistributorInputBlock div.dvnDataCitationWidgetDistributorInputBoba');

            var trooperD = jQuery(bobaD).clone(true);

            jQuery('#dvnDataCitationWidgetDistributorInputBlock').append(jQuery(trooperD).attr({ id: 'input_distributorNameSync' + i, 'class': 'dvnDataCitationWidgetDistributorInputClone' }).show());

            // sync cloned distributor fields
            jQuery('div[id=input_distributorNameSync' + i + '] div').children('input.input_distributorNameSync').val(jQuery('input[id$=' + i + '\\:input_distributorName]').val());

            var input_distributorName = 'input[id$=' + i + '\\:input_distributorName]';
            var input_distributorNameSync = 'div#input_distributorNameSync' + i + ' input.input_distributorNameSync';
            var span_distributorName = 'span#distributorNameSync' + i;

            jQuery(input_distributorNameSync).bind("change input keyup cut paste", widgetBind(input_distributorName, span_distributorName, 'Distributor') );
            jQuery(input_distributorName).bind("change input keyup cut paste", widgetBind(input_distributorNameSync, span_distributorName, 'Distributor') );
            
            // Sync add/remove buttons
            var input_addDistributorSync = jQuery('div#input_distributorNameSync' + i).children('div.distributorbuttonBlock').children('img[id$=add_distributorbuttonInputSync]');
            var input_addDistributor = 'input[id$=' + i + '\\:add_distributorbutton]';
            
            var input_removeDistributorSync = jQuery('div#input_distributorNameSync' + i).children('div.distributorbuttonBlock').children('img[id$=remove_distributorbuttonInputSync]');
            var input_removeDistributor = 'input[id$=' + i + '\\:remove_distributorbutton]';
            
            jQuery(input_addDistributorSync).bind('click', buttonBind(input_addDistributor) );
            jQuery(input_removeDistributorSync).bind('click', buttonBind(input_removeDistributor) );
        };
        
        // Apply focus to new widget fields
        jQuery('#dvnDataCitationWidgetDistributorInputBlock').find(':input[value=""]:visible:enabled:first').focus();
    }
    
    else {
        jQuery('#dvnDataCitationWidgetBlockDistributor a.dvnDataCitationWidgetLabel').html(
            jQuery('select.select_distributorName').map(function(){
                var distributorLinkVal = jQuery(this).val();
                var allidsD = /\d+(?=\D*$)/.exec( jQuery(this).map(function() { return this.id; }).get() );
                var distributorLinkText = '<span id="distributorNameSync' + allidsD + '">' + distributorLinkVal + '</span>';
                var distributorLinkDefaultText = '<span id="distributorNameSync' + allidsD + '">Distributor</span>';

                if (! distributorLinkVal) {
                    return distributorLinkDefaultText;
                } 
                else {
                    return distributorLinkText;
                }
            }).get().join(', ')
        );
        
        for ( i = 0; i < distributorSelects; i++) {
            // clone widget distributor select
            var bobaSelectD = jQuery('#dvnDataCitationWidgetDistributorInputBlock div.dvnDataCitationWidgetDistributorSelectBoba');

            var trooperSelectD = jQuery(bobaSelectD).clone(true);
            
            jQuery('#dvnDataCitationWidgetDistributorInputBlock').append(jQuery(trooperSelectD).attr({ id: 'select_distributorNameSync' + i, 'class': 'dvnDataCitationWidgetDistributorSelectClone' }).show());

            // sync cloned author select
            // changed this to clone the children option elements
            jQuery('div[id=select_distributorNameSync' + i + '] div').children('select.select_distributorNameSync').html(jQuery('select[id$=' + i + '\\:selectOneDistributorName] option').clone(true));

            var select_distributorName = 'select[id$=' + i + '\\:selectOneDistributorName]';
            var select_distributorNameSync = 'div#select_distributorNameSync' + i + ' select.select_distributorNameSync';
            var span_distributorName = 'span#distributorNameSync' + i;

            jQuery(select_distributorNameSync).bind("change input keyup cut paste", widgetBind(select_distributorName, span_distributorName, 'Distributor') );
            jQuery(select_distributorName).bind("change input keyup cut paste", widgetBind(select_distributorNameSync, span_distributorName, 'Distributor') );
            
            // Sync add/remove buttons
            var select_addDistributorSync = jQuery('div#select_distributorNameSync' + i).children('div.distributorbuttonBlock').children('img[id$=add_distributorbuttonSelectSync]');
            var select_addDistributor = 'input[id$=' + i + '\\:add_distributorbutton]';
            
            var select_removeDistributorSync = jQuery('div#select_distributorNameSync' + i).children('div.distributorbuttonBlock').children('img[id$=remove_distributorbuttonSelectSync]');
            var select_removeDistributor = 'input[id$=' + i + '\\:remove_distributorbutton]';
            
            jQuery(select_addDistributorSync).bind('click', buttonBind(select_addDistributor) );
            jQuery(select_removeDistributorSync).bind('click', buttonBind(select_removeDistributor) );
        };
        
        // Apply focus to new widget fields
        jQuery('#dvnDataCitationWidgetDistributorInputBlock').find(':input[value=""]:visible:enabled:first').focus();
    }
    // ^^^^^^^ DISTRIBUTOR ^^^^^^^
    
    // Sync DATE
    var input_distributionDate = 'input[id$=input_distributionDate]';
    var input_distributionDateSync = 'input[id$=input_distributionDateSync]';
    var input_productionDate = 'input[id$=input_productionDate]';
    var input_productionDateSync = 'input[id$=input_productionDateSync]';
    var span_date = '#dvnDataCitationWidgetBlockDate a.dvnDataCitationWidgetLabel';
    
    var inputDistDateVal = jQuery(input_distributionDate).val();
    var inputProdDateVal = jQuery(input_productionDate).val();
    
    // Fill in DATE
    jQuery(input_distributionDateSync).val(inputDistDateVal);
    jQuery(input_productionDateSync).val(inputProdDateVal);
    
    // Sync DATE label/links
    if (inputDistDateVal !== '' ){
        jQuery(span_date).text(inputDistDateVal);
    }
    else if (inputProdDateVal !== '' ){
        jQuery(span_date).text(inputProdDateVal);
    };
    
    // Display one or the other date
    var widgetTwoFieldBind = function( inputField, primaryField, secondaryField, spanField, spanDefault ) { 
        return function() { 
            jQuery(inputField).val(jQuery(this).val()); 

            var primaryValue = jQuery(primaryField).val();
            var secondaryValue = jQuery(secondaryField).val();
            var addText = '';

            if (primaryValue != '') {
                addText = primaryValue;
            } else if (secondaryValue != '') {
                addText = secondaryValue;
            } else {
                addText = spanDefault;
            }

            jQuery(spanField).text(addText);
        };
    }
    
    // Bind DATE fields
    jQuery(input_distributionDateSync).bind("change input keyup cut paste", widgetTwoFieldBind(input_distributionDate, input_distributionDate, input_productionDate, span_date, 'Date') );
    jQuery(input_distributionDate).bind("change input keyup cut paste", widgetTwoFieldBind(input_distributionDateSync, input_distributionDate, input_productionDate, span_date, 'Date') );
    
    jQuery(input_productionDateSync).bind("change input keyup cut paste", widgetTwoFieldBind(input_productionDate, input_distributionDate, input_productionDate, span_date, 'Date') );
    jQuery(input_productionDate).bind("change input keyup cut paste", widgetTwoFieldBind(input_productionDateSync, input_distributionDate, input_productionDate, span_date, 'Date') );
    
    
    // Sync TITLE
    var input_title = 'input[id$=input_title]';
    var input_titleSync = 'input[id$=input_titleSync]';
    var span_title = '#dvnDataCitationWidgetBlockTitle a.dvnDataCitationWidgetLabel';
    
    var inputTitleVal = jQuery(input_title).val();
    
    // Fill in TITLE
    jQuery(input_titleSync).val(inputTitleVal);
    
    // Sync TITLE field+label/link
    if (inputTitleVal !== '' ){
        jQuery(span_title).text(inputTitleVal);
    };
    
    // Bind TITLE fields
    jQuery(input_titleSync).bind("change input keyup cut paste", widgetBind(input_title, span_title, 'Title') );
    jQuery(input_title).bind("change input keyup cut paste", widgetBind(input_titleSync, span_title, 'Title') );
    
    
    // Sync STUDYID
    var input_studyId = 'input[id$=input_studyId]';
    var input_studyIdSync = 'input[id$=input_studyIdSync]';
    var span_studyId = '#dvnDataCitationWidgetBlockStudyID a.dvnDataCitationWidgetLabel';
    
    var inputStudyIDVal = jQuery(input_studyId).val();
    var inputStudyIDPrfx = jQuery('span[id$=input_studyIdPrfx]').text();
    
    // Fill in STUDYID
    jQuery(input_studyIdSync).val(inputStudyIDVal);
    
    // Sync STUDYID field+label/link
    if (inputStudyIDVal !== '' ){
        jQuery('#dvnDataCitationWidgetBlockStudyID div.dvnDataCitationWidgetLabelBlock span.dvnStudyIDPrfx').text(inputStudyIDPrfx)
        jQuery(span_studyId).text(inputStudyIDVal);
    };
    
    // Bind STUDYID fields
    jQuery(input_studyIdSync).bind("change input keyup cut paste", widgetBind(input_studyId, span_studyId, 'Study ID') );
    jQuery(input_studyId).bind("change input keyup cut paste", widgetBind(input_studyIdSync, span_studyId, 'Study ID') );
    
    
    // Set input focus on tab
    function setFocus() {
        var widgetSyncInputSelect = jQuery(this).find('input:visible:first, select:visible:first');
        
        setTimeout(function() {
            widgetSyncInputSelect.focus();
        }, 100);
    };
    
    // Open+Close Author
    jQuery('#dvnDataCitationWidgetBlockAuthor a.dvnDataCitationWidgetLabel').bind("click", function() {
        
        var otherInput = jQuery('#dvnDataCitationWidgetInputBlock').find('div.dvnDataCitationWidgetInput');
        
        if (jQuery(otherInput).is(':visible')) {
            jQuery(otherInput).hide();
        }
        
        var authorInput = jQuery('#dvnDataCitationWidgetAuthorInputBlock');
        
        jQuery(this).parents('div.dvnDataCitationWidget').find('div.dvnDataCitationWidgetBlock div').css({'background-color':'transparent'});
        jQuery('#dvnDataCitationWidgetBlockAuthor').css({'background':'gold'});
        jQuery(authorInput).show(0, setFocus);
        
        return false;
    });
    // Open+Close Date
    jQuery('#dvnDataCitationWidgetBlockDate a.dvnDataCitationWidgetLabel').bind("click", function() {
        
        var otherInput = jQuery('#dvnDataCitationWidgetInputBlock').find('div.dvnDataCitationWidgetInput');
        
        if (jQuery(otherInput).is(':visible')) {
            jQuery(otherInput).hide();
        }
        
        var dateInput = jQuery('#dvnDataCitationWidgetDateInputBlock');
        
        jQuery(this).parents('div.dvnDataCitationWidget').find('div.dvnDataCitationWidgetBlock div').css({'background-color':'transparent'});
        jQuery('#dvnDataCitationWidgetBlockDate').css({'background':'gold'});
        jQuery(dateInput).show(0, setFocus);
        
        return false;
    });
    // Open+Close Title
    jQuery(span_title).bind("click", function() {
        
        var otherInput = jQuery('#dvnDataCitationWidgetInputBlock').find('div.dvnDataCitationWidgetInput');
        
        if (jQuery(otherInput).is(':visible')) {
            jQuery(otherInput).hide();
        }
        
        var titleInput = jQuery('#dvnDataCitationWidgetTitleInputBlock');
        
        jQuery(this).parents('div.dvnDataCitationWidget').find('div.dvnDataCitationWidgetBlock div').css({'background-color':'transparent'});
        jQuery('#dvnDataCitationWidgetBlockTitle').css({'background':'gold'});
        jQuery(titleInput).show(0, setFocus);
        
        return false;
    });
    // Open+Close Study ID
    jQuery(span_studyId).bind("click", function() {
        
        var otherInput = jQuery('#dvnDataCitationWidgetInputBlock').find('div.dvnDataCitationWidgetInput');
        
        if (jQuery(otherInput).is(':visible')) {
            jQuery(otherInput).hide();
        }
        
        var studyIDInput = jQuery('#dvnDataCitationWidgetStudyIDInputBlock');
        
        jQuery(this).parents('div.dvnDataCitationWidget').find('div.dvnDataCitationWidgetBlock div').css({'background-color':'transparent'});
        jQuery('#dvnDataCitationWidgetBlockStudyID').css({'background':'gold'});
        jQuery(studyIDInput).show(0, setFocus);
        
        return false;
    });
    // Open+Close Distributor
    jQuery('#dvnDataCitationWidgetBlockDistributor a.dvnDataCitationWidgetLabel').bind("click", function() {
        
        var otherInput = jQuery('#dvnDataCitationWidgetInputBlock').find('div.dvnDataCitationWidgetInput');
        
        if (jQuery(otherInput).is(':visible')) {
            jQuery(otherInput).hide();
        }
        
        var distributorInput = jQuery('#dvnDataCitationWidgetDistributorInputBlock');
        
        jQuery(this).parents('div.dvnDataCitationWidget').find('div.dvnDataCitationWidgetBlock div').css({'background-color':'transparent'});
        jQuery('#dvnDataCitationWidgetBlockDistributor').css({'background':'gold'});
        jQuery(distributorInput).show(0, setFocus);
        
        return false;
    });
    
    // TAB FUNCTIONALITY
    jQuery("input.input_authorNameSync:last, select.select_authorNameSync:last").bind("keydown", function(e) {
        var widget = jQuery(this).parents('div.dvnDataCitationWidget');
        var code = e.keyCode || e.which ;
        if (code == '9') {
            jQuery(widget).find('#dvnDataCitationWidgetAuthorInputBlock').css({'display':'none'});
            jQuery(span_date).triggerHandler('click');
        }
    });
    jQuery(input_productionDateSync).bind("keydown", function(e) {
        var widget = jQuery(this).parents('div.dvnDataCitationWidget');
        var code = e.keyCode || e.which ;
        if (code == '9') {
            jQuery(widget).find('#dvnDataCitationWidgetDateInputBlock').css({'display':'none'});
            jQuery(span_title).triggerHandler('click');
        }
    });
    jQuery(input_titleSync).bind("keydown", function(e) {
        var widget = jQuery(this).parents('div.dvnDataCitationWidget');
        var code = e.keyCode || e.which ;
        if (code == '9') {
            if (jQuery('a.dvnDataCitationWidgetNewStudyIdLink').is(':visible')) {
                jQuery(widget).find('#dvnDataCitationWidgetTitleInputBlock').css({'display':'none'});
                jQuery('#dvnDataCitationWidgetBlockStudyID a.dvnDataCitationWidgetLabel').triggerHandler('click');
            }
            else {
                jQuery(widget).find('#dvnDataCitationWidgetstudyIDInputBlock').css({'display':'none'});
                jQuery('#dvnDataCitationWidgetBlockDistributor a.dvnDataCitationWidgetLabel').triggerHandler('click');
            }
        }
    });
    jQuery(input_studyIdSync).bind("keydown", function(e) {
        var widget = jQuery(this).parents('div.dvnDataCitationWidget');
        var code = e.keyCode || e.which ;
        if (code == '9') {
            jQuery(widget).find('#dvnDataCitationWidgetstudyIDInputBlock').css({'display':'none'});
            jQuery('#dvnDataCitationWidgetBlockDistributor a.dvnDataCitationWidgetLabel').triggerHandler('click');
        }
    });
    jQuery("input.input_distributorNameSync:last, select.select_authorNameSync:last").bind("keydown", function(e) {
        var widget = jQuery(this).parents('div.dvnDataCitationWidget');
        var code = e.keyCode || e.which ;
        if (code == '9') {
            jQuery(widget).find('#dvnDataCitationWidgetDistributorInputBlock').css({'display':'none'});
            jQuery(widget).find('div.dvnDataCitationWidgetBlock div').css({'background-color':'transparent'});
            jQuery(widget).find('.dvnDataCitationWidgetInput:first').css({'display':'block'});
        }
    });
};

function initAddAuthorSync(){
    // Add new author
    jQuery('#dvnDataCitationWidgetBlockAuthor a.dvnDataCitationWidgetLabel').append('; <span class="newAuthor"></span>');
    // If the new field is added from the form, and not the widget, close other input-blocks, and show author
    jQuery('#dvnDataCitationWidgetAuthorInputBlock').show().siblings().hide();
    // Rerun entire widget function
    dataCitationWidgetSync();
};

function initAddDistributorSync(){
    // Add new distributor
    jQuery('#dvnDataCitationWidgetBlockDistributor a.dvnDataCitationWidgetLabel').append('; <span class="newDistributor"></span>');
    // If the new field is added from the form, and not the widget, close other input-blocks, and show distributor
    jQuery('#dvnDataCitationWidgetDistributorInputBlock').show().siblings().hide();
    // Rerun entire widget function
    dataCitationWidgetSync();
};
// ]]>
</script>
                        </ice:column>
                      </ice:panelGrid>
                    </ice:column>
                  </ice:panelGrid>
                  
                  <!-- Publication -->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyRelPublicationsEmpty 
                                                                            or EditStudyPage.studyMap[sfc.publication].recommended
                                                                            or EditStudyPage.studyMap[sfc.publication].required)
                                                                           or (EditStudyPage.showAll 
                                                                           and !EditStudyPage.studyMap[sfc.publication].hidden
                                                                           and !EditStudyPage.studyMap[sfc.publication].disabled)}"  
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable" columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableRelPublications}"
                                     value="#{EditStudyPage.metadata.studyRelPublications}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.relatedPublicationLabel}" title="#{editstudybundle.relatedPublicationHelpHeading} - #{editstudybundle.relatedPublicationHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.publication].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.publication].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup">
                               <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.publicationCitationLabel}" title="#{editstudybundle.relatedPublicationTextHelpHeading} - #{editstudybundle.relatedPublicationTextHelp}"/>
                               <ice:inputTextarea cols="90" rows="4"
                                               id="input_relatedPublicationText"
                                               binding="#{EditStudyPage.inputRelPublicationText}"
                                               value="#{currentRow.text}"
                                               rendered="#{empty(EditStudyPage.studyMap[sfc.publicationCitation].templateField.controlledVocabulary)}"
                                               required="#{EditStudyPage.studyMap[sfc.publicationCitation].required and EditStudyPage.validateRequired }" 
                                               requiredMessage="This field is required."
                                               styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator"/>
                              </ice:inputTextarea>
                             <ice:selectOneMenu immediate="false"   id="selectOneRelPublicationText"                                          
                                           value="#{currentRow.text}" 
                                            binding="#{EditStudyPage.inputRelPublicationCitation}"
                                           required="#{EditStudyPage.studyMap[sfc.publicationCitation].required and EditStudyPage.validateRequired }" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.publicationCitation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.publicationCitation].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_relatedPublicationText"/>
                            </div>                                
                            <div jsfc="ice:panelGroup" styleClass="dvnFormPadding" rendered="#{EditStudyPage.dataTableRelPublications.rowIndex==0}">
                                <ice:selectBooleanCheckbox validator="#{EditStudyPage.validateStudyPublication}" binding="#{EditStudyPage.inputRelPublicationReplicationData}" value="#{currentRow.replicationData}" id="input_relatedPublicationReplicationData"/>
                                <ice:outputLabel value="Replication Data for Original Publication (This will apply &quot;Replication Data for:&quot; to your title)" for="input_relatedPublicationReplicationData"/>
                            </div>
                            <div>
                                <ice:message styleClass="errorMessage" for="input_relatedPublicationReplicationData"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.publicationIDTypeLabel}" title="#{editstudybundle.relatedPublicationIDTypeHelpHeading} - #{editstudybundle.relatedPublicationIDTypeHelp}"/>
                              <ice:selectOneMenu validator="#{EditStudyPage.validateStudyPublication}" binding="#{EditStudyPage.inputRelPublicationIDType}" id="input_relatedPublicationIDType" value="#{currentRow.idType}" required="#{EditStudyPage.studyMap[sfc.publicationIDType].required}" requiredMessage="This field is required.">
                                <f:selectItem itemLabel="Select" itemValue=""/>
                                <f:selectItem itemLabel="DOI" itemValue="DOI"/>
                                <f:selectItem itemLabel="arXiv" itemValue="ArXiv"/>
                              </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_relatedPublicationIDType"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.publicationIDNumberLabel}" title="#{editstudybundle.relatedPublicationIDNumberHelpHeading} - #{editstudybundle.relatedPublicationIDNumberHelp}"/>
                              <ice:inputText validator="#{EditStudyPage.validateStudyPublication}" 
                                             binding="#{EditStudyPage.inputRelPublicationIDNumber}" 
                                             id="input_relatedPublicationIDNumber" value="#{currentRow.idNumber}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.publicationIDNumber].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.publicationIDNumber].required and EditStudyPage.validateRequired }"  
                                             requiredMessage="This field is required." maxlength="255"/>
                            <ice:selectOneMenu immediate="false"   id="selectOneRelPubIdNumber"                                          
                                           value="#{currentRow.idNumber}" 
                                           required="#{EditStudyPage.studyMap[sfc.publicationIDNumber].required and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.publicationIDNumber].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.publicationIDNumber].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_relatedPublicationIDNumber"/>
                            </div>                            
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.publicationURLLabel}" title="#{editstudybundle.relatedPublicationURLHelpHeading} - #{editstudybundle.relatedPublicationURLHelp}"/>
                              <ice:inputText id="input_relatedPublicationURL"
                                             validator="#{EditStudyPage.validateStudyPublication}"
                                             binding="#{EditStudyPage.inputRelPublicationURL}"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.publicationURL].templateField.controlledVocabulary)}" 
                                             size="45"
                                             maxlength="255"
                                             value="#{currentRow.url}"
                                             required="#{EditStudyPage.studyMap[sfc.publicationURL].required and EditStudyPage.validateRequired }" 
                                             requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                              <ice:selectOneMenu immediate="false"   id="selectOneRelPubURL"                                          
                                           value="#{currentRow.url}" 
                                           required="#{EditStudyPage.studyMap[sfc.publication].required and EditStudyPage.validateRequired }" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.publicationURL].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.publicationURL].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/)"/>
                              <ice:message styleClass="errorMessage" for="input_relatedPublicationURL"/>
                              <ice:message styleClass="errorMessage" for="selectOneRelPubURL"/>
                            </div>
                          </div>                            
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableRelPublications.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <div jsfc="ice:panelGroup" id="groupPanel9" styleClass="vdcStudyInfoHeader">
                    <ice:outputText id="outputText26" value="Data Citation Details"/>
                  </div>
                  
                  <div jsfc="ice:panelGroup" styleClass="dvnInformationMessage">
                    <div class="dvnMsgBlockContainer">
                      <ice:outputText styleClass="dvnEditStudyHelp" value="#{bundlePageInfo.editStudyDataCitationHelp}" escape="false"/>
                    </div>
                  </div>
                  
                  <!-- TITLE -->
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                    <div jsfc="ice:panelGroup" id="groupPanel37" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.titleLabel}" title="#{editstudybundle.titleHelpHeading} - #{editstudybundle.titleHelp}"/>
                      <ice:graphicImage id="image39" value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.title].required}" />
                      <ice:graphicImage id="image40" value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.title].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel16">
                      <ice:inputText binding="#{EditStudyPage.inputTitle}" id="input_title" size="90"
                                     value="#{EditStudyPage.metadata.title}"
                                     required ="#{EditStudyPage.studyMap[sfc.title].required and EditStudyPage.validateRequired}"
                                     requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_title"/>
                    </div>
                  </ice:panelGrid>
                  
                  <!-- SUBTITLE -->
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable" visible="#{(!empty EditStudyPage.metadata.subTitle 
                                                                           or EditStudyPage.studyMap[sfc.subTitle].recommended
                                                                           or EditStudyPage.studyMap[sfc.subTitle].required) 
                                                                           or (EditStudyPage.showAll and !EditStudyPage.studyMap[sfc.subTitle].hidden
                                                                           and !EditStudyPage.studyMap[sfc.subTitle].disabled) }"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.subtitleLabel}" title="#{editstudybundle.subtitleHelpHeading} - #{editstudybundle.subtitleHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.subTitle].required}" />
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.subTitle].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_subtitle" size="90" value="#{EditStudyPage.metadata.subTitle}" 
                                     requiredMessage="This field is required." required="#{EditStudyPage.studyMap[sfc.subTitle].required and EditStudyPage.validateRequired}"/>
                      <ice:message styleClass="errorMessage" for="input_subtitle"/>
                    </div>
                  </ice:panelGrid>

                  <!-- STUDY ID-->
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.studyidLabel}" title="#{editstudybundle.studyidHelpHeading} - #{editstudybundle.studyidHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.studyId].required and EditStudyPage.study.id==null}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.studyId].recommended and EditStudyPage.study.id==null}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:outputText id="input_studyIdPrfx" value="#{EditStudyPage.study.protocol}:#{EditStudyPage.study.authority}/" rendered="#{EditStudyPage.study.id==null}"/>
                      <ice:inputText maxlength="255" id="input_studyId" value="#{EditStudyPage.study.studyId}" validator="#{EditStudyPage.validateStudyId}" required="#{EditStudyPage.studyMap[sfc.studyId].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required." rendered="#{EditStudyPage.study.id==null}"/>
                      <ice:outputText id="input_studyIdText" value="#{EditStudyPage.study.globalId}" rendered="#{EditStudyPage.study.id!=null}"/>
                      <ice:message styleClass="errorMessage" for="input_studyId"/>
                    </div>
                  </ice:panelGrid>

                  <!-- OTHER IDS -->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 rendered="#{(!EditStudyPage.studyOtherIdsEmpty 
                                             or EditStudyPage.studyMap[sfc.otherId].recommended
                                            or EditStudyPage.studyMap[sfc.otherId].required) 
                                            or  (EditStudyPage.showAll
                                             and  !EditStudyPage.studyMap[sfc.otherId].hidden 
                                             and !EditStudyPage.studyMap[sfc.otherId].disabled) }" 
                                             value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableOtherIds}"
                                     value="#{EditStudyPage.metadata.studyOtherIds}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.otherIdLabel}" title="#{editstudybundle.otheridHelpHeading} - #{editstudybundle.otheridHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.otherId].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.otherId].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 ">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" 
                                              value="#{editstudybundle.otherIdLabel}" title="#{editstudybundle.otheridHelpHeading} - #{editstudybundle.otheridHelp}"/>
                              <ice:inputText maxlength="255" binding="#{EditStudyPage.inputOtherId}" 
                                             id="input_otherId" value="#{currentRow.otherId}"
                                             requiredMessage="This field is required." 
                                             required="#{EditStudyPage.studyMap[sfc.otherId].required and EditStudyPage.validateRequired }"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.otherIdValue].templateField.controlledVocabulary)}"/>
                            <ice:selectOneMenu immediate="false"   id="selectOneOtherId"  
                                               binding="#{EditStudyPage.inputStudyOtherId}"
                                           value="#{currentRow.otherId}" 
                                           required="#{EditStudyPage.studyMap[sfc.otherId].required and EditStudyPage.validateRequired  }"
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.otherIdValue].templateField.controlledVocabulary)}" 
                                           requiredMessage="This field is required." 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.otherIdValue].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_otherId"/>
                               <ice:message styleClass="errorMessage" for="selectOneOtherId"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" 
                                              value="#{editstudybundle.otherIdAgencyLabel}" title="#{editstudybundle.otherAgencyHelpHeading} - #{editstudybundle.otherAgencyHelp}"/>
                              <ice:inputText maxlength="255" binding="#{EditStudyPage.inputOtherIdAgency}" validator="#{EditStudyPage.validateStudyOtherId}"
                                             id="input_otherIdAgency" value="#{currentRow.agency}"  
                                             requiredMessage="This field is required." 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.otherIdAgency].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.otherIdAgency].required and EditStudyPage.validateRequired }"/>
                             <ice:selectOneMenu immediate="false"   id="selectOneOtherIdAgency"                                          
                                           value="#{currentRow.agency}" 
                                           validator="#{EditStudyPage.validateStudyOtherId}"
                                           requiredMessage="This field is required."
                                           required="#{EditStudyPage.studyMap[sfc.otherIdAgency].required and EditStudyPage.validateRequired}"
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.otherIdAgency].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.otherIdAgency].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu> 
                              <ice:message styleClass="errorMessage" for="input_otherIdAgency"/>
                              <ice:message styleClass="errorMessage" for="selectOneOtherIdAgency"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column id="groupPanel61">
                          <ice:commandButton partialSubmit="true" image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton partialSubmit="true" rendered="#{EditStudyPage.dataTableOtherIds.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- Authors -->
                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                    <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                   styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyAuthorsEmpty 
                                                                             or EditStudyPage.studyMap[sfc.author].recommended
                                                                             or EditStudyPage.studyMap[sfc.author].required)
                                                                             or (EditStudyPage.showAll
                                                                              and !EditStudyPage.studyMap[sfc.author].hidden 
                                                                              and !EditStudyPage.studyMap[sfc.author].disabled)}" 
                                                                              value="dummy_datatable">
                      <ice:column>
                        <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                       styleClass="vdcEditStudyInnerTable" columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                       binding="#{EditStudyPage.dataTableAuthors}"
                                       value="#{EditStudyPage.metadata.studyAuthors}" var="currentAuthor">
                          <ice:column>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.authorLabel}" title="#{editstudybundle.authorHelpHeading} - #{editstudybundle.authorHelp}"/>
                              <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.author].required}"/>
                              <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.author].recommended}"/>
                            </div>
                          </ice:column>
                          <ice:column>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">               
                              <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1" >
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.authorNameLabel}" title="#{editstudybundle.authorNameHelpHeading} - #{editstudybundle.authorNameHelp}"/>
                                <ice:inputText id="input_authorName"
                                               styleClass="input_authorName"
                                               value="#{currentAuthor.name}"
                                               size="45"
                                               maxlength="255"
                                               binding="#{EditStudyPage.inputAuthorName}"
                                               required="#{EditStudyPage.studyMap[sfc.author].required  and EditStudyPage.validateRequired }" 
                                               rendered="#{empty(EditStudyPage.studyMap[sfc.authorName].templateField.controlledVocabulary)}"
                                               requiredMessage="This field is required." />
                            <ice:selectOneMenu immediate="false"   id="selectOneAuthorName" 
                                               styleClass="select_authorName"                                         
                                           value="#{currentAuthor.name}"
                                           binding="#{EditStudyPage.inputStudyAuthorName}"
                                           required="#{EditStudyPage.studyMap[sfc.author].required  and EditStudyPage.validateRequired}" 
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.authorName].templateField.controlledVocabulary)}" 
                                           requiredMessage="This field is required."
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.authorName].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu> 
                                
                                <ice:outputText styleClass="vdcEditStudyFormatExample" value="(LastName, FirstName)"/>
                                <ice:message styleClass="errorMessage" for="input_authorName"/>
                                <ice:message styleClass="errorMessage" for="selectOneAuthorName"/>
                              </div>
                              <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2" >
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.authorAffiliationLabel}" title="#{editstudybundle.authorAffiliationHelpHeading} - #{editstudybundle.authorAffiliationHelp}"/>
                                <ice:inputText id="input_authorAffiliation" size="45" maxlength="255"
                                               binding="#{EditStudyPage.inputAuthorAffiliation}"
                                               value="#{currentAuthor.affiliation}"
                                               rendered="#{empty(EditStudyPage.studyMap[sfc.authorAffiliation].templateField.controlledVocabulary)}"
                                               validator="#{EditStudyPage.validateStudyAuthor}"
                                               required="#{EditStudyPage.studyMap[sfc.authorAffiliation].required  and EditStudyPage.validateRequired }" 
                                               requiredMessage="This field is required."
                                               styleClass="formHtmlEnabled">
                                  <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                                </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneAuthorAffiliation"                                          
                                           value="#{currentAuthor.affiliation}" 
                                           validator="#{EditStudyPage.validateStudyAuthor}"
                                           required="#{EditStudyPage.studyMap[sfc.authorAffiliation].required and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.authorAffiliation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.authorAffiliation].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                            <ice:message styleClass="errorMessage" for="input_authorAffiliation"/>
                            <ice:message styleClass="errorMessage" for="selectOneAuthorAffiliation"/>
                              </div>
                            </div>
                          </ice:column>
                          <ice:column>
                            <ice:commandButton id="add_authorbutton" image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                            <ice:commandButton id="remove_authorbutton" rendered="#{EditStudyPage.dataTableAuthors.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                          </ice:column>
                        </ice:dataTable>
                      </ice:column>
                    </ice:dataTable>

                  <!--Producers-->
                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable"  rendered="#{(!EditStudyPage.studyProducersEmpty 
                                                                            or EditStudyPage.studyMap[sfc.producer].recommended
                                                                            or EditStudyPage.studyMap[sfc.producer].required) 
                                                                            or (EditStudyPage.showAll
                                                                            and !EditStudyPage.studyMap[sfc.producer].hidden
                                                                            and !EditStudyPage.studyMap[sfc.producer].disabled)}" 
                                                                            value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableProducers}"
                                     value="#{EditStudyPage.metadata.studyProducers}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.producerLabel}" title="#{editstudybundle.producerHelpHeading} - #{editstudybundle.producerHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.producer].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.producer].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.producerLabel}" title="#{editstudybundle.producerHelpHeading} - #{editstudybundle.producerHelp}"/>
                              <ice:inputText maxlength="255" binding="#{EditStudyPage.inputProducerName}" 
                                             id="input_producerName" value="#{currentRow.name}" size="45" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.producerName].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.producer].required and EditStudyPage.validateRequired }" 
                                             requiredMessage="This field is required." />
                             <ice:selectOneMenu immediate="false"   id="selectOneProducerName"                                          
                                           value="#{currentRow.name}" 
                                           binding="#{EditStudyPage.inputStudyProducerName}"
                                           required="#{EditStudyPage.studyMap[sfc.producer].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.producerName].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.producerName].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_producerName"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.producerAbbreviationLabel}" title="#{editstudybundle.producerAbbreviationHelpHeading} - #{editstudybundle.producerAbbreviationHelp}"/>
                              <ice:inputText maxlength="255" validator="#{EditStudyPage.validateStudyProducer}" 
                                             binding="#{EditStudyPage.inputProducerAbbreviation}" 
                                             id="input_producerAbbreviation" 
                                             value="#{currentRow.abbreviation}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.producerAbbreviation].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.producerAbbreviation].required  and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required." />
                              <ice:message styleClass="errorMessage" for="input_producerAbbreviation"/>
                            <ice:selectOneMenu immediate="false"   id="selectOneProducerAbbreviation"                                          
                                           value="#{currentRow.abbreviation}" 
                                           validator="#{EditStudyPage.validateStudyProducer}"
                                           required="#{EditStudyPage.studyMap[sfc.producerAbbreviation].required  and EditStudyPage.validateRequired }" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.producerAbbreviation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.producerAbbreviation].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.producerAffiliationLabel}" 
                                              title="#{editstudybundle.producerAffiliationHelpHeading} - #{editstudybundle.producerAffiliationHelp}"/>
                              <ice:inputText maxlength="255" validator="#{EditStudyPage.validateStudyProducer}" 
                                             binding="#{EditStudyPage.inputProducerAffiliation}" 
                                             id="input_producerAffiliation" size="45" value="#{currentRow.affiliation}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.producerAffiliation].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.producerAffiliation].required and EditStudyPage.validateRequired }" 
                                             requiredMessage="This field is required."
                                             styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneProducerAffiliation"                                          
                                           value="#{currentRow.affiliation}" 
                                           validator="#{EditStudyPage.validateStudyProducer}"
                                           required="#{EditStudyPage.studyMap[sfc.producerAffiliation].required  and EditStudyPage.validateRequired }" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.producerAffiliation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.producerAffiliation].templateField.controlledVocabulary.selectItems}"/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_producerAffiliation"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.producerURLLabel}" title="#{editstudybundle.producerURLHelpHeading} - #{editstudybundle.producerURLHelp}"/>
                              <ice:inputText id="input_producerURL"
                                             validator="#{EditStudyPage.validateStudyProducer}"
                                             binding="#{EditStudyPage.inputProducerUrl}"
                                             value="#{currentRow.url}"
                                             size="45"
                                             maxlength="255"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.producerURL].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.producerURL].required  and EditStudyPage.validateRequired }" 
                                             requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneProducerURL"                                          
                                           value="#{currentRow.url}" 
                                           validator="#{EditStudyPage.validateStudyProducer}"
                                           required="#{EditStudyPage.studyMap[sfc.producerURL].required  and EditStudyPage.validateRequired }" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.producerURL].templateField.controlledVocabulary)}">
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.producerURL].templateField.controlledVocabulary.selectItems}"/>
                             <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/)"/>
                              <ice:message styleClass="errorMessage" for="input_producerURL"/>
                              <ice:message styleClass="errorMessage" for="selectOneProducerURL"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.producerLogoLabel}" title="#{editstudybundle.producerLogoHelpHeading} - #{editstudybundle.producerLogoHelp}"/>
                              <ice:inputText id="input_producerLogo"
                                             binding="#{EditStudyPage.inputProducerLogo}"
                                             validator="#{EditStudyPage.validateStudyProducer}"
                                             value="#{currentRow.logo}"
                                             size="45"
                                             maxlength="255"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.producerLogo].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.producerLogo].required and EditStudyPage.validateRequired }" 
                                             requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneProducerLogo"                                          
                                           value="#{currentRow.logo}" 
                                           validator="#{EditStudyPage.validateStudyProducer}"
                                           required="#{EditStudyPage.studyMap[sfc.producerLogo].required  and EditStudyPage.validateRequired }" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.producerLogo].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.producerLogo].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/image)"/>
                              <ice:message styleClass="errorMessage" for="input_producerLogo"/>
                              <ice:message styleClass="errorMessage" for="selectOneProducerLogo"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableProducers.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>
                  
                  <!-- Production Date -->
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable " columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.productionDate 
                                            or EditStudyPage.studyMap[sfc.productionDate].recommended
                                            or EditStudyPage.studyMap[sfc.productionDate].required) 
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.productionDate].hidden
                                            and !EditStudyPage.studyMap[sfc.productionDate].disabled) }">
                    <div jsfc="ice:panelGroup" id="groupPanel42" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.productionDateLabel}" title="#{editstudybundle.productionDateHelpHeading} - #{editstudybundle.productionDateHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.productionDate].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.productionDate].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel19">
                      <ice:inputText id="input_productionDate" styleClass="formDateFormat" value="#{EditStudyPage.metadata.productionDate}"  required="#{EditStudyPage.studyMap[sfc.productionDate].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                      <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_productionDate"><f:param name="x" value="Production Date:"/> </ice:message>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable" 
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.productionPlace 
                                            or EditStudyPage.studyMap[sfc.productionPlace].recommended
                                            or EditStudyPage.studyMap[sfc.productionPlace].required)
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.productionPlace].hidden
                                            and !EditStudyPage.studyMap[sfc.productionPlace].disabled)}">
                    <div jsfc="ice:panelGroup" id="groupPanel43"   styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.productionPlaceLabel}" title="#{editstudybundle.productionPlaceHelpHeading} - #{editstudybundle.productionPlaceHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.productionPlace].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.productionPlace].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel20">
                      <ice:inputText id="input_productionPlace" size="45" value="#{EditStudyPage.metadata.productionPlace}" 
                                     required="#{EditStudyPage.studyMap[sfc.productionPlace].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.productionPlace].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_productionPlace"/>                      
                      <ice:selectOneMenu immediate="false" id="productionPlace_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.productionPlace].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.productionPlace].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.productionPlace}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.productionPlace].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                       <ice:message styleClass="errorMessage" for="productionPlace_SelectOne"/> 
                    </div>
                  </ice:panelGrid>

                  <!-- Software -->
                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable"  rendered="#{(!EditStudyPage.studySoftwareEmpty 
                                                                             or EditStudyPage.studyMap[sfc.software].required
                                                                            or EditStudyPage.studyMap[sfc.software].recommended)
                                                                            or (EditStudyPage.showAll 
                                                                            and !EditStudyPage.studyMap[sfc.software].hidden
                                                                            and !EditStudyPage.studyMap[sfc.software].disabled)}" value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableSoftware}"
                                     value="#{EditStudyPage.metadata.studySoftware}" var="currentRow">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.softwareNameLabel}" title="#{editstudybundle.softwareNameHelpHeading} - #{editstudybundle.softwareNameHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.software].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.software].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.softwareNameLabel}" title="#{editstudybundle.softwareNameHelpHeading} - #{editstudybundle.softwareNameHelp}"/>
                              <ice:inputText maxlength="255" binding="#{EditStudyPage.inputSoftwareName}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.softwareName].templateField.controlledVocabulary)}"
                                             id="input_softwareName" size="45"  value="#{currentRow.name}" 
                                             required="#{EditStudyPage.studyMap[sfc.software].required and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required." />
                              <ice:message styleClass="errorMessage" for="input_softwareName"/>
                              <ice:selectOneMenu immediate="false" id="softwareName_SelectOne"
                                          binding="#{EditStudyPage.inputStudySoftwareName}"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.softwareName].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.software].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.name}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.softwareName].templateField.controlledVocabulary.selectItems}"/>
                              </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="softwareName_SelectOne"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.softwareVersionLabel}" title="#{editstudybundle.softwareVersionHelpHeading} - #{editstudybundle.softwareVersionHelp}"/>
                              <ice:inputText maxlength="255" binding="#{EditStudyPage.inputSoftwareVersion}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.softwareVersion].templateField.controlledVocabulary)}"
                                             validator="#{EditStudyPage.validateStudySoftware}" id="input_softwareVersion"
                                             value="#{currentRow.softwareVersion}" required="#{EditStudyPage.studyMap[sfc.softwareVersion].required and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required." />
                              <ice:message styleClass="errorMessage" for="input_softwareVersion"/>
                              <ice:selectOneMenu immediate="false" id="softwareVersion_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.softwareVersion].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.softwareVersion].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.softwareVersion}"  
                                           validator="#{EditStudyPage.validateStudySoftware}"
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.softwareVersion].templateField.controlledVocabulary.selectItems}"/>
                              </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="softwareVersion_SelectOne"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableSoftware.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable " 
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.fundingAgency 
                                            or EditStudyPage.studyMap[sfc.fundingAgency].recommended
                                            or EditStudyPage.studyMap[sfc.fundingAgency].required
                                            ) or 
                                            (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.fundingAgency].hidden
                                            and !EditStudyPage.studyMap[sfc.fundingAgency].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.fundingAgencyLabel}" title="#{editstudybundle.fundingAgencyHelpHeading} - #{editstudybundle.fundingAgencyHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.fundingAgency].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.fundingAgency].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_fundingAgency" size="45" value="#{EditStudyPage.metadata.fundingAgency}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.fundingAgency].templateField.controlledVocabulary)}"
                                     required="#{EditStudyPage.studyMap[sfc.fundingAgency].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_fundingAgency"/>
                      <ice:selectOneMenu immediate="false" id="fundingAgency_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.fundingAgency].templateField.controlledVocabulary)}"
                                           value="#{EditStudyPage.metadata.fundingAgency}"  
                                           required="#{EditStudyPage.studyMap[sfc.fundingAgency].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.fundingAgency].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                       <ice:message styleClass="errorMessage" for="fundingAgency_SelectOne"/>
                    </div>
                  </ice:panelGrid>

                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" 
                                 rendered="#{(!EditStudyPage.studyGrantsEmpty 
                                             or EditStudyPage.studyMap[sfc.grantNumber].recommended
                                             or EditStudyPage.studyMap[sfc.grantNumber].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.grantNumber].hidden
                                            and !EditStudyPage.studyMap[sfc.grantNumber].disabled)}" value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableGrants}"
                                     value="#{EditStudyPage.metadata.studyGrants}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.grantNumberLabel}" title="#{editstudybundle.grantNumberHelpHeading} - #{editstudybundle.grantNumberHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.grantNumber].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.grantNumber].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.grantNumberLabel}" title="#{editstudybundle.grantNumberHelpHeading} - #{editstudybundle.grantNumberHelp}"/>
                              <ice:inputText maxlength="255"  binding="#{EditStudyPage.inputGrantNumber}" 
                                             id="input_grantNumber" size="45"  value="#{currentRow.number}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.grantNumberValue].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.grantNumber].required and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required." />
                              <ice:message styleClass="errorMessage" for="input_grantNumber"/>
                              <ice:selectOneMenu immediate="false" id="grantNumber_SelectOne"
                                          binding="#{EditStudyPage.inputStudyGrantNumber}"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.grantNumberValue].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.grantNumber].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.number}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.grantNumberValue].templateField.controlledVocabulary.selectItems}"/>
                              </ice:selectOneMenu>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.grantingAgencyLabel}" title="#{editstudybundle.grantingAgencyHelpHeading} - #{editstudybundle.grantingAgencyHelp}"/>
                              <ice:inputText maxlength="255"  binding="#{EditStudyPage.inputGrantAgency}" 
                                              rendered="#{empty(EditStudyPage.studyMap[sfc.grantNumberAgency].templateField.controlledVocabulary)}"
                                             validator="#{EditStudyPage.validateStudyGrant}" 
                                             id="input_grantNumberAgency" size="45" value="#{currentRow.agency}" 
                                             required="#{EditStudyPage.studyMap[sfc.grantNumberAgency].required and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required." />
                                <ice:selectOneMenu immediate="false" id="grantAgency_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.grantNumberAgency].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.grantNumberAgency].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.agency}" 
                                           validator="#{EditStudyPage.validateStudyGrant}"
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.grantNumberAgency].templateField.controlledVocabulary.selectItems}"/>
                              </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_grantNumberAgency"/>
                              <ice:message styleClass="errorMessage" for="grantAgency_SelectOne"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableGrants.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- DISTRIBUTOR -->
                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" 
                                 rendered="#{(!EditStudyPage.studyDistributorsEmpty 
                                             or EditStudyPage.studyMap[sfc.distributor].recommended
                                             or EditStudyPage.studyMap[sfc.distributor].required) 
                                             or (EditStudyPage.showAll 
                                             and !EditStudyPage.studyMap[sfc.distributor].hidden
                                             and !EditStudyPage.studyMap[sfc.distributor].disabled)}" 
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableDistributors}"
                                     value="#{EditStudyPage.metadata.studyDistributors}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorLabel}" title="#{editstudybundle.distributorHelpHeading} - #{editstudybundle.distributorHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.distributor].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.distributor].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorLabel}" title="#{editstudybundle.distributorHelpHeading} - #{editstudybundle.distributorHelp}"/>
                              <ice:inputText id="input_distributorName"
                                             styleClass="input_distributorName"
                                             maxlength="255" binding="#{EditStudyPage.inputDistributorName}" 
                                             value="#{currentRow.name}" size="45" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.distributorName].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.distributor].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." />
                             <ice:selectOneMenu immediate="false"   id="selectOneDistributorName"    
                                                styleClass="select_distributorName"
                                           value="#{currentRow.name}" 
                                           binding="#{EditStudyPage.inputStudyDistributorName}"
                                           required="#{EditStudyPage.studyMap[sfc.distributor].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorName].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorName].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_distributorName"/>
                              <ice:message styleClass="errorMessage" for="selectOneDistributorName"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorAbbreviationLabel}" title="#{editstudybundle.distributorAbbreviationHelpHeading} - #{editstudybundle.distributorAbbreviationHelp}"/>
                              <ice:inputText maxlength="255" validator="#{EditStudyPage.validateStudyDistributor}" 
                                             binding="#{EditStudyPage.inputDistributorAbbreviation}" 
                                             id="input_distributorAbbreviation" value="#{currentRow.abbreviation}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.distributorAbbreviation].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.distributorAbbreviation].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." />
                            <ice:selectOneMenu immediate="false"   id="selectOneDistributorAbbreviation"                                          
                                           value="#{currentRow.abbreviation}" 
                                           validator="#{EditStudyPage.validateStudyDistributor}"
                                           required="#{EditStudyPage.studyMap[sfc.distributorAbbreviation].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorAbbreviation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorAbbreviation].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_distributorAbbreviation"/>                             
                              <ice:message styleClass="errorMessage" for="selectOneDistributorAbbreviation"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorAffiliationLabel}" title="#{editstudybundle.distributorAffiliationHelpHeading} - #{editstudybundle.distributorAffiliationHelp}"/>
                              <ice:inputText maxlength="255" id="input_distributorAffiliation" validator="#{EditStudyPage.validateStudyDistributor}" binding="#{EditStudyPage.inputDistributorAffiliation}" size="45"
                                             value="#{currentRow.affiliation}"
                                             required="#{EditStudyPage.studyMap[sfc.distributorAffiliation].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.distributorAffiliation].templateField.controlledVocabulary)}"
                                             styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneDistributorAffiliation"                                          
                                           value="#{currentRow.affiliation}" 
                                           validator="#{EditStudyPage.validateStudyDistributor}"
                                           required="#{EditStudyPage.studyMap[sfc.distributorAbbreviation].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorAffiliation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorAffiliation].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_distributorAffiliation"/>
                            <ice:message styleClass="errorMessage" for="selectOneDistributorAffiliation"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField ">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorURLLabel}" title="#{editstudybundle.distributorURLHelpHeading} - #{editstudybundle.distributorURLHelp}"/>
                              <ice:inputText id="input_distributorURL"
                                             validator="#{EditStudyPage.validateStudyDistributor}"
                                             binding="#{EditStudyPage.inputDistributorUrl}"
                                             value="#{currentRow.url}"
                                             size="45"
                                             maxlength="255"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.distributorURL].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.distributorURL].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneDistributorURL"                                          
                                           value="#{currentRow.url}" 
                                           validator="#{EditStudyPage.validateStudyDistributor}"
                                           required="#{EditStudyPage.studyMap[sfc.distributorURL].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorURL].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorURL].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/)"/>
                              <ice:message styleClass="errorMessage" for="input_distributorURL"/>
                              <ice:message styleClass="errorMessage" for="selectOneDistributorURL"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorLogoLabel}" title="#{editstudybundle.distributorLogoHelpHeading} - #{editstudybundle.distributorLogoHelp}"/>
                              <ice:inputText binding="#{EditStudyPage.inputDistributorLogo}" id="input_distributorLogo"
                                             validator="#{EditStudyPage.validateStudyDistributor}"
                                             value="#{currentRow.logo}"
                                             size="45"
                                             maxlength="255"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.distributorLogo].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.distributorLogo].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                             <ice:selectOneMenu immediate="false"   id="selectOneDistributorLogo"                                          
                                           value="#{currentRow.logo}" 
                                           validator="#{EditStudyPage.validateStudyDistributor}"
                                           required="#{EditStudyPage.studyMap[sfc.distributorLogo].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorLogo].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorLogo].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/image)"/>
                              <ice:message styleClass="errorMessage" for="input_distributorLogo"/>
                              <ice:message styleClass="errorMessage" for="selectOneDistributorLogo"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton id="add_distributorbutton" image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton id="remove_distributorbutton" rendered="#{EditStudyPage.dataTableDistributors.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable "
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.distributorContact 
                                            or EditStudyPage.studyMap[sfc.distributorContact].recommended
                                            or EditStudyPage.studyMap[sfc.distributorContact].required)
                                            or ( EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.distributorContact].hidden
                                            and !EditStudyPage.studyMap[sfc.distributorContact].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorContactLabel}" title="#{editstudybundle.distributorContactHelpHeading} - #{editstudybundle.distributorContactHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.distributorContact].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.distributorContact].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                      <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1">
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorContactLabel}" title="#{editstudybundle.distributorContactHelpHeading} - #{editstudybundle.distributorContactHelp}"/>
                        <ice:inputText binding="#{EditStudyPage.inputDistributorContact}" 
                                       id="input_distributorContact" size="45" value="#{EditStudyPage.metadata.distributorContact}" 
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.distributorContactName].templateField.controlledVocabulary)}"
                                       required="#{EditStudyPage.studyMap[sfc.distributorContact].required and EditStudyPage.validateRequired}" 
                                       requiredMessage="This field is required." />
                            <ice:selectOneMenu immediate="false"   id="selectOneDistributorContact" 
                                               binding="#{EditStudyPage.inputDistributorContactName}"
                                           value="#{EditStudyPage.metadata.distributorContact}" 
                                           required="#{EditStudyPage.studyMap[sfc.distributorContact].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorContactName].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorContactName].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                        <ice:message styleClass="errorMessage" for="input_distributorContact"/>
                                                <ice:message styleClass="errorMessage" for="selectOneDistributorContact"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorContactAffiliationLabel}" title="#{editstudybundle.distributorContactAffiliationHelpHeading} - #{editstudybundle.distributorContactAffiliationHelp}"/>
                        <ice:inputText id="distributorContactAffiliation" size="45" maxlength="255"
                                       binding="#{EditStudyPage.inputDistributorContactAffiliation}"
                                       value="#{EditStudyPage.metadata.distributorContactAffiliation}"
                                       validator="#{EditStudyPage.validateDistributorContact}"
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.distributorContactAffiliation].templateField.controlledVocabulary)}"
                                       required="#{EditStudyPage.studyMap[sfc.distributorContactAffiliation].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                       styleClass="formHtmlEnabled">
                          <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                        </ice:inputText>
                        <ice:selectOneMenu immediate="false"   id="selectOneDistributorContactAffiliation" 
                                           value="#{EditStudyPage.metadata.distributorContactAffiliation}" 
                                           validator="#{EditStudyPage.validateDistributorContact}"
                                           required="#{EditStudyPage.studyMap[sfc.distributorContactAffiliation].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorContactAffiliation].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorContactAffiliation].templateField.controlledVocabulary.selectItems}"/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:selectOneMenu>
                        <ice:message styleClass="errorMessage" for="distributorContactAffiliation"/>
                        <ice:message styleClass="errorMessage" for="selectOneDistributorContactAffiliation"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField " >
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributorContactEmailLabel}" title="#{editstudybundle.distributorContactEmailHelpHeading} - #{editstudybundle.distributorContactEmailHelp}"/>
                        <ice:inputText binding="#{EditStudyPage.inputDistributorContactEmail}" 
                                       id="input_distributorContactEmail" 
                                       size="45" 
                                       value="#{EditStudyPage.metadata.distributorContactEmail}" 
                                       required="#{EditStudyPage.studyMap[sfc.distributorContactEmail].required and EditStudyPage.validateRequired}" 
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.distributorContactEmail].templateField.controlledVocabulary)}"
                                       requiredMessage="This field is required.">
                               <o:validator validatorId="EmailValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                        </ice:inputText>
                             <ice:selectOneMenu immediate="false"   id="selectOneDistributorContactEmail" 
                                           value="#{EditStudyPage.metadata.distributorContactEmail}" 
                                           validator="#{EditStudyPage.validateDistributorContact}"
                                           required="#{EditStudyPage.studyMap[sfc.distributorContactEmail].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.distributorContactEmail].templateField.controlledVocabulary)}" >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.distributorContactEmail].templateField.controlledVocabulary.selectItems}"/>
                               <o:validator validatorId="EmailValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:selectOneMenu>
                                <ice:message styleClass="errorMessage" for="input_distributorContactEmail"/>
                                <ice:message styleClass="errorMessage" for="selectOneDistributorContactEmail"/>
                      </div>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.distributionDate
                                            or EditStudyPage.studyMap[sfc.distributionDate].recommended
                                            or EditStudyPage.studyMap[sfc.distributionDate].required) 
                                            or (EditStudyPage.showAll
                                            and  !EditStudyPage.studyMap[sfc.distributionDate].hidden
                                            and  !EditStudyPage.studyMap[sfc.distributionDate].disabled)  }">
                    <div jsfc="ice:panelGroup" id="groupPanel49" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.distributionDateLabel}" title="#{editstudybundle.distributionDateHelpHeading} - #{editstudybundle.distributionDateHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.distributionDate].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.distributionDate].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel26" >
                      <ice:inputText id="input_distributionDate" styleClass="formDateFormat" value="#{EditStudyPage.metadata.distributionDate}" required="#{EditStudyPage.studyMap[sfc.distributionDate].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                      <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_distributionDate"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.depositor 
                                            or EditStudyPage.studyMap[sfc.depositor].recommended
                                            or EditStudyPage.studyMap[sfc.depositor].required) 
                                            or ( EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.depositor].hidden
                                            and !EditStudyPage.studyMap[sfc.depositor].disabled)  }">
                    <div jsfc="ice:panelGroup" id="groupPanel50"  styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.depositorLabel}" title="#{editstudybundle.depositorHelpHeading} - #{editstudybundle.depositorHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.depositor].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.depositor].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel27" >
                      <ice:inputText id="input_depositor" size="45" value="#{EditStudyPage.metadata.depositor}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.depositor].templateField.controlledVocabulary)}"
                                     required="#{EditStudyPage.studyMap[sfc.depositor].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_depositor"/>
                    
                      <ice:selectOneMenu immediate="false" id="depositor_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.depositor].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.depositor].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.depositor}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.depositor].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                       <ice:message styleClass="errorMessage" for="depositor_SelectOne"/> 
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.dateOfDeposit 
                                            or EditStudyPage.studyMap[sfc.dateOfDeposit].recommended
                                            or EditStudyPage.studyMap[sfc.dateOfDeposit].required) 
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.dateOfDeposit].hidden
                                            and !EditStudyPage.studyMap[sfc.dateOfDeposit].disabled)  }">
                    <div jsfc="ice:panelGroup" id="groupPanel51"  styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.depositDateLabel}" title="#{editstudybundle.depositDateHelpHeading} - #{editstudybundle.depositDateHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.dateOfDeposit].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.dateOfDeposit].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel28" styleClass="vdcEditStudyField">
                      <ice:inputText id="input_dateOfDeposit" styleClass="formDateFormat" value="#{EditStudyPage.metadata.dateOfDeposit}" required="#{EditStudyPage.studyMap[sfc.dateOfDeposit].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                      <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_dateOfDeposit"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.seriesName 
                                            or EditStudyPage.studyMap[sfc.series].recommended
                                            or EditStudyPage.studyMap[sfc.series].required)
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.series].hidden
                                            and !EditStudyPage.studyMap[sfc.series].disabled) }">
                    <div jsfc="ice:panelGroup" id="groupPanel52"  styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.seriesLabel}" title="#{editstudybundle.seriesHelpHeading} - #{editstudybundle.seriesHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.series].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.series].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <div jsfc="ice:panelGroup" id="groupPanel29" styleClass="vdcEditStudyField">
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.seriesLabel}" title="#{editstudybundle.seriesHelpHeading} - #{editstudybundle.seriesHelp}"/>
                        <ice:inputText binding="#{EditStudyPage.inputSeries}" id="input_seriesName"
                                       value="#{EditStudyPage.metadata.seriesName}"
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.seriesName].templateField.controlledVocabulary)}"
                                       required="#{EditStudyPage.studyMap[sfc.series].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                       styleClass="formHtmlEnabled">
                          <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                        </ice:inputText>
                        <ice:selectOneMenu immediate="false"   id="selectOneSeriesName"                                          
                                           value="#{EditStudyPage.metadata.seriesName}" 
                                          binding="#{EditStudyPage.inputStudySeriesName}"
                                           required="#{EditStudyPage.studyMap[sfc.series].required  and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.seriesName].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.seriesName].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>
                        <ice:message styleClass="errorMessage" for="input_seriesName"/>
                        <ice:message styleClass="errorMessage" for="selectOneSeriesName"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.seriesInformationLabel}" title="#{editstudybundle.seriesInformationHelpHeading} - #{editstudybundle.seriesInformationHelp}"/>
                        <ice:inputText binding="#{EditStudyPage.inputSeriesInformation}" id="input_seriesInformation"
                                       size="45"
                                       value="#{EditStudyPage.metadata.seriesInformation}"
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.seriesInformation].templateField.controlledVocabulary)}"
                                       required="#{EditStudyPage.studyMap[sfc.seriesInformation].required and EditStudyPage.validateRequired}" 
                                       requiredMessage="This field is required."
                                       validator="#{EditStudyPage.validateSeries}"
                                       styleClass="formHtmlEnabled">
                          <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                        </ice:inputText>
                        <ice:selectOneMenu immediate="false"   id="selectOneSeriesInformation"                                          
                                           value="#{EditStudyPage.metadata.seriesInformation}" 
                                           required="#{EditStudyPage.studyMap[sfc.seriesInformation].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.seriesInformation].templateField.controlledVocabulary)}" 
                                           validator="#{EditStudyPage.validateSeries}"
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.seriesInformation].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>
                        <ice:message styleClass="errorMessage" for="input_seriesInformation"/>
                        <ice:message styleClass="errorMessage" for="selectOneSeriesInformation"/>
                      </div>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.studyVersionText 
                                            or EditStudyPage.studyMap[sfc.studyVersion].recommended
                                            or EditStudyPage.studyMap[sfc.studyVersion].required) 
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.studyVersion].hidden
                                            and !EditStudyPage.studyMap[sfc.studyVersion].disabled)  }">
                    <div jsfc="ice:panelGroup" id="groupPanel53">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.seriesVersionLabel}" title="#{editstudybundle.seriesVersionHelpHeading} - #{editstudybundle.seriesVersionHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.studyVersion].required }"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.studyVersion].recommended }"/>
                    </div>
                    <div jsfc="ice:panelGroup" id="groupPanel30">
                      <div jsfc="ice:panelGroup" >
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.seriesVersionLabel}" title="#{editstudybundle.seriesVersionHelpHeading} - #{editstudybundle.seriesVersionHelp}"/>
                        <ice:inputText binding="#{EditStudyPage.inputVersion}" 
                                       id="input_studyVersion" value="#{EditStudyPage.metadata.studyVersionText}"  
                                       required="#{EditStudyPage.studyMap[sfc.studyVersion].required and EditStudyPage.validateRequired}" 
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.studyVersionValue].templateField.controlledVocabulary)}"
                                       requiredMessage="This field is required." />
                       <ice:selectOneMenu immediate="false"   id="selectOneStudyVersionText"                                          
                                           value="#{EditStudyPage.metadata.studyVersionText}" 
                                           binding="#{EditStudyPage.inputStudyVersionName}"
                                           required="#{EditStudyPage.studyMap[sfc.studyVersion].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.studyVersionValue].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.studyVersionValue].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>
                        <ice:message styleClass="errorMessage" for="input_studyVersion"/>
                        <ice:message styleClass="errorMessage" for="selectOneStudyVersionText"/>
                      </div>
                      <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                        <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.seriesVersionDateLabel}" title="#{editstudybundle.seriesVersionDateHelpHeading} - #{editstudybundle.seriesVersionDateHelp}"/>
                        <ice:inputText binding="#{EditStudyPage.inputVersionDate}" 
                                       validator="#{EditStudyPage.validateVersion}" 
                                       id="input_versionDate" styleClass="formDateFormat" 
                                       value="#{EditStudyPage.metadata.versionDate}" 
                                       rendered="#{empty(EditStudyPage.studyMap[sfc.versionDate].templateField.controlledVocabulary)}"
                                       required="#{EditStudyPage.studyMap[sfc.versionDate].required and EditStudyPage.validateRequired}" 
                                       requiredMessage="This field is required."  >
                          <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                        </ice:inputText>
                        <ice:selectOneMenu immediate="false"   id="selectOneStudyVersionDate"
                                           binding="#{EditStudyPage.inputStudyVersionDate}"
                                           value="#{EditStudyPage.metadata.versionDate}" 
                                           required="#{EditStudyPage.studyMap[sfc.versionDate].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.versionDate].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.versionDate].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>                        
                        <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                        <ice:message styleClass="errorMessage" for="input_versionDate"/>
                        <ice:message styleClass="errorMessage" for="selectOneStudyVersionDate"/>
                      </div>
                    </div>
                  </ice:panelGrid>

                <ice:panelGrid cellpadding="0" cellspacing="0" columns="1" width="100%"
                                 visible="#{!EditStudyPage.abstractAndScopeEmpty or EditStudyPage.abstractAndScopeInputLevel=='required' or EditStudyPage.abstractAndScopeInputLevel=='recommended' or (EditStudyPage.showAll and EditStudyPage.abstractAndScopeInputLevel=='optional') }">
                  <div jsfc="ice:panelGroup" id="groupPanel12" styleClass="vdcStudyInfoHeader" >
                    <ice:outputText id="outputText65" value="Description and Scope"/>
                  </div>
                </ice:panelGrid>
                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyAbstractsEmpty  
                                                                            or EditStudyPage.studyMap[sfc.description].recommended
                                                                            or EditStudyPage.studyMap[sfc.description].required) 
                                                                           or (EditStudyPage.showAll 
                                                                           and !EditStudyPage.studyMap[sfc.description].hidden
                                                                           and !EditStudyPage.studyMap[sfc.description].disabled)}"  
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableAbstracts}"
                                     value="#{EditStudyPage.metadata.studyAbstracts}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.abstractLabel}" title="#{editstudybundle.abstractHelpHeading} - #{editstudybundle.abstractHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.description].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.description].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup">
                            <div jsfc="ice:panelGroup">
                              <p>
                                  <ice:graphicImage value="/resources/images/icon_warning.18.png" styleClass="dvn_icon"/>
                                  <ice:outputText styleClass="vdcHelpText" value=" Copying and pasting from a Word document can create errors when you save this page."/>
                              </p>
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.abstractLabel}" title="#{editstudybundle.abstractHelpHeading} - #{editstudybundle.abstractHelp}"/>
                              <ice:inputTextarea cols="90" rows="12"
                                                 id="input_abstractText"
                                                 binding="#{EditStudyPage.inputAbstractText}"
                                                 value="#{currentRow.text}"
                                                 rendered="#{empty(EditStudyPage.studyMap[sfc.descriptionText].templateField.controlledVocabulary)}"
                                                 required="#{EditStudyPage.studyMap[sfc.description].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                                 styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputTextarea>
                             <ice:selectOneMenu immediate="false"   id="selectOneStudyAbstractText"                                          
                                           value="#{currentRow.text}" 
                                           binding="#{EditStudyPage.inputStudyAbstractText}"
                                           required="#{EditStudyPage.studyMap[sfc.description].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.descriptionText].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                             <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.descriptionText].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="selectOneStudyAbstractText"/>                              
                              <ice:message styleClass="errorMessage" for="input_abstractText"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.abstractDateLabel}" 
                                              title="#{editstudybundle.abstractDateHelpHeading} - #{editstudybundle.abstractDateHelp}"/>
                              <ice:inputText binding="#{EditStudyPage.inputAbstractDate}" validator="#{EditStudyPage.validateStudyAbstract}" 
                                             id="input_abstractDate" styleClass="formDateFormat" value="#{currentRow.date}" 
                                             required="#{EditStudyPage.studyMap[sfc.descriptionDate].required and EditStudyPage.validateRequired}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.descriptionDate].templateField.controlledVocabulary)}"
                                             requiredMessage="This field is required.">
                                <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                            <ice:selectOneMenu immediate="false"   id="selectOneStudyAbstractDate"                                          
                                           value="#{currentRow.date}"
                                           binding="#{EditStudyPage.inputStudyAbstractDate}"
                                           validator="#{EditStudyPage.validateStudyAbstract}"
                                           required="#{EditStudyPage.studyMap[sfc.descriptionDate].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.descriptionDate].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                              <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.descriptionDate].templateField.controlledVocabulary.selectItems}"/>
                        </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="#{editstudybundle.dateFormatDescription}"/>
                              <ice:message styleClass="errorMessage" for="input_abstractDate"/>
                              <ice:message styleClass="errorMessage" for="selectOneStudyAbstractDate"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableAbstracts.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyKeywordsEmpty 
                                                                            or EditStudyPage.studyMap[sfc.keyword].recommended
                                                                            or EditStudyPage.studyMap[sfc.keyword].required) 
                                                                           or (EditStudyPage.showAll 
                                                                           and !EditStudyPage.studyMap[sfc.keyword].hidden
                                                                           and !EditStudyPage.studyMap[sfc.keyword].disabled)}" 
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableKeywords}"
                                     value="#{EditStudyPage.metadata.studyKeywords}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.keywordLabel}" title="#{editstudybundle.keywordHelpHeading} - #{editstudybundle.keywordHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.keyword].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.keyword].recommended }"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.keywordLabel}" title="#{editstudybundle.keywordHelpHeading} - #{editstudybundle.keywordHelp}"/>
                              <ice:inputText binding="#{EditStudyPage.inputKeywordValue}" 
                                             id="input_keywordValue" value="#{currentRow.value}" 
                                             required="#{EditStudyPage.studyMap[sfc.keyword].required and EditStudyPage.validateRequired}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.keywordValue].templateField.controlledVocabulary)}"
                                             requiredMessage="This field is required." />
                             <ice:selectOneMenu immediate="false"   id="selectOneKeywordValue" 
                                                binding="#{EditStudyPage.inputStudyKeywordValue}"
                                           value="#{currentRow.value}" 
                                           required="#{EditStudyPage.studyMap[sfc.keyword].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.keywordValue].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.keywordValue].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_keywordValue"/>
                              <ice:message styleClass="errorMessage" for="selectOneKeywordValue"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.keywordVocabularyLabel}" title="#{editstudybundle.keywordVocabularyHelpHeading} - #{editstudybundle.keywordVocabularyHelp}"/>
                              <ice:inputText validator="#{EditStudyPage.validateStudyKeyword}" 
                                             binding="#{EditStudyPage.inputKeywordVocab}" id="input_keywordVocab" 
                                             value="#{currentRow.vocab}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.keywordVocab].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.keywordVocab].required and EditStudyPage.validateRequired}"  
                                             requiredMessage="This field is required." maxlength="255"/>
                            <ice:selectOneMenu immediate="false"   id="selectOneKeywordVocab"  
                                               binding="#{EditStudyPage.inputStudyKeywordVocab}"
                                           value="#{currentRow.vocab}" 
                                           validator="#{EditStudyPage.validateStudyKeyword}"
                                           required="#{EditStudyPage.studyMap[sfc.keywordVocab].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.keywordVocab].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.keywordVocab].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_keywordVocab"/>
                               <ice:message styleClass="errorMessage" for="selectOneKeywordVocab"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField ">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.keywordVocabularyURLLabel}" title="#{editstudybundle.keywordVocabularyURLHelpHeading} - #{editstudybundle.keywordVocabularyURLHelp}"/>
                              <ice:inputText id="input_keywordVocabURI"
                                             validator="#{EditStudyPage.validateStudyKeyword}"
                                             binding="#{EditStudyPage.inputKeywordVocabUri}"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.keywordVocabURI].templateField.controlledVocabulary)}"
                                             size="45"
                                             maxlength="255"
                                             value="#{currentRow.vocabURI}"
                                             required="#{EditStudyPage.studyMap[sfc.keywordVocabURI].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                             <ice:selectOneMenu immediate="false"   id="selectOneKeywordVocabURI"  
                                               binding="#{EditStudyPage.inputStudyKeywordVocabURI}"
                                           value="#{currentRow.vocabURI}" 
                                           validator="#{EditStudyPage.validateStudyKeyword}"
                                           required="#{EditStudyPage.studyMap[sfc.keywordVocabURI].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.keywordVocabURI].templateField.controlledVocabulary)}" 
                                           >
                            <f:selectItem itemLabel="No Value" itemValue=""/>
                            <f:selectItems value="#{EditStudyPage.studyMap[sfc.keywordVocabURI].templateField.controlledVocabulary.selectItems}"/>
                            <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                             </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/)"/>
                              <ice:message styleClass="errorMessage" for="input_keywordVocabURI"/>
                              <ice:message styleClass="errorMessage" for="selectOneKeywordVocabURI"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableKeywords.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyTopicClassesEmpty 
                                                                            or EditStudyPage.studyMap[sfc.topicClassification].recommended
                                                                            or EditStudyPage.studyMap[sfc.topicClassification].required) 
                                                                           or ( EditStudyPage.showAll 
                                                                           and !EditStudyPage.studyMap[sfc.topicClassification].hidden
                                                                           and !EditStudyPage.studyMap[sfc.topicClassification].disabled) }" 
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                     styleClass="vdcEditStudyInnerTable" columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     id="dataTableTopicClass"
                                     binding="#{EditStudyPage.dataTableTopicClass}"
                                     value="#{EditStudyPage.metadata.studyTopicClasses}" var="currentRow">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.topicClassificationLabel}" title="#{editstudybundle.topicClassificationHelpHeading} - #{editstudybundle.topicClassificationHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.topicClassification].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.topicClassification].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 vdcEditStudyGroupField ">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.topicClassificationLabel}" title="#{editstudybundle.topicClassificationHelpHeading} - #{editstudybundle.topicClassificationHelp}"/>
                              <ice:inputText binding="#{EditStudyPage.inputTopicClassValue}" 
                                             id="input_topicClassValue" value="#{currentRow.value}" 
                                             required="#{EditStudyPage.studyMap[sfc.topicClassification].required and EditStudyPage.validateRequired}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.topicClassValue].templateField.controlledVocabulary)}"
                                             requiredMessage="This field is required." />
                            <ice:selectOneMenu immediate="false"   id="selectOneTopicClass"
                                                binding="#{EditStudyPage.inputStudyTopicClassValue}"
                                           value="#{currentRow.value}" 
                                           required="#{EditStudyPage.studyMap[sfc.topicClassification].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.topicClassValue].templateField.controlledVocabulary)}" 
                                           >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.topicClassValue].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_topicClassValue"/>
                               <ice:message styleClass="errorMessage" for="selectOneTopicClass"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField ">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.topicClassVocabularyLabel}" title="#{editstudybundle.topicClassVocabularyHelpHeading} - #{editstudybundle.topicClassVocabularyHelp}"/>
                              <ice:inputText maxlength="255" 
                                             validator="#{EditStudyPage.validateStudyTopicClass}" 
                                             binding="#{EditStudyPage.inputTopicClassVocab}" 
                                             id="input_topicClassVocab" value="#{currentRow.vocab}" 
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.topicClassVocab].templateField.controlledVocabulary)}"
                                             required="#{EditStudyPage.studyMap[sfc.topicClassVocab].required and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required." />
                              <ice:selectOneMenu immediate="false"   id="selectOneTopicClassVocab" 
                                                 binding="#{EditStudyPage.inputStudyTopicClassVocab}"
                                           value="#{currentRow.vocab}" 
                                           validator="#{EditStudyPage.validateStudyTopicClass}" 
                                           required="#{EditStudyPage.studyMap[sfc.topicClassVocab].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.topicClassVocab].templateField.controlledVocabulary)}" 
                                           >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.topicClassVocab].templateField.controlledVocabulary.selectItems}"/>
                            </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_topicClassVocab"/>
                              <ice:message styleClass="errorMessage" for="selectOneTopicClassVocab"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField ">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.topicClassVocabularyURLLabel}" title="#{editstudybundle.topicClassVocabularyURLHelpHeading} - #{editstudybundle.topicClassVocabularyURLHelp}"/>
                              <ice:inputText id="input_topicClassVocabURI"
                                             binding="#{EditStudyPage.inputTopicClassVocabUri}"
                                             validator="#{EditStudyPage.validateStudyTopicClass}"
                                             size="45"
                                             maxlength="255"
                                             value="#{currentRow.vocabURI}"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.topicClassVocabURI].templateField.controlledVocabulary)}" 
                                             required="#{EditStudyPage.studyMap[sfc.topicClassVocabURI].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                              <ice:selectOneMenu immediate="false"   id="selectOneTopicClassVocabURI" 
                                                 binding="#{EditStudyPage.inputStudyTopicClassVocabURI}"
                                           value="#{currentRow.vocabURI}" 
                                           validator="#{EditStudyPage.validateStudyTopicClass}" 
                                           required="#{EditStudyPage.studyMap[sfc.topicClassVocabURI].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.topicClassVocabURI].templateField.controlledVocabulary)}" 
                                           >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.topicClassVocabURI].templateField.controlledVocabulary.selectItems}"/>
                                <o:validator validatorId="UrlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:selectOneMenu>
                              <ice:outputText styleClass="vdcEditStudyFormatExample" value="(http://example-domain.edu/)"/>
                              <ice:message styleClass="errorMessage" for="input_topicClassVocabURI"/>
                              <ice:message styleClass="errorMessage" for="selectOneTopicClassVocabURI"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableTopicClass.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyRelMaterialsEmpty 
                                                                            or EditStudyPage.studyMap[sfc.relatedMaterial].recommended
                                                                            or EditStudyPage.studyMap[sfc.relatedMaterial].required) 
                                                                           or (EditStudyPage.showAll 
                                                                           and  !EditStudyPage.studyMap[sfc.relatedMaterial].hidden
                                                                           and  !EditStudyPage.studyMap[sfc.relatedMaterial].disabled)  }"  
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableRelMaterials}"
                                     value="#{EditStudyPage.metadata.studyRelMaterials}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.relatedMaterialLabel}" title="#{editstudybundle.relatedMaterialHelpHeading} - #{editstudybundle.relatedMaterialHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.relatedMaterial].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.relatedMaterial].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup">
                            <ice:inputTextarea cols="90" rows="4"
                                               id="input_relatedMaterial"
                                               binding="#{EditStudyPage.inputRelMaterial}"
                                               value="#{currentRow.text}"
                                               rendered="#{empty(EditStudyPage.studyMap[sfc.relatedMaterial].templateField.controlledVocabulary)}" 
                                               required="#{EditStudyPage.studyMap[sfc.relatedMaterial].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                               styleClass="formHtmlEnabled">
                              <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:inputTextarea>
                            <ice:selectOneMenu immediate="false"   id="selectOnerelatedMaterial" 
                                           value="#{currentRow.text}" 
                                           required="#{EditStudyPage.studyMap[sfc.relatedMaterial].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.relatedMaterial].templateField.controlledVocabulary)}" 
                                           >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.relatedMaterial].templateField.controlledVocabulary.selectItems}"/>
                                 <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:selectOneMenu>
                            <ice:message styleClass="errorMessage" for="input_relatedMaterial"/>
                            <ice:message styleClass="errorMessage" for="selectOnerelatedMaterial"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableRelMaterials.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable" rendered="#{(!EditStudyPage.studyRelStudiesEmpty 
                                                                            or EditStudyPage.studyMap[sfc.relatedStudies].recommended
                                                                            or EditStudyPage.studyMap[sfc.relatedStudies].required)
                                                                           or (EditStudyPage.showAll 
                                                                           and !EditStudyPage.studyMap[sfc.relatedStudies].hidden
                                                                           and !EditStudyPage.studyMap[sfc.relatedStudies].disabled) }" 
                                                                           value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableRelStudies}"
                                     value="#{EditStudyPage.metadata.studyRelStudies}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.relatedStudiesLabel}" title="#{editstudybundle.relatedStudiesHelpHeading} - #{editstudybundle.relatedStudiesHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.relatedStudies].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.relatedStudies].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup">
                            <ice:inputTextarea cols="90" rows="4"
                                               id="input_relatedStudies"
                                               binding="#{EditStudyPage.inputRelStudy}"
                                               value="#{currentRow.text}"
                                               rendered="#{empty(EditStudyPage.studyMap[sfc.relatedStudies].templateField.controlledVocabulary)}" 
                                               required="#{EditStudyPage.studyMap[sfc.relatedStudies].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                               styleClass="formHtmlEnabled">
                              <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:inputTextarea>
                             <ice:selectOneMenu immediate="false"   id="selectOnerelatedStudies" 
                                           value="#{currentRow.text}" 
                                           required="#{EditStudyPage.studyMap[sfc.relatedStudies].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.relatedStudies].templateField.controlledVocabulary)}" 
                                           >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.relatedStudies].templateField.controlledVocabulary.selectItems}"/>
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:selectOneMenu>
                            <ice:message styleClass="errorMessage" for="input_relatedStudies"/>
                            <ice:message styleClass="errorMessage" for="selectOnerelatedStudies"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableRelStudies.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable"
                                  rendered="#{(!EditStudyPage.studyOtherRefsEmpty 
                                              or  EditStudyPage.studyMap[sfc.otherReferences].recommended
                                              or  EditStudyPage.studyMap[sfc.otherReferences].required) 
                                             or (EditStudyPage.showAll
                                             and  !EditStudyPage.studyMap[sfc.otherReferences].hidden
                                             and  !EditStudyPage.studyMap[sfc.otherReferences].disabled) }" 
                                             value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable"
                                     columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableOtherReferences}"
                                     value="#{EditStudyPage.metadata.studyOtherRefs}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.otherReferencesLabel}" title="#{editstudybundle.otherReferencesHelpHeading} - #{editstudybundle.otherReferencesHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.otherReferences].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.otherReferences].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup">
                            <ice:inputText id="input_otherReferences"
                                           binding="#{EditStudyPage.inputOtherReference}"
                                           value="#{currentRow.text}"
                                           size="90"
                                           rendered="#{empty(EditStudyPage.studyMap[sfc.otherReferences].templateField.controlledVocabulary)}"
                                           required="#{EditStudyPage.studyMap[sfc.otherReferences].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                           styleClass="formHtmlEnabled">
                              <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                            </ice:inputText>
                           <ice:selectOneMenu immediate="false"   id="selectOneotherReferences" 
                                           value="#{currentRow.text}" 
                                           required="#{EditStudyPage.studyMap[sfc.otherReferences].required  and EditStudyPage.validateRequired}" 
                                           requiredMessage="This field is required."
                                           rendered="#{!empty(EditStudyPage.studyMap[sfc.otherReferences].templateField.controlledVocabulary)}" 
                                           >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.otherReferences].templateField.controlledVocabulary.selectItems}"/>
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:selectOneMenu>
                            <ice:message styleClass="errorMessage" for="input_otherReferences"/>
                            <ice:message styleClass="errorMessage" for="selectOneotherReferences"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableOtherReferences.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.timePeriodCoveredStart 
                                            or EditStudyPage.studyMap[sfc.timePeriodCoveredStart].recommended
                                            or EditStudyPage.studyMap[sfc.timePeriodCoveredStart].required) 
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.timePeriodCoveredStart].hidden
                                            and !EditStudyPage.studyMap[sfc.timePeriodCoveredStart].disabled)  }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField" >
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.timePeriodStartLabel}" title="#{editstudybundle.timePeriodStartHelpHeading} - #{editstudybundle.timePeriodStartHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.timePeriodCoveredStart].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.timePeriodCoveredStart].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_timePeriodCoveredStart" styleClass="formDateFormat" 
                                     value="#{EditStudyPage.metadata.timePeriodCoveredStart}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.timePeriodCoveredStart].templateField.controlledVocabulary)}"
                                     required="#{EditStudyPage.studyMap[sfc.timePeriodCoveredStart].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                      <ice:selectOneMenu immediate="false" id="timePeriodCoveredStart_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.timePeriodCoveredStart].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.timePeriodCoveredStart].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.timePeriodCoveredStart}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.timePeriodCoveredStart].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                      <ice:outputText value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_timePeriodCoveredStart"/>
                       <ice:message styleClass="errorMessage" for="timePeriodCoveredStart_SelectOne"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.timePeriodCoveredEnd 
                                            or EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].recommended
                                            or EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].required) 
                                            or ( EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].hidden
                                            and !EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.timePeriodEndLabel}" title="#{editstudybundle.timePeriodEndHelpHeading} - #{editstudybundle.timePeriodEndHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_timePeriodCoveredEnd" styleClass="formDateFormat"
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.timePeriodCoveredEnd}" required="#{EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                       <ice:selectOneMenu immediate="false" id="timePeriodCoveredEnd_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.timePeriodCoveredEnd}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.timePeriodCoveredEnd].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                      <ice:outputText value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_timePeriodCoveredEnd"/>
                      <ice:message styleClass="errorMessage" for="timePeriodCoveredEnd_SelectOne"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.dateOfCollectionStart 
                                            or EditStudyPage.studyMap[sfc.dateOfCollectionStart].recommended
                                            or EditStudyPage.studyMap[sfc.dateOfCollectionStart].required)
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.dateOfCollectionStart].hidden
                                            and !EditStudyPage.studyMap[sfc.dateOfCollectionStart].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.collectionDateStartLabel}" title="#{editstudybundle.collectionDateStartHelpHeading} - #{editstudybundle.collectionDateStartHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.dateOfCollectionStart].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.dateOfCollectionStart].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_dateOfCollectionStart" styleClass="formDateFormat" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.dateOfCollectionStart].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.dateOfCollectionStart}"  required="#{EditStudyPage.studyMap[sfc.dateOfCollectionStart].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                      <ice:selectOneMenu immediate="false" id="dateOfCollectionStart"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.dateOfCollectionStart].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.dateOfCollectionStart].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.dateOfCollectionStart}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.dateOfCollectionStart].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                      <ice:outputText value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_dateOfCollectionStart"/>
                      <ice:message styleClass="errorMessage" for="dateOfCollectionStart"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.dateOfCollectionEnd
                                            or EditStudyPage.studyMap[sfc.dateOfCollectionEnd].recommended
                                            or EditStudyPage.studyMap[sfc.dateOfCollectionEnd].required)
                                            or (EditStudyPage.showAll 
                                            and  !EditStudyPage.studyMap[sfc.dateOfCollectionEnd].hidden
                                            and  !EditStudyPage.studyMap[sfc.dateOfCollectionEnd].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.collectionDateEndLabel}" title="#{editstudybundle.collectionDateEndHelpHeading} - #{editstudybundle.collectionDateEndHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.dateOfCollectionEnd].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.dateOfCollectionEnd].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_dateOfCollectionEnd" styleClass="formDateFormat" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.dateOfCollectionEnd].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.dateOfCollectionEnd}"  required="#{EditStudyPage.studyMap[sfc.dateOfCollectionEnd].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." >
                        <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                      </ice:inputText>
                       <ice:selectOneMenu immediate="false" id="dateOfCollectionEnd"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.dateOfCollectionEnd].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.dateOfCollectionEnd].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.dateOfCollectionEnd}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.dateOfCollectionEnd].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                      <ice:outputText value="#{editstudybundle.dateFormatDescription}"/>
                      <ice:message styleClass="errorMessage" for="input_dateOfCollectionEnd"/>
                      <ice:message styleClass="errorMessage" for="dateOfCollectionEnd"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.country 
                                            or EditStudyPage.studyMap[sfc.country].recommended
                                            or EditStudyPage.studyMap[sfc.country].required) 
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.country].hidden
                                            and !EditStudyPage.studyMap[sfc.country].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.countryLabel}" title="#{editstudybundle.countryHelpHeading} - #{editstudybundle.countryHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.country].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.country].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup" >
                      <ice:inputText id="input_country" size="45" value="#{EditStudyPage.metadata.country}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.country].templateField.controlledVocabulary)}"
                                     required="#{EditStudyPage.studyMap[sfc.country].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_country"/>
                    
                      <ice:selectOneMenu immediate="false" id="country_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.country].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.country].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.country}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.country].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                       <ice:message styleClass="errorMessage" for="country_SelectOne"/> 
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.geographicCoverage
                                            or EditStudyPage.studyMap[sfc.geographicCoverage].recommended
                                            or EditStudyPage.studyMap[sfc.geographicCoverage].required) 
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.geographicCoverage].hidden
                                            and !EditStudyPage.studyMap[sfc.geographicCoverage].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.geographicCoverageLabel}" title="#{editstudybundle.geographicCoverageHelpHeading} - #{editstudybundle.geographicCoverageHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.geographicCoverage].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.geographicCoverage].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_geographicCoverage" size="45"  value="#{EditStudyPage.metadata.geographicCoverage}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.geographicCoverage].templateField.controlledVocabulary)}"
                                     required="#{EditStudyPage.studyMap[sfc.geographicCoverage].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_geographicCoverage"/>
                                          
                      <ice:selectOneMenu immediate="false" id="geographicCoverage_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.geographicCoverage].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.geographicCoverage].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.geographicCoverage}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.geographicCoverage].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                       <ice:message styleClass="errorMessage" for="geographicCoverage_SelectOne"/> 
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.geographicUnit 
                                            or EditStudyPage.studyMap[sfc.geographicUnit].recommended
                                            or EditStudyPage.studyMap[sfc.geographicUnit].required)
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.geographicUnit].hidden
                                            and !EditStudyPage.studyMap[sfc.geographicUnit].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.geographicUnitLabel}" title="#{editstudybundle.geographicUnitHelpHeading} - #{editstudybundle.geographicUnitHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.geographicUnit].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.geographicUnit].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <ice:inputText id="input_geographicUnit" size="45"  value="#{EditStudyPage.metadata.geographicUnit}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.geographicUnit].templateField.controlledVocabulary)}"
                                     required="#{EditStudyPage.studyMap[sfc.geographicUnit].required and EditStudyPage.validateRequired}" requiredMessage="This field is required." />
                      <ice:message styleClass="errorMessage" for="input_geographicUnit"/>
                      <ice:selectOneMenu immediate="false" id="geographicUnit_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.geographicUnit].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.geographicUnit].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.geographicUnit}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.geographicUnit].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                       <ice:message styleClass="errorMessage" for="geographicUnit_SelectOne"/> 
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!EditStudyPage.studyGeoBoundingsEmpty 
                                            or EditStudyPage.studyMap[sfc.geographicBoundingBox].recommended
                                            or EditStudyPage.studyMap[sfc.geographicBoundingBox].required)
                                            or ( EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.geographicBoundingBox].hidden
                                            and !EditStudyPage.studyMap[sfc.geographicBoundingBox].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.geographicBoundingBoxLabel}" title="#{editstudybundle.geographicBoundingBoxHelpHeading} - #{editstudybundle.geographicBoundingBoxHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.geographicBoundingBox].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.geographicBoundingBox].recommended}"/>
                    </div>
                    <div jsfc="ice:panelGroup">
                      <p>
                          <ice:graphicImage value="/resources/images/icon_info.gif" styleClass="dvn_icon"/>
                          <ice:outputText styleClass="vdcHelpText" value=" Use the "/>
                          <ice:outputLink styleClass="dvnCGAmapLink" value="#" onclick="window.open('http://maps.cga.harvard.edu/samples/gpf.htm','popup','width=700,height=700,toolbar=no,directories=no,menubar=no,status=no'); return false">
                            <ice:outputText value="CGA Geo-location Finder"/>
                          </ice:outputLink>
                          <ice:outputText styleClass="vdcHelpText" value=" to find the coordinates."/>
                      </p>
                      <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 vdcEditStudyGroupField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.westLongitudeLabel}" title="#{editstudybundle.westLongitudeHelpHeading} - #{editstudybundle.westLongitudeHelp}"/>
                            <ice:inputText id="input_westLongitude" binding="#{EditStudyPage.inputWestLongitude}" value="#{EditStudyPage.metadata.studyGeoBoundings[0].westLongitude}"  validator="#{EditStudyPage.validateLongitude}" 
                                            />
                            <ice:message styleClass="errorMessage" for="input_westLongitude"/>
                          </div>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.eastLongitudeLabel}" title="#{editstudybundle.eastLongitudeHelpHeading} - #{editstudybundle.eastLongitudeHelp}"/>
                            <ice:inputText binding="#{EditStudyPage.inputEastLongitude}" id="input_eastLongitude" value="#{EditStudyPage.metadata.studyGeoBoundings[0].eastLongitude}" validator="#{EditStudyPage.validateLongitude}"  />
                            <ice:message styleClass="errorMessage" for="input_eastLongitude"/>
                          </div>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1 vdcEditStudyFieldFloat3 vdcEditStudyGroupField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.northLatitudeLabel}" title="#{editstudybundle.northLatitudeHelpHeading} - #{editstudybundle.northLatitudeHelp}"/>
                            <ice:inputText binding="#{EditStudyPage.inputNorthLatitude}" id="input_northLatitude" value="#{EditStudyPage.metadata.studyGeoBoundings[0].northLatitude}" validator="#{EditStudyPage.validateLatitude}"   />
                            <ice:message styleClass="errorMessage" for="input_northLatitude"/>
                          </div>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.southLatitudeLabel}" title="#{editstudybundle.southLatitudeHelpHeading} - #{editstudybundle.southLatitudeHelp}"/>
                            <ice:inputText binding="#{EditStudyPage.inputSouthLatitude}" id="input_southLatitude" value="#{EditStudyPage.metadata.studyGeoBoundings[0].southLatitude}" validator="#{EditStudyPage.validateLatitude}"    />
                            <ice:message styleClass="errorMessage" for="input_southLatitude"/>
                          </div>
                      </div>
                      <ice:inputHidden validator="#{EditStudyPage.validateGeographicBounding}" value="test" required="#{EditStudyPage.validateRequired}"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.unitOfAnalysis 
                                            or EditStudyPage.studyMap[sfc.unitOfAnalysis].required
                                            or EditStudyPage.studyMap[sfc.unitOfAnalysis].recommended) 
                                            or (EditStudyPage.showAll  
                                            and !EditStudyPage.studyMap[sfc.unitOfAnalysis].hidden
                                            and !EditStudyPage.studyMap[sfc.unitOfAnalysis].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.unitOfAnalysisLabel}" title="#{editstudybundle.unitOfAnalysisHelpHeading} - #{editstudybundle.unitOfAnalysisHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.unitOfAnalysis].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.unitOfAnalysis].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel62">
                      <ice:inputTextarea id="input_unitOfAnalysis" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.unitOfAnalysis].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.unitOfAnalysis}" 
                                     required="#{EditStudyPage.studyMap[sfc.unitOfAnalysis].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_unitOfAnalysis"/>                      
                      <ice:selectOneMenu immediate="false" id="unitOfAnalysis_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.unitOfAnalysis].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.unitOfAnalysis].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.unitOfAnalysis}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.unitOfAnalysis].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.universe 
                                            or EditStudyPage.studyMap[sfc.universe].recommended
                                            or EditStudyPage.studyMap[sfc.universe].required)
                                            or (EditStudyPage.showAll  
                                            and !EditStudyPage.studyMap[sfc.universe].hidden
                                            and !EditStudyPage.studyMap[sfc.universe].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.universeLabel}" title="#{editstudybundle.universeHelpHeading} - #{editstudybundle.universeHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.universe].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.universe].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel63">
                      <ice:inputTextarea id="input_universe" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.universe].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.universe}" 
                                     required="#{EditStudyPage.studyMap[sfc.universe].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_universe"/>                      
                      <ice:selectOneMenu immediate="false" id="universe_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.universe].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.universe].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.universe}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.universe].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.kindOfData 
                                            or EditStudyPage.studyMap[sfc.kindOfData].recommended
                                            or EditStudyPage.studyMap[sfc.kindOfData].required)
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.kindOfData].hidden
                                            and !EditStudyPage.studyMap[sfc.kindOfData].disabled) }">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.kindOfDataLabel}" title="#{editstudybundle.kindOfDataHelpHeading} - #{editstudybundle.kindOfDataHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.kindOfData].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.kindOfData].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel64">
                      <ice:inputTextarea id="input_kindOfData" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.kindOfData].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.kindOfData}" 
                                     required="#{EditStudyPage.studyMap[sfc.kindOfData].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_kindOfData"/>                      
                      <ice:selectOneMenu immediate="false" id="kindOfData_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.kindOfData].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.kindOfData].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.kindOfData}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.kindOfData].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>
                  
                  <!-- Start of Data Collection Methodology -->
                  
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="1" width="100%"
                                 visible="#{!EditStudyPage.dataCollectionMethodologyEmpty or EditStudyPage.dataCollectionMethodologyInputLevel=='required' 
                                            or EditStudyPage.dataCollectionMethodologyInputLevel=='recommended' 
                                            or (EditStudyPage.showAll and EditStudyPage.dataCollectionMethodologyInputLevel=='optional') }">
                    <div jsfc="ice:panelGroup" id="groupPanel13" styleClass="vdcStudyInfoHeader">
                      <ice:outputText id="outputText90" value="Data Collection / Methodology"/>
                    </div>
                  </ice:panelGrid>
                  
                  <!--revised generic control-->
                  <ice:panelSeries value="#{EditStudyPage.customFieldsDataModel}" var="customFieldsDataModel"
                                   binding="#{EditStudyPage.customFieldsPanelSeries}">
                      <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                     styleClass="vdcEditStudyTable" columnClasses="vdcEditStudyCol1, vdcEditStudyCol2, vdcEditStudyCol3"
                                            rendered="#{empty(customFieldsDataModel[0].controlledVocabulary) and
                                            (!EditStudyPage.isCustomFieldEmpty(customFieldsDataModel[3])
                                            or customFieldsDataModel[0].recommended 
                                            or customFieldsDataModel[0].required
                                            or (EditStudyPage.showAll
                                            and !customFieldsDataModel[0].hidden
                                            and !customFieldsDataModel[0].disabled)) }"
                                     value="#{customFieldsDataModel[1]}" var="customValuesDataModel">
                        <ice:column>
                          <div class="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{customFieldsDataModel[0].studyField.title}" title="#{customFieldsDataModel[0].studyField.title} - #{customFieldsDataModel[0].studyField.description}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{customFieldsDataModel[0].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{customFieldsDataModel[0].recommended}"/>
                          </div>
                        </ice:column>

                        <ice:column>
                          <div>
                            <ice:column> 
                              <ice:inputText id="input_TextDefault" size="90" rendered="#{empty(customFieldsDataModel[0].studyField.fieldType)}" 
                                             visible="#{empty(customFieldsDataModel[0].controlledVocabulary)}"
                                             required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." 
                                             value="#{customValuesDataModel[0].strValue}">
                              </ice:inputText> 
                              <ice:message styleClass="errorMessage" for="input_TextDefault"/>
                              <ice:inputText id="input_HtmlEnabled" size="90" rendered="#{customFieldsDataModel[0].studyField.fieldType == 'html'}" 
                                             visible="#{empty(customFieldsDataModel[0].controlledVocabulary)}"
                                             value="#{customValuesDataModel[0].strValue}"
                                             required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." 
                                             styleClass="formHtmlEnabled">
                                      <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                              <ice:message styleClass="errorMessage" for="input_HtmlEnabled"/>
                              <ice:inputTextarea id="input_HtmlEnabledArea" cols="90" rows="4" rendered="#{customFieldsDataModel[0].studyField.fieldType == 'htmlarea'}"                                          
                                         value="#{customValuesDataModel[0].strValue}"
                                         required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." 
                                         visible="#{empty(customFieldsDataModel[0].controlledVocabulary)}"
                                         styleClass="formHtmlEnabled">
                                  <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputTextarea>
                               <ice:message styleClass="errorMessage" for="input_HtmlEnabledArea"/>
                              <ice:inputText id="input_Text" size="90" rendered="#{customFieldsDataModel[0].studyField.fieldType == 'textBox'}" 
                                             visible="#{empty(customFieldsDataModel[0].controlledVocabulary)}"
                                             required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." 
                                             value="#{customValuesDataModel[0].strValue}">
                              </ice:inputText>  
                               <ice:message styleClass="errorMessage" for="input_Text"/>
                              <ice:inputText id="input_genericDate" styleClass="formDateFormat"
                                             rendered="#{customFieldsDataModel[0].studyField.fieldType == 'date'}" 
                                             value="#{customValuesDataModel[0].strValue}" 
                                             required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." 
                                             visible="#{empty(customFieldsDataModel[0].controlledVocabulary)}">
                                    <o:validator validatorId="DateValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>   
                              <ice:outputText value="#{editstudybundle.dateFormatDescription}" rendered="#{customFieldsDataModel[0].studyField.fieldType == 'date'}"/>
                               <ice:message styleClass="errorMessage" for="input_genericDate"/>
                              <ice:inputTextarea cols="90" rows="4"
                                                   id="input_TextArea"
                                                   value="#{customValuesDataModel[0].strValue}"
                                                   required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." 
                                                   rendered="#{customFieldsDataModel[0].studyField.fieldType == 'textArea'}" 
                                                   visible="#{empty(customFieldsDataModel[0].controlledVocabulary)}">
                              </ice:inputTextarea>
                               <ice:message styleClass="errorMessage" for="input_TextArea"/>
                            </ice:column>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton rendered ="#{customFieldsDataModel[0].allowMultiples and empty(customFieldsDataModel[0].controlledVocabulary)}" 
                                             partialSubmit="true" image="/resources/images/icon_add.gif" 
                                             actionListener="#{EditStudyPage.addCustomRow}">
                          </ice:commandButton>       
                            <ice:commandButton partialSubmit="true" 
                                     rendered="#{customValuesDataModel[1].size() > 1 and empty(customFieldsDataModel[0].controlledVocabulary)}" 
                                    image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeCustomRow}"/>
                        </ice:column>
                      </ice:dataTable>
                      <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                             styleClass="vdcEditStudyTable #{customFieldsDataModel[0].fieldInputLevelString}"
                             rendered="#{!empty(customFieldsDataModel[0].controlledVocabulary) and
                                            (!EditStudyPage.isCustomFieldEmpty(customFieldsDataModel[3])
                                            or customFieldsDataModel[0].recommended 
                                            or customFieldsDataModel[0].required
                                            or (EditStudyPage.showAll
                                            and !customFieldsDataModel[0].hidden
                                            and !customFieldsDataModel[0].disabled)) }"
                             columnClasses="vdcEditStudyCol1, vdcEditStudyCol2">
                         <ice:column>
                          <div class="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{customFieldsDataModel[0].studyField.title}" title="#{customFieldsDataModel[0].studyField.title} - #{customFieldsDataModel[0].studyField.description}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{customFieldsDataModel[0].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{customFieldsDataModel[0].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                            <ice:selectOneMenu immediate="false" id="custom_SelectOne"
                                           value="#{customFieldsDataModel[0].studyField.studyFieldValueSingleString}" 
                                           valueChangeListener="#{EditStudyPage.changeSingleValCV}"                                          
                                        rendered ="#{!customFieldsDataModel[0].allowMultiples}"
                                        required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{customFieldsDataModel[0].controlledVocabulary.selectItems}"/>
                                <f:attribute name="sf_id" value="#{customFieldsDataModel[0].studyField.id}"/>
                            </ice:selectOneMenu>
                            <ice:message styleClass="errorMessage" for="custom_SelectOne"/>
                            <ice:selectManyListbox immediate="false"  id="custom_SelectMany"
                                               valueChangeListener="#{EditStudyPage.changeMultiValCV}" 
                                               value="#{customFieldsDataModel[0].studyField.studyFieldValueStrings}"
                                               required="#{customFieldsDataModel[0].required and EditStudyPage.validateRequired}"  requiredMessage="This field is required."
                                               rendered ="#{customFieldsDataModel[0].allowMultiples }">
                                <f:selectItems value="#{customFieldsDataModel[0].controlledVocabulary.selectItems}"/>
                                <f:attribute name="sf_id" value="#{customFieldsDataModel[0].studyField.id}"/>                            
                            </ice:selectManyListbox>
                            <ice:message styleClass="errorMessage" for="custom_SelectMany"/> 
                        </ice:column> 
                     </ice:panelGrid>
                  </ice:panelSeries>
                  <!-- End Revised generic control-->

                  <!-- End of Generic Control -->
                    <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.timeMethod
                                            or EditStudyPage.studyMap[sfc.timeMethod].recommended
                                            or EditStudyPage.studyMap[sfc.timeMethod].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.timeMethod].hidden
                                            and !EditStudyPage.studyMap[sfc.timeMethod].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.timeMethodLabel}" 
                                      title="#{editstudybundle.timeMethodHelpHeading} - #{editstudybundle.timeMethodHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.timeMethod].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.timeMethod].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel65">
                      <ice:inputText id="input_timeMethod" size="45" value="#{EditStudyPage.metadata.timeMethod}" 
                                     required="#{EditStudyPage.studyMap[sfc.timeMethod].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.timeMethod].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_timeMethod"/>                      
                      <ice:selectOneMenu immediate="false" id="timeMethod_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.timeMethod].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.timeMethod].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.timeMethod}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.timeMethod].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.dataCollector 
                                            or EditStudyPage.studyMap[sfc.dataCollector].recommended 
                                            or EditStudyPage.studyMap[sfc.dataCollector].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.dataCollector].hidden
                                            and !EditStudyPage.studyMap[sfc.dataCollector].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.dataCollectorLabel}" 
                                      title="#{editstudybundle.dataCollectorHelpHeading} - #{editstudybundle.dataCollectorHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.dataCollector].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.dataCollector].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel66">
                      <ice:inputText id="input_dataCollector" size="45" value="#{EditStudyPage.metadata.dataCollector}" 
                                     required="#{EditStudyPage.studyMap[sfc.dataCollector].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.dataCollector].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_dataCollector"/>                      
                      <ice:selectOneMenu immediate="false" id="dataCollector_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.dataCollector].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.dataCollector].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.dataCollector}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.dataCollector].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.frequencyOfDataCollection 
                                            or EditStudyPage.studyMap[sfc.frequencyOfDataCollection].recommended
                                            or EditStudyPage.studyMap[sfc.frequencyOfDataCollection].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.frequencyOfDataCollection].hidden
                                            and !EditStudyPage.studyMap[sfc.frequencyOfDataCollection].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.frequencyOfDataCollectionLabel}" 
                                      title="#{editstudybundle.frequencyHelpHeading} - #{editstudybundle.frequencyHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.frequencyOfDataCollection].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.frequencyOfDataCollection].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel67">
                      <ice:inputText id="input_frequencyOfDataCollection" size="45" value="#{EditStudyPage.metadata.frequencyOfDataCollection}" 
                                     required="#{EditStudyPage.studyMap[sfc.frequencyOfDataCollection].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.frequencyOfDataCollection].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_frequencyOfDataCollection"/>                      
                      <ice:selectOneMenu immediate="false" id="frequencyOfDataCollection_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.frequencyOfDataCollection].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.frequencyOfDataCollection].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.frequencyOfDataCollection}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.frequencyOfDataCollection].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.samplingProcedure
                                            or EditStudyPage.studyMap[sfc.samplingProcedure].recommended
                                            or EditStudyPage.studyMap[sfc.samplingProcedure].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.samplingProcedure].hidden
                                            and !EditStudyPage.studyMap[sfc.samplingProcedure].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.samplingProcedureLabel}" 
                                      title="#{editstudybundle.samplingProcedureHelpHeading} - #{editstudybundle.samplingProcedureHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.samplingProcedure].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.samplingProcedure].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel68">
                      <ice:inputTextarea id="input_samplingProcedure" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.samplingProcedure].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.samplingProcedure}" 
                                     required="#{EditStudyPage.studyMap[sfc.samplingProcedure].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_samplingProcedure"/>                      
                      <ice:selectOneMenu immediate="false" id="samplingProcedure_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.samplingProcedure].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.samplingProcedure].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.samplingProcedure}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.samplingProcedure].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.deviationsFromSampleDesign 
                                            or EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].recommended
                                            or EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].hidden
                                            and !EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.majorDeviationsLabel}" 
                                      title="#{editstudybundle.majorDeviationsHelpHeading} - #{editstudybundle.majorDeviationsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel69">
                      <ice:inputTextarea id="input_deviationsFromSampleDesign" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.deviationsFromSampleDesign}" 
                                     required="#{EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_deviationsFromSampleDesign"/>                      
                      <ice:selectOneMenu immediate="false" id="deviationsFromSampleDesign_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.deviationsFromSampleDesign}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.deviationsFromSampleDesign].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable}"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.collectionMode 
                                            or EditStudyPage.studyMap[sfc.collectionMode].recommended 
                                            or EditStudyPage.studyMap[sfc.collectionMode].required)
                                            or ( EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.collectionMode].hidden
                                            and !EditStudyPage.studyMap[sfc.collectionMode].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.collectionModeLabel}" 
                                      title="#{editstudybundle.collectionModeHelpHeading} - #{editstudybundle.collectionModeHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.collectionMode].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.collectionMode].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel70">
                      <ice:inputText id="input_collectionMode" size="45" value="#{EditStudyPage.metadata.collectionMode}" 
                                     required="#{EditStudyPage.studyMap[sfc.collectionMode].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.collectionMode].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_collectionMode"/>                      
                      <ice:selectOneMenu immediate="false" id="collectionMode_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.collectionMode].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.collectionMode].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.collectionMode}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.collectionMode].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.researchInstrument 
                                            or EditStudyPage.studyMap[sfc.researchInstrument].recommended
                                            or EditStudyPage.studyMap[sfc.researchInstrument].required)
                                            or ( EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.researchInstrument].hidden
                                            and !EditStudyPage.studyMap[sfc.researchInstrument].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                    <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.researchInstrumentLabel}" 
                                      title="#{editstudybundle.researchInstrumentHelpHeading} - #{editstudybundle.researchInstrumentHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.researchInstrument].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.researchInstrument].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel71">
                      <ice:inputText id="input_researchInstrument" size="45" value="#{EditStudyPage.metadata.researchInstrument}" 
                                     required="#{EditStudyPage.studyMap[sfc.researchInstrument].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.researchInstrument].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_researchInstrument"/>                      
                      <ice:selectOneMenu immediate="false" id="researchInstrument_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.researchInstrument].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.researchInstrument].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.researchInstrument}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.researchInstrument].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.dataSources 
                                            or EditStudyPage.studyMap[sfc.dataSources].recommended
                                            or EditStudyPage.studyMap[sfc.dataSources].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.dataSources].hidden
                                            and !EditStudyPage.studyMap[sfc.dataSources].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                    <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.dataSourcesLabel}" 
                                      title="#{editstudybundle.dataSourcesHelpHeading} - #{editstudybundle.dataSourcesHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.dataSources].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.dataSources].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel72">
                      <ice:inputText id="input_dataSources" size="45" value="#{EditStudyPage.metadata.dataSources}" 
                                     required="#{EditStudyPage.studyMap[sfc.dataSources].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.dataSources].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_dataSources"/>                      
                      <ice:selectOneMenu immediate="false" id="dataSources_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.dataSources].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.dataSources].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.dataSources}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.dataSources].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.originOfSources 
                                            or EditStudyPage.studyMap[sfc.originOfSources].recommended
                                            or EditStudyPage.studyMap[sfc.originOfSources].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.originOfSources].hidden
                                            and !EditStudyPage.studyMap[sfc.originOfSources].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.originOfSourcesLabel}" 
                                      title="#{editstudybundle.originOfSourcesHelpHeading} - #{editstudybundle.originOfSourcesHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.originOfSources].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.originOfSources].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel73">
                      <ice:inputText id="input_originOfSources" size="45" value="#{EditStudyPage.metadata.originOfSources}" 
                                     required="#{EditStudyPage.studyMap[sfc.originOfSources].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.originOfSources].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_originOfSources"/>                      
                      <ice:selectOneMenu immediate="false" id="originOfSources_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.originOfSources].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.originOfSources].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.originOfSources}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.originOfSources].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.characteristicOfSources 
                                            or EditStudyPage.studyMap[sfc.characteristicOfSources].recommended
                                            or EditStudyPage.studyMap[sfc.characteristicOfSources].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.characteristicOfSources].hidden
                                            and !EditStudyPage.studyMap[sfc.characteristicOfSources].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.sourceCharacteristicsLabel}" 
                                      title="#{editstudybundle.sourceCharacteristicsHelpHeading} - #{editstudybundle.sourceCharacteristicsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.characteristicOfSources].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.characteristicOfSources].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel74">
                      <ice:inputText id="input_characteristicOfSources" size="45" value="#{EditStudyPage.metadata.characteristicOfSources}" 
                                     required="#{EditStudyPage.studyMap[sfc.characteristicOfSources].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.characteristicOfSources].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_characteristicOfSources"/>                      
                      <ice:selectOneMenu immediate="false" id="characteristicOfSources_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.characteristicOfSources].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.characteristicOfSources].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.characteristicOfSources}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.characteristicOfSources].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.accessToSources 
                                            or EditStudyPage.studyMap[sfc.accessToSources].recommended 
                                            or EditStudyPage.studyMap[sfc.accessToSources].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.accessToSources].hidden
                                            and !EditStudyPage.studyMap[sfc.accessToSources].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.sourceDocumentationLabel}" 
                                      title="#{editstudybundle.sourceDocumentationHelpHeading} - #{editstudybundle.sourceDocumentationHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.accessToSources].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.accessToSources].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel75">
                      <ice:inputTextarea id="input_accessToSources" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.accessToSources].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.accessToSources}" 
                                     required="#{EditStudyPage.studyMap[sfc.accessToSources].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_accessToSources"/>                      
                      <ice:selectOneMenu immediate="false" id="accessToSources_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.accessToSources].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.accessToSources].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.accessToSources}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.accessToSources].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.dataCollectionSituation 
                                            or EditStudyPage.studyMap[sfc.dataCollectionSituation].recommended
                                            or EditStudyPage.studyMap[sfc.dataCollectionSituation].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.dataCollectionSituation].hidden
                                            and !EditStudyPage.studyMap[sfc.dataCollectionSituation].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.dataCollectionCharacteristicsLabel}" 
                                      title="#{editstudybundle.dataCollectionCharacteristicsHelpHeading} - #{editstudybundle.dataCollectionCharacteristicsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.dataCollectionSituation].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.dataCollectionSituation].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel76">
                      <ice:inputText id="input_dataCollectionSituation" size="45" value="#{EditStudyPage.metadata.dataCollectionSituation}" 
                                     required="#{EditStudyPage.studyMap[sfc.dataCollectionSituation].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.dataCollectionSituation].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_dataCollectionSituation"/>                      
                      <ice:selectOneMenu immediate="false" id="dataCollectionSituation_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.dataCollectionSituation].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.dataCollectionSituation].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.dataCollectionSituation}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.dataCollectionSituation].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.actionsToMinimizeLoss
                                            or EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].recommended
                                            or EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].hidden
                                            and !EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.minimizeActionsLabel}" 
                                      title="#{editstudybundle.minimizeActionsHelpHeading} - #{editstudybundle.minimizeActionsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel77">
                      <ice:inputText id="input_actionsToMinimizeLoss" size="45" value="#{EditStudyPage.metadata.actionsToMinimizeLoss}" 
                                     required="#{EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_actionsToMinimizeLoss"/>                      
                      <ice:selectOneMenu immediate="false" id="actionsToMinimizeLoss_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.actionsToMinimizeLoss}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.actionsToMinimizeLoss].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.controlOperations 
                                            or EditStudyPage.studyMap[sfc.controlOperations].recommended 
                                            or EditStudyPage.studyMap[sfc.controlOperations].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.controlOperations].hidden
                                            and !EditStudyPage.studyMap[sfc.controlOperations].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.controlOperationsLabel}" 
                                      title="#{editstudybundle.controlOperationsHelpHeading} - #{editstudybundle.controlOperationsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.controlOperations].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.controlOperations].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel78">
                      <ice:inputText id="input_controlOperations" size="45" value="#{EditStudyPage.metadata.controlOperations}" 
                                     required="#{EditStudyPage.studyMap[sfc.controlOperations].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.controlOperations].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_controlOperations"/>                      
                      <ice:selectOneMenu immediate="false" id="controlOperations_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.controlOperations].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.controlOperations].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.controlOperations}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.controlOperations].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.weighting 
                                            or EditStudyPage.studyMap[sfc.weighting].recommended
                                            or EditStudyPage.studyMap[sfc.weighting].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.weighting].hidden
                                            and !EditStudyPage.studyMap[sfc.weighting].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.weightingLabel}" 
                                      title="#{editstudybundle.weightingHelpHeading} - #{editstudybundle.weightingHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.weighting].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.weighting].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel79">
                      <ice:inputText id="input_weighting" size="45" value="#{EditStudyPage.metadata.weighting}" 
                                     required="#{EditStudyPage.studyMap[sfc.weighting].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.weighting].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_weighting"/>                      
                      <ice:selectOneMenu immediate="false" id="weighting_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.weighting].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.weighting].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.weighting}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.weighting].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                  visible="#{(!empty EditStudyPage.metadata.cleaningOperations 
                                             or EditStudyPage.studyMap[sfc.cleaningOperations].recommended 
                                             or EditStudyPage.studyMap[sfc.cleaningOperations].required)
                                             or (EditStudyPage.showAll
                                             and !EditStudyPage.studyMap[sfc.cleaningOperations].hidden 
                                             and !EditStudyPage.studyMap[sfc.cleaningOperations].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.cleaningOperationsLabel}" 
                                      title="#{editstudybundle.cleaningOperationsHelpHeading} - #{editstudybundle.cleaningOperationsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.cleaningOperations].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.cleaningOperations].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel80">
                      <ice:inputText id="input_cleaningOperations" size="45" value="#{EditStudyPage.metadata.cleaningOperations}" 
                                     required="#{EditStudyPage.studyMap[sfc.cleaningOperations].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.cleaningOperations].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_cleaningOperations"/>                      
                      <ice:selectOneMenu immediate="false" id="cleaningOperations_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.cleaningOperations].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.cleaningOperations].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.cleaningOperations}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.cleaningOperations].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.studyLevelErrorNotes 
                                            or EditStudyPage.studyMap[sfc.studyLevelErrorNotes].recommended
                                            or EditStudyPage.studyMap[sfc.studyLevelErrorNotes].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.studyLevelErrorNotes].hidden
                                            and !EditStudyPage.studyMap[sfc.studyLevelErrorNotes].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.studyLevelErrorNotesLabel}" 
                                      title="#{editstudybundle.studyLevelErrorNotesHelpHeading} - #{editstudybundle.studyLevelErrorNotesHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.studyLevelErrorNotes].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.studyLevelErrorNotes].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel81">
                      <ice:inputText id="input_studyLevelErrorNotes" size="45" value="#{EditStudyPage.metadata.studyLevelErrorNotes}" 
                                     required="#{EditStudyPage.studyMap[sfc.studyLevelErrorNotes].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.studyLevelErrorNotes].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_studyLevelErrorNotes"/>                      
                      <ice:selectOneMenu immediate="false" id="studyLevelErrorNotes_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.studyLevelErrorNotes].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.studyLevelErrorNotes].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.studyLevelErrorNotes}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.studyLevelErrorNotes].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.responseRate 
                                            or EditStudyPage.studyMap[sfc.responseRate].recommended
                                            or EditStudyPage.studyMap[sfc.responseRate].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.responseRate].hidden
                                            and !EditStudyPage.studyMap[sfc.responseRate].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.responseRateLabel}" 
                                      title="#{editstudybundle.responseRateHelpHeading} - #{editstudybundle.responseRateHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.responseRate].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.responseRate].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel82">
                      <ice:inputText id="input_responseRate" size="45" value="#{EditStudyPage.metadata.responseRate}" 
                                     required="#{EditStudyPage.studyMap[sfc.responseRate].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.responseRate].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_responseRate"/>                      
                      <ice:selectOneMenu immediate="false" id="responseRate_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.responseRate].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.responseRate].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.responseRate}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.responseRate].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.samplingErrorEstimate 
                                            or EditStudyPage.studyMap[sfc.samplingErrorEstimates].recommended
                                            or EditStudyPage.studyMap[sfc.samplingErrorEstimates].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.samplingErrorEstimates].hidden
                                            and !EditStudyPage.studyMap[sfc.samplingErrorEstimates].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.samplingErrorLabel}" 
                                      title="#{editstudybundle.samplingErrorHelpHeading} - #{editstudybundle.samplingErrorHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.samplingErrorEstimates].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.samplingErrorEstimates].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel83">
                      <ice:inputText id="input_samplingErrorEstimates" size="45" value="#{EditStudyPage.metadata.samplingErrorEstimate}" 
                                     required="#{EditStudyPage.studyMap[sfc.samplingErrorEstimates].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.samplingErrorEstimates].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_samplingErrorEstimates"/>                      
                      <ice:selectOneMenu immediate="false" id="samplingErrorEstimates_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.samplingErrorEstimates].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.samplingErrorEstimates].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.samplingErrorEstimate}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.samplingErrorEstimates].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.otherDataAppraisal 
                                            or EditStudyPage.studyMap[sfc.otherDataAppraisal].recommended 
                                            or EditStudyPage.studyMap[sfc.otherDataAppraisal].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.otherDataAppraisal].hidden 
                                            and !EditStudyPage.studyMap[sfc.otherDataAppraisal].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.otherDataAppraisalLabel}" 
                                      title="#{editstudybundle.otherDataAppraisalHelpHeading} - #{editstudybundle.otherDataAppraisalHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.otherDataAppraisal].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.otherDataAppraisal].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel84">
                      <ice:inputText id="input_otherDataAppraisal" size="45" value="#{EditStudyPage.metadata.otherDataAppraisal}" 
                                     required="#{EditStudyPage.studyMap[sfc.otherDataAppraisal].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.otherDataAppraisal].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_otherDataAppraisal"/>                      
                      <ice:selectOneMenu immediate="false" id="otherDataAppraisal_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.otherDataAppraisal].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.otherDataAppraisal].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.otherDataAppraisal}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.otherDataAppraisal].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>
                  
                  <!--End of Data Collection Methodology -->  
                  
                  <ice:panelGrid cellpadding="0" cellspacing="0" visible="#{!EditStudyPage.dataSetAvailabilityEmpty or EditStudyPage.dataSetAvailabilityInputLevel=='required' or EditStudyPage.dataSetAvailabilityInputLevel=='recommended' or (EditStudyPage.showAll and EditStudyPage.dataSetAvailabilityInputLevel=='optional') }"
                                 columns="1" width="100%">
                    <div jsfc="ice:panelGroup" id="groupPanel14a" styleClass="vdcStudyInfoHeader">
                      <ice:outputText id="outputText131a" value="Data Set Availability"/>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" id="gridPanel5a"
                                 visible="#{(!empty EditStudyPage.metadata.placeOfAccess 
                                            or EditStudyPage.studyMap[sfc.placeOfAccess].recommended
                                            or EditStudyPage.studyMap[sfc.placeOfAccess].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.placeOfAccess].hidden
                                            and !EditStudyPage.studyMap[sfc.placeOfAccess].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.dataAccessPlaceLabel}" title="#{editstudybundle.dataAccessPlaceHelpHeading} - #{editstudybundle.dataAccessPlaceHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.placeOfAccess].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.placeOfAccess].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel85">
                      <ice:inputText id="input_placeOfAccess" size="45" value="#{EditStudyPage.metadata.placeOfAccess}" 
                                     required="#{EditStudyPage.studyMap[sfc.placeOfAccess].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.placeOfAccess].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_placeOfAccess"/>                      
                      <ice:selectOneMenu immediate="false" id="placeOfAccess_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.placeOfAccess].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.placeOfAccess].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.placeOfAccess}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.placeOfAccess].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable "
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.originalArchive 
                                            or EditStudyPage.studyMap[sfc.originalArchive].recommended 
                                            or EditStudyPage.studyMap[sfc.originalArchive].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.originalArchive].hidden
                                            and !EditStudyPage.studyMap[sfc.originalArchive].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.originalArchiveLabel}" title="#{editstudybundle.originalArchiveHelpHeading} - #{editstudybundle.originalArchiveHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.originalArchive].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.originalArchive].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel86">
                      <ice:inputText id="input_originalArchive" size="45" value="#{EditStudyPage.metadata.originalArchive}" 
                                     required="#{EditStudyPage.studyMap[sfc.originalArchive].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.originalArchive].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_originalArchive"/>                      
                      <ice:selectOneMenu immediate="false" id="originalArchive_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.originalArchive].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.originalArchive].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.originalArchive}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.originalArchive].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.availabilityStatus 
                                            or EditStudyPage.studyMap[sfc.availabilityStatus].recommended
                                            or EditStudyPage.studyMap[sfc.availabilityStatus].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.availabilityStatus].hidden
                                            and !EditStudyPage.studyMap[sfc.availabilityStatus].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.availabilityLabel}" title="#{editstudybundle.availabilityHelpHeading} - #{editstudybundle.availabilityHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.availabilityStatus].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.availabilityStatus].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel87">
                      <ice:inputText id="input_availabilityStatus" size="45" value="#{EditStudyPage.metadata.availabilityStatus}" 
                                     required="#{EditStudyPage.studyMap[sfc.availabilityStatus].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.availabilityStatus].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_availabilityStatus"/>                      
                      <ice:selectOneMenu immediate="false" id="availabilityStatus_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.availabilityStatus].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.availabilityStatus].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.availabilityStatus}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.availabilityStatus].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.collectionSize 
                                            or EditStudyPage.studyMap[sfc.collectionSize].recommended 
                                            or EditStudyPage.studyMap[sfc.collectionSize].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.collectionSize].hidden
                                            and !EditStudyPage.studyMap[sfc.collectionSize].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.collectionSizeLabel}" title="#{editstudybundle.collectionSizeHelpHeading} - #{editstudybundle.collectionSizeHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.collectionSize].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.collectionSize].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel88">
                      <ice:inputText id="input_collectionSize" size="45" value="#{EditStudyPage.metadata.collectionSize}" 
                                     required="#{EditStudyPage.studyMap[sfc.collectionSize].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.collectionSize].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_collectionSize"/>                      
                      <ice:selectOneMenu immediate="false" id="collectionSize_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.collectionSize].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.collectionSize].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.collectionSize}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.collectionSize].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.studyCompletion 
                                            or EditStudyPage.studyMap[sfc.studyCompletion].recommended 
                                            or EditStudyPage.studyMap[sfc.studyCompletion].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.studyCompletion].hidden
                                            and !EditStudyPage.studyMap[sfc.studyCompletion].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.studyCompletionLabel}" title="#{editstudybundle.studyCompletionHelpHeading} - #{editstudybundle.studyCompletionHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.studyCompletion].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.studyCompletion].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel89">
                      <ice:inputText id="input_studyCompletion" size="45" value="#{EditStudyPage.metadata.studyCompletion}" 
                                     required="#{EditStudyPage.studyMap[sfc.studyCompletion].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.studyCompletion].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_studyCompletion"/>                      
                      <ice:selectOneMenu immediate="false" id="studyCompletion_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.studyCompletion].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.studyCompletion].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.studyCompletion}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.studyCompletion].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>
                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="1" width="100%"
                                 visible="#{!EditStudyPage.termsOfUseEmpty or EditStudyPage.termsOfUseInputLevel=='required' or EditStudyPage.termsOfUseInputLevel=='recommended' or (EditStudyPage.showAll and EditStudyPage.termsOfUseInputLevel=='optional')}">
                    <div jsfc="ice:panelGroup" id="groupPanel14" styleClass="vdcStudyInfoHeader">
                      <ice:outputText id="outputText131" value="Terms of Use" />
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2" id="gridPanel5"
                                 visible="#{(!empty EditStudyPage.metadata.confidentialityDeclaration 
                                            or EditStudyPage.studyMap[sfc.confidentialityDeclaration].recommended
                                            or EditStudyPage.studyMap[sfc.confidentialityDeclaration].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.confidentialityDeclaration].hidden
                                            and !EditStudyPage.studyMap[sfc.confidentialityDeclaration].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.confidentialityLabel}" title="#{editstudybundle.confidentialityHelpHeading} - #{editstudybundle.confidentialityHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.confidentialityDeclaration].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.confidentialityDeclaration].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel90">
                      <ice:inputTextarea id="input_confidentialityDeclaration" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.confidentialityDeclaration].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.confidentialityDeclaration}" 
                                     required="#{EditStudyPage.studyMap[sfc.confidentialityDeclaration].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_confidentialityDeclaration"/>                      
                      <ice:selectOneMenu immediate="false" id="confidentialityDeclaration_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.confidentialityDeclaration].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.confidentialityDeclaration].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.confidentialityDeclaration}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.confidentialityDeclaration].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.specialPermissions
                                            or EditStudyPage.studyMap[sfc.specialPermissions].recommended 
                                            or EditStudyPage.studyMap[sfc.specialPermissions].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.specialPermissions].hidden 
                                            and !EditStudyPage.studyMap[sfc.specialPermissions].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.specialPermissionsLabel}" title="#{editstudybundle.specialPermissionsHelpHeading} - #{editstudybundle.specialPermissionsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.specialPermissions].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.specialPermissions].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel91">
                      <ice:inputTextarea id="input_specialPermissions" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.specialPermissions].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.specialPermissions}" 
                                     required="#{EditStudyPage.studyMap[sfc.specialPermissions].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_specialPermissions"/>                      
                      <ice:selectOneMenu immediate="false" id="specialPermissions_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.specialPermissions].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.specialPermissions].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.specialPermissions}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.specialPermissions].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.restrictions 
                                            or EditStudyPage.studyMap[sfc.restrictions].recommended
                                            or EditStudyPage.studyMap[sfc.restrictions].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.restrictions].hidden
                                            and !EditStudyPage.studyMap[sfc.restrictions].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.restrictionsLabel}" title="#{editstudybundle.restrictionsHelpHeading} - #{editstudybundle.restrictionsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.restrictions].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.restrictions].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel92">
                      <ice:inputTextarea id="input_restrictions" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.restrictions].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.restrictions}" 
                                     required="#{EditStudyPage.studyMap[sfc.restrictions].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_restrictions"/>                      
                      <ice:selectOneMenu immediate="false" id="restrictions_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.restrictions].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.restrictions].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.restrictions}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.restrictions].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.contact 
                                            or EditStudyPage.studyMap[sfc.contact].recommended 
                                            or EditStudyPage.studyMap[sfc.contact].required)
                                            or (EditStudyPage.showAll 
                                            and !EditStudyPage.studyMap[sfc.contact].hidden
                                            and !EditStudyPage.studyMap[sfc.contact].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.contactLabel}" title="#{editstudybundle.contactHelpHeading} - #{editstudybundle.contactHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.contact].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.contact].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel93">
                      <ice:inputText id="input_contact" size="45" value="#{EditStudyPage.metadata.contact}" 
                                     required="#{EditStudyPage.studyMap[sfc.contact].required and EditStudyPage.validateRequired}" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.contact].templateField.controlledVocabulary)}"
                                     requiredMessage="This field is required."
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputText> 
                      <ice:message styleClass="errorMessage" for="input_contact"/>                      
                      <ice:selectOneMenu immediate="false" id="contact_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.contact].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.contact].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.contact}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.contact].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.citationRequirements 
                                            or EditStudyPage.studyMap[sfc.citationRequirements].recommended
                                            or EditStudyPage.studyMap[sfc.citationRequirements].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.citationRequirements].hidden
                                            and !EditStudyPage.studyMap[sfc.citationRequirements].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.citationRequirementsLabel}" title="#{editstudybundle.citationRequirementsHelpHeading} - #{editstudybundle.citationRequirementsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.citationRequirements].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.citationRequirements].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel94">
                      <ice:inputTextarea id="input_citationRequirements" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.citationRequirements].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.citationRequirements}" 
                                     required="#{EditStudyPage.studyMap[sfc.citationRequirements].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_citationRequirements"/>                      
                      <ice:selectOneMenu immediate="false" id="citationRequirements_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.citationRequirements].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.citationRequirements].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.citationRequirements}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.citationRequirements].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.depositorRequirements 
                                            or EditStudyPage.studyMap[sfc.depositorRequirements].recommended 
                                            or EditStudyPage.studyMap[sfc.depositorRequirements].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.depositorRequirements].hidden
                                            and !EditStudyPage.studyMap[sfc.depositorRequirements].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.depositorRequirementsLabel}" title="#{editstudybundle.depositorRequirementsHelpHeading} - #{editstudybundle.depositorRequirementsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.depositorRequirements].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.depositorRequirements].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel95">
                      <ice:inputTextarea id="input_depositorRequirements" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.depositorRequirements].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.depositorRequirements}" 
                                     required="#{EditStudyPage.studyMap[sfc.depositorRequirements].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_depositorRequirements"/>                      
                      <ice:selectOneMenu immediate="false" id="depositorRequirements_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.depositorRequirements].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.depositorRequirements].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.depositorRequirements}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.depositorRequirements].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.conditions 
                                            or EditStudyPage.studyMap[sfc.conditions].recommended
                                            or EditStudyPage.studyMap[sfc.conditions].required)
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.conditions].hidden
                                            and !EditStudyPage.studyMap[sfc.conditions].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.conditionsLabel}" title="#{editstudybundle.conditionsHelpHeading} - #{editstudybundle.conditionsHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.conditions].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.conditions].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel96">
                      <ice:inputTextarea id="input_conditions" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.conditions].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.conditions}" 
                                     required="#{EditStudyPage.studyMap[sfc.conditions].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_conditions"/>                      
                      <ice:selectOneMenu immediate="false" id="conditions_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.conditions].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.conditions].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.conditions}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.conditions].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <ice:panelGrid cellpadding="0" cellspacing="0" columns="2" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 columnClasses="vdcEditStudyCol1, vdcEditStudyCol2"
                                 visible="#{(!empty EditStudyPage.metadata.disclaimer 
                                            or EditStudyPage.studyMap[sfc.disclaimer].recommended
                                            or EditStudyPage.studyMap[sfc.disclaimer].required) 
                                            or (EditStudyPage.showAll
                                            and !EditStudyPage.studyMap[sfc.disclaimer].hidden
                                            and !EditStudyPage.studyMap[sfc.disclaimer].disabled)}">
                    <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                      <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.disclaimerLabel}" title="#{editstudybundle.disclaimerHelpHeading} - #{editstudybundle.disclaimerHelp}"/>
                      <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.disclaimer].required}"/>
                      <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.disclaimer].recommended}"/>
                    </div>
		
                    <div jsfc="ice:panelGroup" id="groupPanel97">
                      <ice:inputTextarea id="input_disclaimer" 
                                     cols="90" 
                                     rows="2" 
                                     rendered="#{empty(EditStudyPage.studyMap[sfc.disclaimer].templateField.controlledVocabulary)}"
                                     value="#{EditStudyPage.metadata.disclaimer}" 
                                     required="#{EditStudyPage.studyMap[sfc.disclaimer].required and EditStudyPage.validateRequired}" 
                                     requiredMessage="This field is required." 
                                     styleClass="formHtmlEnabled">
                        <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/> 
                      </ice:inputTextarea> 
                      <ice:message styleClass="errorMessage" for="input_disclaimer"/>                      
                      <ice:selectOneMenu immediate="false" id="disclaimer_SelectOne"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.disclaimer].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.disclaimer].required and EditStudyPage.validateRequired}" 
                                           value="#{EditStudyPage.metadata.disclaimer}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.disclaimer].templateField.controlledVocabulary.selectItems}"/>
                       </ice:selectOneMenu>
                    </div>
                  </ice:panelGrid>

                  <div jsfc="ice:panelGroup" id="groupPanel15" styleClass="vdcStudyInfoHeader"
                       visible="#{!EditStudyPage.studyNotesEmpty or EditStudyPage.studyMap[sfc.notesInformationType].required or EditStudyPage.studyMap[sfc.notesInformationType].recommended or (EditStudyPage.showAll and EditStudyPage.studyMap[sfc.notesInformationType].optional) }">
                    <ice:outputText id="outputText160" value="Other Information"/>
                  </div>
                  <!-- this is a dummy datatable wrapper used to force data retention on validation error-->
                  <ice:dataTable cellpadding="0" cellspacing="0" width="100%"
                                 styleClass="vdcEditStudyTable"
                                 rendered="#{(!EditStudyPage.studyNotesEmpty 
                                             or EditStudyPage.studyMap[sfc.note].recommended 
                                             or EditStudyPage.studyMap[sfc.note].required)
                                             or (EditStudyPage.showAll
                                             and !EditStudyPage.studyMap[sfc.note].hidden 
                                             and !EditStudyPage.studyMap[sfc.note].disabled)}" 
                                             value="dummy_datatable">
                    <ice:column>
                      <ice:dataTable id="dataTableNotes" cellpadding="0" cellspacing="0"
                                     styleClass="vdcEditStudyInnerTable" columnClasses="vdcEditStudyCol1b, vdcEditStudyCol2, vdcEditStudyCol3"
                                     binding="#{EditStudyPage.dataTableNotes}"
                                     value="#{EditStudyPage.metadata.studyNotes}" var="currentRow" width="100%">
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyField">
                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.notesLabel}" title="#{editstudybundle.notesHelpHeading} - #{editstudybundle.notesHelp}"/>
                            <ice:graphicImage value="/resources/images/icon_required.gif" rendered="#{EditStudyPage.studyMap[sfc.note].required}"/>
                            <ice:graphicImage value="/resources/images/icon_recommended.gif" rendered="#{EditStudyPage.studyMap[sfc.note].recommended}"/>
                          </div>
                        </ice:column>
                        <ice:column>
                          <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloatWrap">
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat1">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" 
                                              value="#{editstudybundle.notesTypeLabel}" 
                                              title="#{editstudybundle.notesTypeHelpHeading} - #{editstudybundle.notesTypeHelp}"/>
                              <ice:inputText maxlength="255" binding="#{EditStudyPage.inputNoteType}" id="input_notesInformationType"
                                             value="#{currentRow.type}"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.notesInformationType].templateField.controlledVocabulary)}"
                                             requiredMessage="This field is required."
                                             required="#{EditStudyPage.studyMap[sfc.notesInformationType].required and EditStudyPage.validateRequired}"
                                             styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                             <ice:selectOneMenu immediate="false" id="SelectOneNotesType"
                                                binding="#{EditStudyPage.inputStudyNoteType}"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.notesInformationType].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.notesInformationType].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.type}"  
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.notesInformationType].templateField.controlledVocabulary.selectItems}"/>
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                             </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_notesInformationType"/>
                              <ice:message styleClass="errorMessage" for="SelectOneNotesType"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat2 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.notesSubjectLabel}" title="#{editstudybundle.notesSubjectHelpHeading} - #{editstudybundle.notesSubjectHelp}"/>
                              <ice:inputText id="input_notesInformationSubject"
                                             maxlength="255"
                                             binding="#{EditStudyPage.inputNoteSubject}"
                                             value="#{currentRow.subject}"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.notesInformationSubject].templateField.controlledVocabulary)}"
                                             validator="#{EditStudyPage.validateStudyNote}"
                                             required="#{EditStudyPage.studyMap[sfc.notesInformationSubject].required and EditStudyPage.validateRequired}" 
                                             requiredMessage="This field is required."
                                             styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                             <ice:selectOneMenu immediate="false" id="SelectOneNotesSubject"
                                                binding="#{EditStudyPage.inputStudyNoteSubject}"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.notesInformationSubject].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.notesInformationSubject].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.subject}"  
                                           validator="#{EditStudyPage.validateStudyNote}"
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.notesInformationSubject].templateField.controlledVocabulary.selectItems}"/>
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                             </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_notesInformationSubject"/>
                              <ice:message styleClass="errorMessage" for="SelectOneNotesSubject"/>
                            </div>
                            <div jsfc="ice:panelGroup" styleClass="vdcEditStudyFieldFloat3 vdcEditStudyGroupField">
                              <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{editstudybundle.notesTextLabel}" title="#{editstudybundle.notesTextHelpHeading} - #{editstudybundle.notesTextHelp}"/>
                              <ice:inputText id="input_notesText" size="90"
                                             binding="#{EditStudyPage.inputNoteText}"
                                             validator="#{EditStudyPage.validateStudyNote}"
                                             rendered="#{empty(EditStudyPage.studyMap[sfc.notesText].templateField.controlledVocabulary)}"
                                             value="#{currentRow.text}"
                                             required="#{EditStudyPage.studyMap[sfc.note].required and EditStudyPage.validateRequired}" requiredMessage="This field is required."
                                             styleClass="formHtmlEnabled">
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                              </ice:inputText>
                              <ice:selectOneMenu immediate="false" id="SelectOneNotesText"
                                                binding="#{EditStudyPage.inputStudyNoteText}"
                                          rendered="#{!empty(EditStudyPage.studyMap[sfc.notesText].templateField.controlledVocabulary)}"
                                          required="#{EditStudyPage.studyMap[sfc.note].required and EditStudyPage.validateRequired}" 
                                           value="#{currentRow.text}"  
                                           validator="#{EditStudyPage.validateStudyNote}"
                                           requiredMessage="This field is required." >
                                <f:selectItem itemLabel="No Value" itemValue=""/>
                                <f:selectItems value="#{EditStudyPage.studyMap[sfc.notesText].templateField.controlledVocabulary.selectItems}"/>
                                <o:validator validatorId="XhtmlValidator" disabled="#{!EditStudyPage.validateRequired}"/>
                             </ice:selectOneMenu>
                              <ice:message styleClass="errorMessage" for="input_notesText"/>
                              <ice:message styleClass="errorMessage" for="SelectOneNotesText"/>
                            </div>
                          </div>
                        </ice:column>
                        <ice:column>
                          <ice:commandButton image="/resources/images/icon_add.gif" actionListener="#{EditStudyPage.addRow}"/>
                          <ice:commandButton rendered="#{EditStudyPage.dataTableNotes.rowCount gt 1}" image="/resources/images/icon_remove.gif" actionListener="#{EditStudyPage.removeRow}" />
                        </ice:column>
                      </ice:dataTable>
                    </ice:column>
                  </ice:dataTable>              
              </ice:panelGroup>

                <div jsfc="ice:panelGroup" styleClass="vdcTextRight dvnFormPadding dvnFormMargin">
                  <ice:commandButton binding="#{EditStudyPage.saveCommand2}" id="saveCommand2" value="Save" actionListener="#{EditStudyPage.openPopup}"/>
                  <ice:commandButton id="cancelCommand" value="Cancel" immediate="true" action="#{EditStudyPage.cancel}"/>
                </div>
              </div>
          </div>
        </div>
      </ice:form>

    </ui:define>
  </ui:composition>
</body>
</html>
