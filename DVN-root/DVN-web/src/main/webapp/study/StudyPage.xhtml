<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:ui="http://java.sun.com/jsf/facelets"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core"
      xmlns:ice="http://www.icesoft.com/icefaces/component">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
  </head>

<body>
  <ui:composition template="/template_study.xhtml">
    <ui:param name="pageTitle" value="#{studyPage.studyUI.metadata.title} - #{VDCRequest.dataversePageTitle}"/>
    <ui:define name="metadata">
        <f:metadata>
            <f:viewParam name="studyId" value="#{studyPage.studyId}"/>
            <f:viewParam name="globalId" value="#{studyPage.globalId}"/>
            <f:viewParam name="versionNumber" value="#{studyPage.versionNumber}"/>
            <f:viewParam name="tab" value="#{studyPage.tab}"/>
            <f:viewParam name="studyListingIndex" value="#{VDCRequest.studyListingIndex}"/>          
            <f:event type="preRenderView" listener="#{studyPage.preRenderView}" />
            <!-- The following are for the StudyCommmentsFragment
                TODO: there shouldn't be a need to initialize this unless we go to the comments tab  -->
            <f:viewParam name="studyId" value="#{StudyCommentsFragment.studyId}"/>
            <f:viewParam name="versionNumber" value="#{StudyCommentsFragment.versionNumber}"/>            
            <f:event type="preRenderView" listener="#{StudyCommentsFragment.preRenderView}" />
        </f:metadata>  
    </ui:define>     
    <ui:define name="body">
       <script type="text/javascript">
                    // <![CDATA[
                    function toggleMoreInfo(moreInfo) {
                        jQuery(moreInfo).next().slideToggle(500);
                        var toggleLabelText = (jQuery(moreInfo).children('span.iceOutTxt').text() == 'View Data Citation [+]') ? 'Collapse Data Citation [-]' : 'View Data Citation [+]';
                        jQuery(moreInfo).children('span.iceOutTxt').text(toggleLabelText);
                        return false;
                    };

                    function toggleTermsofUse(termsofUse) {
                        jQuery(termsofUse).next().slideToggle(500);
                        var toggleLabelText = (jQuery(termsofUse).children('span.iceOutTxt').text() == 'View Terms of Use [+]') ? 'Collapse Terms of Use [-]' : 'View Terms of Use [+]';
                        jQuery(termsofUse).children('span.iceOutTxt').text(toggleLabelText);
                        return false;
                    };

                    function getElementsByClassName( strClassName, obj ) {
                        var ar = arguments[2] || new Array();
                        var re = new RegExp("\\b" + strClassName + "\\b", "g");
                        if ( re.test(obj.className) ) {
                            ar.push( obj );
                        }
                        for ( var i = 0; i < obj.childNodes.length; i++ )
                            getElementsByClassName( strClassName, obj.childNodes[i], ar );
                        return ar;
                    }

                    function toggleCheckBoxes( elem ) {
                        var catCBs = getElementsByClassName("catCheckBox", document.body);
                        var studyCBs = getElementsByClassName("studyCheckBox", document.body);
                        var fileCBs = getElementsByClassName("fileCheckBox", document.body);

                        if (elem.id.indexOf('fileCheckBox') > -1) {
                            if (!elem.checked) {
                                fileCatIndex = findCatIndex(elem.id);
                                // deselect corresponding catCheckBox and studyCheckBox
                                for (var i = 0; i < catCBs.length; i++) {
                                    if ( fileCatIndex == findCatIndex(catCBs[i].id) )  {
                                        catCBs[i].checked = elem.checked;
                                    }
                                }
                                for (var i = 0; i < studyCBs.length; i++) {
                                    studyCBs[i].checked = elem.checked;
                                }
                            }
                        } else if (elem.id.indexOf('catCheckBox') > -1) {
                            catIndex = findCatIndex(elem.id);
                            for (var i = 0; i < fileCBs.length; i++) {
                                if ( !fileCBs[i].disabled && catIndex == findCatIndex(fileCBs[i].id)  )  {
                                    fileCBs[i].checked = elem.checked;
                                }
                            }
                            if (!elem.checked) {
                                // deselect studyCheckBox
                                for (var i = 0; i < studyCBs.length; i++) {
                                    studyCBs[i].checked = elem.checked;
                                }
                            }

                        } else if (elem.id.indexOf('studyCheckBox') > -1) {
                            for (var i = 0; i < catCBs.length; i++) {
                                if ( !catCBs[i].disabled ) {
                                    catCBs[i].checked = elem.checked;
                                }
                            }
                            for (var i = 0; i < fileCBs.length; i++) {
                                if ( !fileCBs[i].disabled ) {
                                    fileCBs[i].checked = elem.checked;
                                }
                            }
                        }
                        if (elem.checked) {
                             jQuery('input[id$=downloadAllButton]').prop("disabled", false);
                        } else {
                            checkDownloadAllButton();
                        }

                    }

                    function checkDownloadAllButton() {
                        var fileCBs = getElementsByClassName("fileCheckBox", document.body);
                        var anySelected = false;

                        for (var i = 0; i < fileCBs.length; i++) {
                            if ( fileCBs[i].checked )  {
                                anySelected = true;
                            }
                        }

                        if (anySelected) {
                            jQuery('input[id$=downloadAllButton]').prop("disabled", false);
                            return false;
                        } else {
                            jQuery('input[id$=downloadAllButton]').prop("disabled", true);
                            return true;
                        }
                    }

                    function findCatIndex(id) {
                        startIndex = id.indexOf("catDataTable:") + 13;
                        endIndex = id.indexOf(":", startIndex);
                        return id.substring(startIndex, endIndex);
                    }



                    function viewStudyVersionDifferences() {
                        var versionNumberStr = "";
                        var checkedCount = 0;
                        var versionCBs = getElementsByClassName("versionCheckBox", document.body);
                        for (var i = 0; i < versionCBs.length; i++) {
                            if ( versionCBs[i].checked ) {
                                if (versionNumberStr != "") {
                                    versionNumberStr = versionNumberStr + ",";
                                }
                                versionNumberStr = versionNumberStr + versionCBs[i].previousSibling.value;
                                checkedCount++;
                            }
                        }
                        if (checkedCount != 2) {
                            alert ("You must select exactly two versions to see the differences.");
                            return false;
                        }
                        window.location.href = "/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyVersionDifferencesPage.xhtml?studyId=#{studyPage.studyUI.study.id}&versionNumberList=" + versionNumberStr + "&versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}" + "&selectedTab=versions";

                        return false;
                    }

                    function downloadSingleFile(fileDropdown) {
                        downloadUrl = fileDropdown.options[ fileDropdown.selectedIndex ].value;
                        fileDropdown.selectedIndex = 0;
                        if (downloadUrl != "") {
                            downloadFile(downloadUrl + "&versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}");
                        }
                    }

                    function downloadSelectedFiles() {
                        jQuery('input[id$=hiddenDownloadButton]').click();
                    }
                    
                    function checkTermsOfUse() {
                        if (doDownload()) {
                            window.location.href = "/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?studyId=#{studyPage.studyUI.study.id}&versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}" + "&checkTermsOfUse=true&cid=#{javax.enterprise.context.conversation.id}";
                        } 
                    }
                    
                    // this method will either download a single zip or create links for multiple zip files in the popup
                    // if multiple links are created, it returns true, to signify to calling methods that the popup needs to be displayed
                    function doDownload() {                  
                        var fileNumber = 100; // set file number to 100 files
                        var zipFileSize = 524288000; // set zip file size to 500MB
                        //var fileNumber = 5; 
                        //var zipFileSize = 1048576;

                        var fileSize =0;
                        var j = 0;
                        var numb = 0;
                        var fileIdStr = ""
                        var bSingleZipfile= true;
                        var fileCBs = getElementsByClassName("fileCheckBox", document.body);
                        var popBodyContent="";
                        
                        var lastCheckedIndex = 0;
                        for (var i = 0; i < fileCBs.length; i++) {
                            if ( fileCBs[i].checked ) lastCheckedIndex = i;
                        }
                        
                        for (var i = 0; i < fileCBs.length; i++) {
                            if ( fileCBs[i].checked ) {
                                if (j < fileNumber) {
                                    if (fileIdStr != "") {
                                        fileIdStr = fileIdStr + ",";
                                    }
                                    j++;
                                    fileSize+= parseInt(fileCBs[i].previousSibling.previousSibling.value);
                                    if (fileSize >= zipFileSize) {
                                        bSingleZipfile = false;
                                        if (fileIdStr != "") numb++;
                                        popBodyContent+= attachToPopBodyContent(fileIdStr, numb);
                                        j = 1;
                                        fileSize = parseInt(fileCBs[i].previousSibling.previousSibling.value);
                                        fileIdStr = fileCBs[i].previousSibling.value;
                                        if (i == lastCheckedIndex) {
                                            numb++;
                                            popBodyContent+= attachToPopBodyContent(fileIdStr, numb);
                                            break;
                                        }
                                    }
                                    else
                                        fileIdStr = fileIdStr + fileCBs[i].previousSibling.value;
                                    if (i == lastCheckedIndex) {
                                        numb++;
                                        popBodyContent+= attachToPopBodyContent(fileIdStr, numb);
                                        break;
                                    }
                                }
                                else {
                                    bSingleZipfile = false;
                                    numb++;
                                    popBodyContent+= attachToPopBodyContent(fileIdStr, numb);
                                    j = 1;
                                    fileSize= 0;
                                    fileIdStr = fileCBs[i].previousSibling.value;
                                    if (i == lastCheckedIndex) {
                                        numb++;
                                        popBodyContent+= attachToPopBodyContent(fileIdStr, numb);
                                        break;
                                    }
                                }
                            }
                        }
                        if (fileIdStr == "") {
                            alert ("No files selected");
                            return false;
                        
                        }
                        
                        if (bSingleZipfile) {
                            downloadFile("/FileDownload/study_#{studyPage.studyUI.study.studyId}.zip?fileId=" + fileIdStr + "&versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}" + "#{studyPage.xff}");
                            return false;
                        } else {
                            jQuery('table[id$=autoCentZipContent] #dvnMultipleZipPopupScrollBox').append(popBodyContent).after("<br/><span class='iceOutTxt'>Total Number of ZIP Archives: " + numb + "</span>");
                            return true;
                        }
                    }
                    
                    function attachToPopBodyContent(fileIdStrIn, zipNumber) {
                        if (fileIdStrIn == "") return "";
                        if (fileIdStrIn.endsWith(",")) fileIdStrIn= fileIdStrIn.substring(0,fileIdStrIn.length-1);
                        return "<a href='/dvn#{VDCRequest.currentVDCURL}/FileDownload/study_#{studyPage.studyUI.study.studyId}.zip?fileId=" + fileIdStrIn + "&versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}" + "#{studyPage.xff}'><span class='iceOutTxt'>Download ZIP Archive "+zipNumber+ "</span></a><br/>";
                    }
                    
                    function downloadFile(fileUrl) {
                            self.location.href = "/dvn#{VDCRequest.currentVDCURL}" + fileUrl;
                    }
                    // ]]>
                </script>
      <f:loadBundle basename="StudyBundle" var="studybundle"/>
      <ice:form id="studyForm" rendered="#{!studyPage.deaccessionedView}">
          <ice:inputHidden id="vdcId" value="#{VDCRequest.currentVDCId}"/>
          <input type="hidden" value="StudyPage" name="pageName"/>
          <ice:inputHidden id="studyId" value="#{studyPage.studyId}"/>
          <ice:inputHidden id="globalId" value="#{studyPage.globalId}" />
          <ice:inputHidden id="slIndex" value="#{VDCRequest.studyListingIndex}"/>
          <div class="dvn_section">
            <div jsfc="ice:panelGroup" styleClass="dvnMsgBlockRound dvnWarningMessage dvnMessageLink" rendered="#{studyPage.studyUI.study.deaccessionedVersion != null and studyPage.studyUI.userAuthorizedToEdit and !VDCSession.loginBean.curatorOrAbove and !VDCSession.loginBean.networkAdmin}">
                <div class="dvnMsgBlockContainer">
                    <ice:outputFormat value="#{bundlePageInfo.deaccessionedStudyDetailContributorHelp}" escape="false">
                        <f:param value="#{VDCRequest.currentVDCURL}" />
                        <f:param value="#{studyPage.studyUI.study.id}"/>
                    </ice:outputFormat>
                </div>
            </div>
            <div jsfc="ice:panelGroup" styleClass="dvnMsgBlockRound dvnWarningMessage dvnMessageLink" rendered="#{studyPage.studyUI.study.deaccessionedVersion != null and (VDCSession.loginBean.curatorOrAbove or VDCSession.loginBean.networkAdmin)}">
                <div class="dvnMsgBlockContainer">
                    <ice:outputFormat value="#{bundlePageInfo.deaccessionedStudyDetailCuratorHelp}" escape="false">
                        <f:param value="#{VDCRequest.currentVDCURL}" />
                        <f:param value="#{studyPage.studyUI.study.id}"/>
                    </ice:outputFormat>
                </div>
            </div>
            <div class="dvnstudytitleblock">
                <div class="dvnstudyadminboxfloat">
                    <div jsfc="ice:panelGroup" styleClass="dvnstudypreviouslisting" rendered="#{!empty VDCRequest.studyListingIndex}">
                        <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/StudyListingPage.xhtml?studyListingIndex=#{VDCRequest.studyListingIndex}">
                            <ice:outputText value="&lt; View Previous Study Listing"/>
                        </ice:outputLink>
                    </div>
                    <div jsfc="ice:panelGroup" styleClass="dvnstudyadminbox" rendered="#{VDCSession.loginBean.user!=null and studyPage.studyUI.userAuthorizedToEdit}">
                        <div jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.study.studyLock==null and !VDCRequest.readOnlyDatabase}">
                            <ul class="dvnstudyadminlinksL">
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.studyVersion != studyPage.studyUI.study.latestVersion and (studyPage.studyUI.studyVersion.released or studyPage.studyUI.studyVersion.deaccessioned)}">
                                    <li class="dvnStudyEditDisableMsg">
                                        <ice:outputText nospan="true" value="Editing is disabled because a draft study version was created. Go to the "/>
                                        <ice:outputLink styleClass="dvnStudyEditDisableLink" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?studyId=#{studyPage.studyUI.study.id}&amp;versionNumber=#{studyPage.studyUI.study.latestVersion.versionNumber}">
                                            <ice:outputText nospan="true" value="draft study version"/>
                                        </ice:outputLink>
                                        <ice:outputText nospan="true" value=" to edit this study."/>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.studyVersion == studyPage.studyUI.study.latestVersion}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.editStudyText} - #{studybundle.editStudyTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/EditStudyPage.xhtml?studyId=#{studyPage.studyUI.study.id}&amp;tab=catalog#{VDCRequest.studyListingIndexAsParameter}">
                                            <ice:outputText nospan="true" value="#{studybundle.editStudyText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.studyVersion.numberOfFiles!=null and studyPage.studyUI.studyVersion == studyPage.studyUI.study.latestVersion}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.editFilesText} - #{studybundle.editFilesTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/EditStudyFilesPage.xhtml?studyId=#{studyPage.studyUI.study.id}&amp;#{VDCRequest.studyListingIndexAsParameter}">
                                            <ice:outputText nospan="true" value="#{studybundle.editFilesText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.studyVersion == studyPage.studyUI.study.latestVersion}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.addText} - #{studybundle.addTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/AddFilesPage.xhtml?studyId=#{studyPage.studyUI.study.id}#{VDCRequest.studyListingIndexAsParameter}">
                                            <ice:outputText nospan="true" value="#{studybundle.addText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.studyVersion.inReview or studyPage.studyUI.studyVersion.draft}">
                                    <li>
                                        <ice:commandLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="Edit Study Version Notes - #{studybundle.editVersionNotesTip}" binding="#{studyPage.editStudyVersionNotesLink}" actionListener="#{studyPage.editStudyVersionNotes}">
                                            <ice:outputText nospan="true" value="Edit Study Version Notes"/>
                                        </ice:commandLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.userAuthorizedToRelease and (studyPage.studyUI.studyVersion.inReview or studyPage.studyUI.studyVersion.draft)}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="Release - #{studybundle.releaseTip}" rendered="#{studyPage.studyUI.study.releasedVersion != null}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyVersionDifferencesPage.xhtml">
                                            <f:param name="studyId" value="#{studyPage.studyUI.study.id}"/>
                                            <f:param name="versionNumberList" value="#{studyPage.studyUI.study.releasedVersion.versionNumber},#{studyPage.studyUI.study.latestVersion.versionNumber}"/>
                                            <f:param name="actionMode" value="confirmRelease"/>
                                            <f:param name="versionNumber" value="#{studyPage.studyUI.study.latestVersion.versionNumber}"/>
                                            <ice:outputText nospan="true" value="Release"/>
                                        </ice:outputLink>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="Release - #{studybundle.releaseTip}" rendered="#{studyPage.studyUI.study.deaccessioned}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyVersionDifferencesPage.xhtml">
                                            <f:param name="studyId" value="#{studyPage.studyUI.study.id}"/>
                                            <f:param name="versionNumberList" value="#{studyPage.studyUI.study.deaccessionedVersion.versionNumber},#{studyPage.studyUI.study.latestVersion.versionNumber}"/>
                                            <f:param name="actionMode" value="confirmRelease"/>
                                            <f:param name="versionNumber" value="#{studyPage.studyUI.study.latestVersion.versionNumber}"/>
                                            <ice:outputText nospan="true" value="Release"/>
                                        </ice:outputLink>
                                        <ice:commandLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="Release - #{studybundle.releaseTip}" rendered="#{studyPage.studyUI.study.releasedVersion == null and !studyPage.studyUI.study.deaccessioned }" actionListener="#{studyPage.confirmReleased}">
                                            <ice:outputText nospan="true" value="Release"/>
                                        </ice:commandLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{! studyPage.studyUI.userAuthorizedToRelease and studyPage.studyUI.studyVersion.draft}">
                                    <li>
                                        <ice:commandLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="Submit For Review - #{studybundle.reviewTip}" actionListener="#{studyPage.confirmSubmitForReview}">
                                            <ice:outputText nospan="true" value="Submit For Review"/>
                                        </ice:commandLink>
                                    </li>
                                </span>
                            </ul>
                            <ul class="dvnstudyadminlinksR">
                                <span jsfc="ice:panelGroup" rendered="#{(studyPage.studyUI.userCuratorOrAdmin or  VDCSession.loginBean.networkAdmin)}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.permissionsText} - #{studybundle.permissionsTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPermissionsPage.xhtml?studyId=#{studyPage.studyUI.study.id}#{VDCRequest.studyListingIndexAsParameter}&amp;versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}">
                                            <ice:outputText nospan="true" value="#{studybundle.permissionsText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{(VDCSession.loginBean.curator or VDCSession.loginBean.admin or  VDCSession.loginBean.networkAdmin) and (VDCRequest.currentVDCId != null) }">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.templateText} - #{studybundle.templateTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/TemplateFormPage.xhtml?studyVersionId=#{studyPage.studyUI.studyVersion.id}#{VDCRequest.studyListingIndexAsParameter}">
                                            <ice:outputText nospan="true" value="#{studybundle.templateText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{(studyPage.studyUI.userCuratorOrAdmin or VDCSession.loginBean.networkAdmin) and studyPage.studyUI.visualization}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.editSetUpVizText} - #{studybundle.editSetUpVizTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/SetUpDataExplorationPage.xhtml?studyId=#{studyPage.studyUI.study.id}">
                                            <ice:outputText nospan="true" value="#{studybundle.editSetUpVizText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{(studyPage.studyUI.userCuratorOrAdmin or VDCSession.loginBean.networkAdmin) and studyPage.studyUI.studyVersion.released}">
                                    <li>
                                        <ice:outputLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.removeText} - #{studybundle.removeTip}" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/DeaccessionStudyPage.xhtml?studyId=#{studyPage.studyUI.study.id}#{VDCRequest.studyListingIndexAsParameter}">
                                            <ice:outputText nospan="true" value="#{studybundle.removeText}"/>
                                        </ice:outputLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{studyPage.studyUI.studyVersion.draft}">
                                    <li>
                                        <ice:commandLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.deleteDraftText} - #{studybundle.deleteDraftTip}" actionListener="#{studyPage.confirmDraftDeleteAction}">
                                            <ice:outputText nospan="true" value="#{studybundle.deleteDraftText}"/>
                                        </ice:commandLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{ studyPage.studyUI.studyVersion.inReview}">
                                    <li>
                                        <ice:commandLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.deleteReviewText} - #{studybundle.deleteReviewTip}" actionListener="#{studyPage.confirmInreviewDeleteAction}">
                                            <ice:outputText nospan="true" value="#{studybundle.deleteReviewText}"/>
                                        </ice:commandLink>
                                    </li>
                                </span>
                                <span jsfc="ice:panelGroup" rendered="#{VDCSession.loginBean.networkAdmin and (!studyPage.studyUI.studyVersion.workingCopy or studyPage.studyUI.studyVersion.versionNumber != 1)}">
                                    <li>
                                        <ice:commandLink styleClass="dvnInlineHelpLabel dvnInlineHelpTip" title="#{studybundle.destroyText} - #{studybundle.destroyTip}" actionListener="#{studyPage.confirmStudyDestroyAction}">
                                            <ice:outputText nospan="true" value="#{studybundle.destroyText}"/>
                                        </ice:commandLink>
                                    </li>
                                </span>
                            </ul>
                        </div>
                        <div jsfc="ice:panelGroup" rendered="#{!(studyPage.studyUI.study.studyLock==null)  and !VDCRequest.readOnlyDatabase}">
                            <ice:outputText styleClass="vdcStudyStatus" value="Currently unavailable for editing because file upload is in progress. " rendered="#{studyPage.studyUI.userAuthorizedToEdit and !(studyPage.studyUI.study.studyLock==null)}"/>
                            <ice:outputLink styleClass="vdcStudyStatus" value="/dvn#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?globalId=#{studyPage.studyUI.study.globalId}&amp;versionNumber=-1&amp;tab=#{studyPage.tab}#{VDCRequest.studyListingIndexAsParameter}" rendered="#{studyPage.studyUI.userAuthorizedToEdit and !(studyPage.studyUI.study.studyLock==null)}">
                                <ice:outputText nospan="true" value="Refresh"/>
                            </ice:outputLink>
                        </div>
                        <div jsfc="ice:panelGroup" rendered="#{VDCRequest.readOnlyDatabase}">
                            <ice:outputText styleClass="vdcStudyStatus" value="Currently unavailable for editing because database is in read-only state. " rendered="#{studyPage.studyUI.userAuthorizedToEdit }"/>
                        </div>
                    </div>
                    <div jsfc="ice:panelGroup" styleClass="dvnstudyadminbox" rendered="#{VDCSession.loginBean.user==null and studyPage.studyUI.study.owner.allowRegisteredUsersToContribute and studyPage.studyUI.study.owner.allowContributorsEditAll}">
                        <div jsfc="ice:panelGroup">
                            <div>
                                <ice:outputText value="Wiki Dataverse"/>
                            </div>
                            <ice:commandLink action="#{LoginWorkflowBean.beginContributorWorkflow}" title="Create an account">
                                <ice:outputText value="Create an account"/>
                            </ice:commandLink>
                            to add your own study or contribute to existing studies in this dataverse. Already have an account? &#160;
                            <ice:outputLink value="/dvn#{VDCRequest.currentVDCURL}/faces/login/LoginPage.xhtml?clearWorkflow=true" title="Log In">
                                <ice:outputText value="Log In"/>
                            </ice:outputLink>
                        </div>
                    </div>
                </div>
                <ui:include src="StudyTitleFragment.xhtml">
                    <ui:param name="studyUI" value="#{studyPage.studyUI}"/>
                    <ui:param name="displayReleaseLink" value="true"/>
                    <ui:param name="displayVersionInfo" value="true"/>
                    <ui:param name="displayStatusBox" value="true"/>
                </ui:include>
            </div>
            <div class="dvn_sectionBoxNoBorders">
                <ice:panelTabSet id="tabSet1" styleClass="dvnTabs" binding="#{studyPage.tabSet1}" tabChangeListener="#{studyPage.processTabChange}">
                        <ice:panelTab id="catalog" label="Cataloging Information" url="#{VDCRequest.currentVDCURL}/faces/study/StudyPage.xhtml?globalId=#{studyPage.studyUI.study.globalId}&amp;tab=catalog#{studyPage.studyListingIndexAsParameter}" >
                        <div jsfc="ice:panelGroup" id="layoutPanel1" panelLayout="flow">
                            <ice:panelGrid id="panelGridHowToCite" styleClass="dvnhowtocitetable" cellpadding="0" cellspacing="0"
                                           columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" width="100%">
                                <div jsfc="ice:panelGroup">
                                    <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataCitationLabel}" title="#{studybundle.dataCitationHeading} - #{studybundle.dataCitationHelp}"/>
                                </div>
                                <div jsfc="ice:panelGroup" styleClass="dvnhowtocitecitationfloat">
<script type="text/javascript">
    jQuery(document).ready(function(){
        jQuery('.dvnstudycitation').hide();
        jQuery('.dvnstudycitationDefault').show();

        jQuery('#dvnCitationSelector').change(function() {
            jQuery('.dvnstudycitation').hide();
            jQuery('#' + 'dvnStudyCitation' + jQuery(this).val()).show();
        });
    });
</script>
                                    <div>
                                        <ice:graphicImage value="/resources/images/icon_info.gif" styleClass="dvn_icon"/>
                                        <ice:outputText value=" &#60;strong&#62;If you use these data, please add the following citation to your scholarly references.&#60;/strong&#62; &#60;a href='http://thedata.org/citation' target='_blank'&#62;Why cite?&#60;/a&#62;" escape="false"/>
                                    </div>
                                    <textarea readonly="readonly" rows="3" id="dvnStudyCitationPrint" class="dvnstudycitation dvnstudycitationDefault"><ice:outputText value="#{studyPage.studyUI.metadata.textCitation}" nospan="true"></ice:outputText></textarea>
                                    <textarea readonly="readonly" rows="3" id="dvnStudyCitationWeb" class="dvnstudycitation"><ice:outputText value="#{studyPage.studyUI.metadata.webCitation}" nospan="true"></ice:outputText></textarea>
                                    <label for="citationformat">Citation Format</label> <select id="dvnCitationSelector"><option value="Print" selected="selected">Print</option><option value="Web">Web</option></select>
                                </div>
                                
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.replicationForLabel}" title="#{studybundle.replicationForHelpHeading} - #{studybundle.replicationForHelp}" rendered="#{studyPage.studyUI.replicationFor != '' and studyPage.studyUI.replicationFor != null}"/>
                                <div jsfc="ice:panelGroup" styleClass="dvnhowtocitecitationfloat" rendered="#{!empty studyPage.studyUI.replicationFor}">
                                    <div class="dvn_padBot">
                                        <ice:graphicImage value="/resources/images/icon_info.gif" styleClass="dvn_icon"/>
                                        <ice:outputText value=" Results found in this publication can be replicated using these data."/>
                                    </div>
                                    <ice:outputText value="#{studyPage.studyUI.replicationFor}" rendered="#{!empty studyPage.studyUI.replicationFor}" escape="false"/>
                                </div>
                                
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.relatedPublicationsLabel}" title="#{studybundle.relatedPublicationsHelpHeading} - #{studybundle.relatedPublicationsHelp}" rendered="#{studyPage.studyUI.relPublications != '' and studyPage.studyUI.relPublications != null}"/>
                                <div jsfc="ice:panelGroup" styleClass="dvnhowtocitecitationfloat" rendered="#{!empty studyPage.studyUI.relPublications}">
                                    <ice:outputText id="text23" value="#{studyPage.studyUI.relPublications}" rendered="#{!empty studyPage.studyUI.relPublications }" escape="false"/>
                                </div>
                            </ice:panelGrid>
                            <div jsfc="ice:panelGroup"  styleClass="vdcStudyInfoHeader">
                                <ice:outputText  value="Data Citation Details"/>
                                <ice:commandButton id="commandButtonCitationInfoContract" image="/resources/images/icon_expand.gif" title="Hide fields in this section" rendered="#{studyPage.studyUI.citationInformationPanelIsRendered}" actionListener="#{studyPage.updateCitationInfoDisplay}"/>
                                <ice:commandButton id="commandButtonCitationInfoExpand" image="/resources/images/icon_contract.gif" title="Show fields in this section" rendered="#{!studyPage.studyUI.citationInformationPanelIsRendered}" actionListener="#{studyPage.updateCitationInfoDisplay}"/>
                            </div>
                            <ice:panelGrid binding="#{studyPage.citationInformationPanel}" id="panelGridCitationInfo" cellpadding="0" cellspacing="0"
                                           columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" width="100%" rendered="#{studyPage.studyUI.citationInformationPanelIsRendered}">
                                <!-- REMOVE CODE 3 -->
                                
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.titleLabel}" title="#{studybundle.titleHelpHeading} - #{studybundle.titleHelp}"/>
                                <ice:outputText id="text0" value="#{studyPage.studyUI.metadata.title}"/>
                                
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.subtitleLabel}" title="#{studybundle.subtitleHelpHeading} - #{studybundle.subtitleHelp}" rendered="#{studyPage.studyUI.metadata.subTitle!='' and studyPage.studyUI.metadata.subTitle!=null}"/>
                                <ice:outputText id="text1" value="#{studyPage.studyUI.metadata.subTitle}" rendered="#{!empty studyPage.studyUI.metadata.subTitle}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.studyGlobalIdLabel}" title="#{studybundle.studyGlobalIdHelpHeading} - #{studybundle.studyGlobalIdHelp}"/>
                                <ice:outputText id="text2" value="#{studyPage.studyUI.study.globalId}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.otherIdLabel}" title="#{studybundle.otheridHelpHeading} - #{studybundle.otheridHelp}" rendered="#{studyPage.studyUI.otherIds != ''}"/>
                                <ice:outputText id="text3" value="#{studyPage.studyUI.otherIds}" rendered="#{!empty studyPage.studyUI.otherIds}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.authorLabel}" title="#{studybundle.authorHelpHeading} - #{studybundle.authorHelp}" rendered="#{studyPage.studyUI.authorAffiliations != ''}"/>
                                <ice:outputText id="text4" value="#{studyPage.studyUI.authorAffiliations}" rendered="#{!empty studyPage.studyUI.authorAffiliations}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.producerLabel}" title="#{studybundle.producerHelpHeading} - #{studybundle.producerHelp}" rendered="#{studyPage.studyUI.producers != ''}"/>
                                <ice:outputText id="text5" value="#{studyPage.studyUI.producers}" rendered="#{!empty studyPage.studyUI.producers}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.productionDateLabel}" title="#{studybundle.productionDateHelpHeading} - #{studybundle.productionDateHelp}" rendered="#{studyPage.studyUI.metadata.productionDate != '' and studyPage.studyUI.metadata.productionDate != null}"/>
                                <ice:outputText id="text6" value="#{studyPage.studyUI.productionDate}" rendered="#{!empty studyPage.studyUI.metadata.productionDate}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.productionPlaceLabel}" title="#{studybundle.productionPlaceHelpHeading} - #{studybundle.productionPlaceHelp}" rendered="#{studyPage.studyUI.metadata.productionPlace != '' and studyPage.studyUI.metadata.productionPlace != null}"/>
                                <ice:outputText id="text7" value="#{studyPage.studyUI.metadata.productionPlace}" rendered="#{!empty studyPage.studyUI.metadata.productionPlace}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.softwareLabel}" title="#{studybundle.softwareHelpHeading} - #{studybundle.softwareHelp}" rendered="#{studyPage.studyUI.software != '' and studyPage.studyUI.software != null}"/>
                                <ice:outputText id="text8" value="#{studyPage.studyUI.software}" rendered="#{!empty studyPage.studyUI.software}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.fundingAgencyLabel}" title="#{studybundle.fundingAgencyHelpHeading} - #{studybundle.fundingAgencyHelp}" rendered="#{studyPage.studyUI.metadata.fundingAgency != '' and studyPage.studyUI.metadata.fundingAgency != null}"/>
                                <ice:outputText id="text9" value="#{studyPage.studyUI.metadata.fundingAgency}" rendered="#{!empty studyPage.studyUI.metadata.fundingAgency}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.grantNumberLabel}" title="#{studybundle.grantNumberHelpHeading} - #{studybundle.grantNumberHelp}" rendered="#{studyPage.studyUI.grants != ''}"/>
                                <ice:outputText id="text10" value="#{studyPage.studyUI.grants}" rendered="#{!empty studyPage.studyUI.grants}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.distributorLabel}" title="#{studybundle.distributorHelpHeading} - #{studybundle.distributorHelp}" rendered="#{studyPage.studyUI.distributors != ''}"/>
                                <ice:outputText id="text11" value="#{studyPage.studyUI.distributors}" rendered="#{!empty studyPage.studyUI.distributors}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.distributorContactLabel}" title="#{studybundle.distributorContactHelpHeading} - #{studybundle.distributorContactHelp}" rendered="#{studyPage.studyUI.distributorContact != ''}"/>
                                <ice:outputText id="text12" value="#{studyPage.studyUI.distributorContact}" rendered="#{!empty studyPage.studyUI.distributorContact}"  escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.distributionDateLabel}" title="#{studybundle.distributionDateHelpHeading} - #{studybundle.distributionDateHelp}" rendered="#{studyPage.studyUI.metadata.distributionDate != '' and studyPage.studyUI.metadata.distributionDate != null}"/>
                                <ice:outputText id="text13" value="#{studyPage.studyUI.distributionDate}" rendered="#{!empty studyPage.studyUI.metadata.distributionDate}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.depositorLabel}" title="#{studybundle.depositorHelpHeading} - #{studybundle.depositorHelp}" rendered="#{studyPage.studyUI.metadata.depositor != '' and studyPage.studyUI.metadata.depositor != null}"/>
                                <ice:outputText id="text14" value="#{studyPage.studyUI.metadata.depositor}" rendered="#{!empty studyPage.studyUI.metadata.depositor}"/>
                                
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.depositDateLabel}" title="#{studybundle.depositDateHelpHeading} - #{studybundle.depositDateHelp}" rendered="#{studyPage.studyUI.metadata.dateOfDeposit != '' and studyPage.studyUI.metadata.dateOfDeposit != null}"/>
                                <ice:outputText id="text15" value="#{studyPage.studyUI.dateOfDeposit}" rendered="#{!empty studyPage.studyUI.metadata.dateOfDeposit}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.seriesLabel}" title="#{studybundle.seriesHelpHeading} - #{studybundle.seriesHelp}" rendered="#{studyPage.studyUI.series != ''}"/>
                                <ice:outputText id="text16" value="#{studyPage.studyUI.series}" rendered="#{!empty studyPage.studyUI.series}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.seriesVersionLabel}" title="#{studybundle.seriesVersionHelpHeading} - #{studybundle.seriesVersionHelp}" rendered="#{studyPage.studyUI.studyVersionText != ''}"/>
                                <ice:outputText id="text17" value="#{studyPage.studyUI.studyVersionText}" rendered="#{!empty studyPage.studyUI.studyVersionText}"/>

                                <!--
                                  <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataverseOwnerLabel}" title="#{studybundle.dataverseOwnerHelpHeading} - #{studybundle.dataverseOwnerHelp}" rendered="#{studyPage.studyUI.study.owner.Id != VDCRequest.currentVDCId}}"/>
                                  <ice:outputLink value="/dvn/dv/#{studyPage.studyUI.study.owner.alias}" rendered="#{studyPage.studyUI.study.owner.Id != VDCRequest.currentVDCId}">
                                      <ice:outputText value="#{studyPage.studyUI.study.owner.name} Dataverse"/>
                                  </ice:outputLink>

                                  <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.harvestHoldingsLabel}" title="#{studybundle.harvestHoldingsHelpHeading} - #{studybundle.harvestHoldingsHelp}" rendered="#{!empty studyPage.studyUI.metadata.harvestHoldings and studyPage.studyUI.study.isHarvested}"/>
                                  <ice:outputLink value="#{studyPage.studyUI.metadata.harvestHoldings}" rendered="#{!empty studyPage.studyUI.metadata.harvestHoldings and studyPage.studyUI.study.isHarvested}">
                                      <ice:outputText value="#{studyPage.studyUI.metadata.harvestHoldings}"/>
                                  </ice:outputLink>
                                -->

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.originalDataverseLabel}" title="#{studybundle.originalDataverseHeading} - #{studybundle.originalDataverseHelp}"/>
                                <div jsfc="ice:panelGroup">
                                    <ice:outputLink value="#{studyPage.studyUI.metadata.harvestHoldings}" rendered="#{!empty studyPage.studyUI.metadata.harvestHoldings and studyPage.studyUI.study.isHarvested}">
                                        <ice:outputText value="Original Source > "/>
                                    </ice:outputLink>
                                    <ice:outputLink value="/dvn/dv/#{studyPage.studyUI.study.owner.alias}/faces/study/StudyPage.xhtml?studyId=#{studyPage.studyUI.study.id}&amp;versionNumber=#{studyPage.studyUI.studyVersion.versionNumber}">
                                        <ice:outputText value="#{studyPage.studyUI.study.owner.name} Dataverse"/>
                                    </ice:outputLink>
                                </div>
                            </ice:panelGrid>
                            <div jsfc="ice:panelGroup" id="groupPanel12" styleClass="vdcStudyInfoHeader" rendered="#{!studyPage.abstractAndScopePanelIsEmpty}">
                                <ice:outputText id="AbstractAndScopeText" value="Description and Scope"/>
                                <ice:commandButton id="commandButtonAbstractScopeContract"  image="/resources/images/icon_expand.gif" title="Hide fields in this section" rendered="#{studyPage.studyUI.abstractAndScopePanelIsRendered }" actionListener="#{studyPage.updateAbstractScopeDisplay}"/>
                                <ice:commandButton id="commandButtonAbstractScopeExpand" image="/resources/images/icon_contract.gif" title="Show fields in this section" rendered="#{!studyPage.studyUI.abstractAndScopePanelIsRendered }" actionListener="#{studyPage.updateAbstractScopeDisplay}"/>
                                <!--ice:outputText  value="(This section is empty)" rendered="#{studyPage.abstractAndScopePanelIsEmpty}" /-->
                            </div>
                            <ice:panelGrid binding="#{studyPage.abstractAndScopePanel}" cellpadding="0" cellspacing="0"
                                           columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" id="gridPanelAbstractAndScope" rendered="#{studyPage.studyUI.abstractAndScopePanelIsRendered}"  width="100%">

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.abstractLabel}" title="#{studybundle.abstractHelpHeading} - #{studybundle.abstractHelp}" rendered="#{studyPage.studyUI.abstracts != null and studyPage.studyUI.abstracts != ''}"/>
                                <ice:outputText id="text19" value="#{studyPage.studyUI.abstracts}" rendered="#{!empty studyPage.studyUI.abstracts }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.abstractDateLabel}" title="#{studybundle.abstractDateHelpHeading} - #{studybundle.abstractDateHelp}" rendered="#{studyPage.studyUI.abstractDates != null and studyPage.studyUI.abstractDates != ''}"/>
                                <ice:outputText id="text20" value="#{studyPage.studyUI.abstractDates}" rendered="#{!empty studyPage.studyUI.abstractDates }"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.keywordsLabel}" title="#{studybundle.keywordsHelpHeading} - #{studybundle.keywordsHelp}" rendered="#{studyPage.studyUI.keywords != ''}"/>
                                <ice:outputText id="text21" value="#{studyPage.studyUI.keywords}" rendered="#{!empty studyPage.studyUI.keywords}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.topicClassificationLabel}" title="#{studybundle.topicClassificationHelpHeading} - #{studybundle.topicClassificationHelp}" rendered="#{studyPage.studyUI.topicClasses != ''}"/>
                                <ice:outputText id="text22" value="#{studyPage.studyUI.topicClasses}" rendered="#{!empty studyPage.studyUI.topicClasses }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.relatedMaterialLabel}" title="#{studybundle.relatedMaterialHelpHeading} - #{studybundle.relatedMaterialHelp}" rendered="#{studyPage.studyUI.relMaterials != '' and studyPage.studyUI.relMaterials != null}"/>
                                <ice:outputText id="outputText150" value="#{studyPage.studyUI.relMaterials}" rendered="#{!empty studyPage.studyUI.relMaterials}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.relatedStudiesLabel}" title="#{studybundle.relatedStudiesHelpHeading} - #{studybundle.relatedStudiesHelp}" rendered="#{studyPage.studyUI.relStudies != '' and studyPage.studyUI.relStudies != null}"/>
                                <ice:outputText id="outputText152" value="#{studyPage.studyUI.relStudies}" rendered="#{!empty studyPage.studyUI.relStudies}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.otherReferencesLabel}" title="#{studybundle.otherReferencesHelpHeading} - #{studybundle.otherReferencesHelp}" rendered="#{studyPage.studyUI.otherRefs != '' and studyPage.studyUI.otherRefs != null}"/>
                                <ice:outputText id="outputText154" value="#{studyPage.studyUI.otherRefs}" rendered="#{!empty studyPage.studyUI.otherRefs}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.timePeriodCoveredLabel}" title="#{studybundle.timePeriodCoveredHelpHeading} - #{studybundle.timePeriodCoveredHelp}" rendered="#{studyPage.studyUI.timePeriodCovered != ''}"/>
                                <ice:outputText id="text24" value="#{studyPage.studyUI.timePeriodCovered}" rendered="#{!empty studyPage.studyUI.timePeriodCovered}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.collectionDateLabel}" title="#{studybundle.collectionDateHelpHeading} - #{studybundle.collectionDateHelp}" rendered="#{studyPage.studyUI.dateOfCollection != ''}"/>
                                <ice:outputText id="text25" value="#{studyPage.studyUI.dateOfCollection}" rendered="#{!empty studyPage.studyUI.dateOfCollection }"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.countryLabel}" title="#{studybundle.countryHelpHeading} - #{studybundle.countryHelp}" rendered="#{studyPage.studyUI.metadata.country != '' and studyPage.studyUI.metadata.country != null}"/>
                                <ice:outputText id="text26" value="#{studyPage.studyUI.metadata.country}" rendered="#{!empty studyPage.studyUI.metadata.country }"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.geographicCoverageLabel}" title="#{studybundle.geographicCoverageHelpHeading} - #{studybundle.geographicCoverageHelp}" rendered="#{studyPage.studyUI.metadata.geographicCoverage != '' and studyPage.studyUI.metadata.geographicCoverage!= null}"/>
                                <ice:outputText id="text27" value="#{studyPage.studyUI.metadata.geographicCoverage}" rendered="#{!empty studyPage.studyUI.metadata.geographicCoverage}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.geographicUnitLabel}" title="#{studybundle.geographicUnitHelpHeading} - #{studybundle.geographicUnitHelp}" rendered="#{studyPage.studyUI.metadata.geographicUnit != '' and studyPage.studyUI.metadata.geographicUnit != null}"/>
                                <ice:outputText id="text28" value="#{studyPage.studyUI.metadata.geographicUnit}" rendered="#{!empty studyPage.studyUI.metadata.geographicUnit}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.geographicBoundingLabel}" title="#{studybundle.geographicBoundingHelpHeading} - #{studybundle.geographicBoundingHelp}" rendered="#{studyPage.studyUI.geographicBoundings != '' and studyPage.studyUI.geographicBoundings != null}"/>
                                <ice:outputText id="text29" value="#{studyPage.studyUI.geographicBoundings}" rendered="#{!empty studyPage.studyUI.geographicBoundings}"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.unitOfAnalysisLabel}" title="#{studybundle.unitOfAnalysisHelpHeading} - #{studybundle.unitOfAnalysisHelp}" rendered="#{studyPage.studyUI.metadata.unitOfAnalysis != '' and studyPage.studyUI.metadata.unitOfAnalysis != null}"/>
                                <ice:outputText id="text30" value="#{studyPage.studyUI.metadata.unitOfAnalysis}" rendered="#{!empty studyPage.studyUI.metadata.unitOfAnalysis }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.universeLabel}" title="#{studybundle.universeHelpHeading} - #{studybundle.universeHelp}" rendered="#{studyPage.studyUI.metadata.universe != '' and studyPage.studyUI.metadata.universe != null}"/>
                                <ice:outputText id="text31" value="#{studyPage.studyUI.metadata.universe}" rendered="#{!empty studyPage.studyUI.metadata.universe}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.kindOfDataLabel}" title="#{studybundle.kindOfDataHelpHeading} - #{studybundle.kindOfDataHelp}" rendered="#{studyPage.studyUI.metadata.kindOfData != '' and studyPage.studyUI.metadata.kindOfData != null}"/>
                                <ice:outputText id="text32" value="#{studyPage.studyUI.metadata.kindOfData}" rendered="#{!empty studyPage.studyUI.metadata.kindOfData}"/>
                            </ice:panelGrid>
                            <div jsfc="ice:panelGroup" id="groupPanel13" styleClass="vdcStudyInfoHeader" rendered="#{!studyPage.dataCollectionIsEmpty || !studyPage.customDataCollectionIsEmpty}">
                                <ice:outputText id="outputText78" value="Data Collection / Methodology"/>
                                <ice:commandButton id="commandButtondataCollectionoContract" image="/resources/images/icon_expand.gif" title="Hide fields in this section" rendered="#{studyPage.studyUI.dataCollectionPanelIsRendered}" actionListener="#{studyPage.updateDataCollectionDisplay}"/>
                                <ice:commandButton id="commandButtondataCollectionExpand" image="/resources/images/icon_contract.gif" title="Show fields in this section" rendered="#{!studyPage.studyUI.dataCollectionPanelIsRendered}" actionListener="#{studyPage.updateDataCollectionDisplay}"/>
                            </div>
                            <ice:panelGroup rendered="#{studyPage.studyUI.dataCollectionPanelIsRendered}">
                                    <ui:repeat value="#{studyPage.studyUI.metadata.studyFields}"  var ="studyField" >
                                        <ice:panelGrid cellpadding="0" cellspacing="0" columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" width="100%"
                                                       rendered="#{!empty studyPage.studyUI.getStudyFieldValue(studyField)}">  
                                            <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studyField.title}" title="#{studyField.title} - #{studyField.description}"/>
                                            <ice:outputText value="#{studyPage.studyUI.getStudyFieldValue(studyField)}" escape="false"/>
                                        </ice:panelGrid>
                                    </ui:repeat>
                            </ice:panelGroup>
                            <ice:panelGrid binding="#{studyPage.dataCollectionPanel}" cellpadding="0" cellspacing="0"
                                           columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" id="gridPanelDataCollection"
                                           width="100%" rendered="#{studyPage.studyUI.dataCollectionPanelIsRendered}">                              
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.timeMethodLabel}" title="#{studybundle.timeMethodHelpHeading} - #{studybundle.timeMethodHelp}" rendered="#{studyPage.studyUI.metadata.timeMethod != '' and studyPage.studyUI.metadata.timeMethod != null}"/>
                                <ice:outputText id="text33" value="#{studyPage.studyUI.metadata.timeMethod}" rendered="#{!empty studyPage.studyUI.metadata.timeMethod}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataCollectorLabel}" title="#{studybundle.dataCollectorHelpHeading} - #{studybundle.dataCollectorHelp}" rendered="#{studyPage.studyUI.metadata.dataCollector != '' and studyPage.studyUI.metadata.dataCollector != null}"/>
                                <ice:outputText id="outputText77" value="#{studyPage.studyUI.metadata.dataCollector}" rendered="#{!empty studyPage.studyUI.metadata.dataCollector }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.frequencyOfDataCollectionLabel}" title="#{studybundle.frequencyHelpHeading} - #{studybundle.frequencyHelp}" rendered="#{studyPage.studyUI.metadata.frequencyOfDataCollection != '' and studyPage.studyUI.metadata.frequencyOfDataCollection != null}"/>
                                <ice:outputText id="outputText80" value="#{studyPage.studyUI.metadata.frequencyOfDataCollection}" rendered="#{!empty studyPage.studyUI.metadata.frequencyOfDataCollection}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.samplingProcedureLabel}" title="#{studybundle.samplingProcedureHelpHeading} - #{studybundle.samplingProcedureHelp}" rendered="#{studyPage.studyUI.metadata.samplingProcedure != '' and studyPage.studyUI.metadata.samplingProcedure != null}"/>
                                <ice:outputText id="outputText82" value="#{studyPage.studyUI.metadata.samplingProcedure}" rendered="#{!empty studyPage.studyUI.metadata.samplingProcedure}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.majorDeviationsLabel}" title="#{studybundle.majorDeviationsHelpHeading} - #{studybundle.majorDeviationsHelp}" rendered="#{studyPage.studyUI.metadata.deviationsFromSampleDesign != '' and studyPage.studyUI.metadata.deviationsFromSampleDesign != null}"/>
                                <ice:outputText id="outputText84" value="#{studyPage.studyUI.metadata.deviationsFromSampleDesign}" rendered="#{!empty studyPage.studyUI.metadata.deviationsFromSampleDesign }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.collectionModeLabel}" title="#{studybundle.collectionModeHelpHeading} - #{studybundle.collectionModeHelp}" rendered="#{studyPage.studyUI.metadata.collectionMode != '' and studyPage.studyUI.metadata.collectionMode != null}"/>
                                <ice:outputText id="outputText86" value="#{studyPage.studyUI.metadata.collectionMode}" rendered="#{!empty studyPage.studyUI.metadata.collectionMode}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.researchInstrumentLabel}" title="#{studybundle.researchInstrumentHelpHeading} - #{studybundle.researchInstrumentHelp}" rendered="#{studyPage.studyUI.metadata.researchInstrument != '' and studyPage.studyUI.metadata.researchInstrument != null}"/>
                                <ice:outputText id="outputText88" value="#{studyPage.studyUI.metadata.researchInstrument}" rendered="#{!empty studyPage.studyUI.metadata.researchInstrument}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataSourcesLabel}" title="#{studybundle.dataSourcesHelpHeading} - #{studybundle.dataSourcesHelp}" rendered="#{studyPage.studyUI.metadata.dataSources != '' and studyPage.studyUI.metadata.dataSources != null}"/>
                                <ice:outputText id="outputText90" value="#{studyPage.studyUI.metadata.dataSources}" rendered="#{!empty studyPage.studyUI.metadata.dataSources}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.originOfSourcesLabel}" title="#{studybundle.originOfSourcesHelpHeading} - #{studybundle.originOfSourcesHelp}" rendered="#{studyPage.studyUI.metadata.originOfSources != '' and studyPage.studyUI.metadata.originOfSources != null}"/>
                                <ice:outputText id="outputText92" value="#{studyPage.studyUI.metadata.originOfSources}" rendered="#{!empty studyPage.studyUI.metadata.originOfSources }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.sourceCharacteristicsLabel}" title="#{studybundle.sourceCharacteristicsHelpHeading} - #{studybundle.sourceCharacteristicsHelp}" rendered="#{studyPage.studyUI.metadata.characteristicOfSources != '' and studyPage.studyUI.metadata.characteristicOfSources != null}"/>
                                <ice:outputText id="outputText94" value="#{studyPage.studyUI.metadata.characteristicOfSources}" rendered="#{!empty studyPage.studyUI.metadata.characteristicOfSources}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.sourceDocumentationLabel}" title="#{studybundle.sourceDocumentationHelpHeading} - #{studybundle.sourceDocumentationHelp}" rendered="#{studyPage.studyUI.metadata.accessToSources != '' and studyPage.studyUI.metadata.accessToSources != null}"/>
                                <ice:outputText id="outputText96" value="#{studyPage.studyUI.metadata.accessToSources}" rendered="#{!empty studyPage.studyUI.metadata.accessToSources}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataCollectionCharacteristicsLabel}" title="#{studybundle.dataCollectionCharacteristicsHelpHeading} - #{studybundle.dataCollectionCharacteristicsHelp}" rendered="#{studyPage.studyUI.metadata.dataCollectionSituation != '' and studyPage.studyUI.metadata.dataCollectionSituation != null}"/>
                                <ice:outputText id="outputText98" value="#{studyPage.studyUI.metadata.dataCollectionSituation}" rendered="#{!empty studyPage.studyUI.metadata.dataCollectionSituation}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.minimizeActionsLabel}" title="#{studybundle.minimizeActionsHelpHeading} - #{studybundle.minimizeActionsHelp}" rendered="#{studyPage.studyUI.metadata.actionsToMinimizeLoss != '' and studyPage.studyUI.metadata.actionsToMinimizeLoss != null}"/>
                                <ice:outputText id="outputText100" value="#{studyPage.studyUI.metadata.actionsToMinimizeLoss}" rendered="#{!empty studyPage.studyUI.metadata.actionsToMinimizeLoss}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.controlOperationsLabel}" title="#{studybundle.controlOperationsHelpHeading} - #{studybundle.controlOperationsHelp}" rendered="#{studyPage.studyUI.metadata.controlOperations != '' and studyPage.studyUI.metadata.controlOperations != null}"/>
                                <ice:outputText id="outputText102" value="#{studyPage.studyUI.metadata.controlOperations}" rendered="#{!empty studyPage.studyUI.metadata.controlOperations}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.weightingLabel}" title="#{studybundle.weightingHelpHeading} - #{studybundle.weightingHelp}" rendered="#{studyPage.studyUI.metadata.weighting != '' and studyPage.studyUI.metadata.weighting != null}"/>
                                <ice:outputText id="outputText104" value="#{studyPage.studyUI.metadata.weighting}" rendered="#{!empty studyPage.studyUI.metadata.weighting}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.cleaningOperationsLabel}" title="#{studybundle.cleaningOperationsHelpHeading} - #{studybundle.cleaningOperationsHelp}" rendered="#{studyPage.studyUI.metadata.cleaningOperations != '' and studyPage.studyUI.metadata.cleaningOperations != null}"/>
                                <ice:outputText id="outputText106" value="#{studyPage.studyUI.metadata.cleaningOperations}" rendered="#{!empty studyPage.studyUI.metadata.cleaningOperations}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.studyLevelErrorNotesLabel}" title="#{studybundle.studyLevelErrorNotesHelpHeading} - #{studybundle.studyLevelErrorNotesHelp}" rendered="#{studyPage.studyUI.metadata.studyLevelErrorNotes != '' and studyPage.studyUI.metadata.studyLevelErrorNotes != null}"/>
                                <ice:outputText id="outputText108" value="#{studyPage.studyUI.metadata.studyLevelErrorNotes}" rendered="#{!empty studyPage.studyUI.metadata.studyLevelErrorNotes}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.responseRateLabel}" title="#{studybundle.responseRateHelpHeading} - #{studybundle.responseRateHelp}" rendered="#{studyPage.studyUI.metadata.responseRate != '' and studyPage.studyUI.metadata.responseRate != null}"/>
                                <ice:outputText id="outputText110" value="#{studyPage.studyUI.metadata.responseRate}" rendered="#{!empty studyPage.studyUI.metadata.responseRate}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.samplingErrorLabel}" title="#{studybundle.samplingErrorHelpHeading} - #{studybundle.samplingErrorHelp}" rendered="#{studyPage.studyUI.metadata.samplingErrorEstimate != '' and studyPage.studyUI.metadata.samplingErrorEstimate != null}"/>
                                <ice:outputText id="outputText112" value="#{studyPage.studyUI.metadata.samplingErrorEstimate}" rendered="#{!empty studyPage.studyUI.metadata.samplingErrorEstimate}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.otherDataAppraisalLabel}" title="#{studybundle.otherDataAppraisalHelpHeading} - #{studybundle.otherDataAppraisalHelp}" rendered="#{studyPage.studyUI.metadata.otherDataAppraisal != '' and studyPage.studyUI.metadata.otherDataAppraisal != null}"/>
                                <ice:outputText id="outputText114" value="#{studyPage.studyUI.metadata.otherDataAppraisal}" rendered="#{!empty studyPage.studyUI.metadata.otherDataAppraisal}" escape="false"/>
                            </ice:panelGrid>
                            <div jsfc="ice:panelGroup" id="groupPanel14a" styleClass="vdcStudyInfoHeader" rendered="#{!studyPage.dataAvailIsEmpty}">
                                <ice:outputText id="outputText115a" value="Data Availability"/>
                                <ice:commandButton id="commandButtonDataAvailContract" image="/resources/images/icon_expand.gif" title="Hide fields in this section" rendered="#{studyPage.studyUI.dataAvailPanelIsRendered}" actionListener="#{studyPage.updateDataAvailDisplay}"/>
                                <ice:commandButton id="commandButtonDataAvailExpand" image="/resources/images/icon_contract.gif" title="Show fields in this section" rendered="#{!studyPage.studyUI.dataAvailPanelIsRendered}" actionListener="#{studyPage.updateDataAvailDisplay}"/>
                            </div>
                            <ice:panelGrid binding="#{studyPage.dataAvailPanel}" cellpadding="0" cellspacing="0"
                                           columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" id="gridPanelDataAvail" rendered="#{studyPage.studyUI.dataAvailPanelIsRendered}"
                                           width="100%">
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataAccessPlaceLabel}" title="#{studybundle.dataAccessPlaceHelpHeading} - #{studybundle.dataAccessPlaceHelp}" rendered="#{studyPage.studyUI.metadata.placeOfAccess != '' and studyPage.studyUI.metadata.placeOfAccess != null}"/>
                                <ice:outputText id="outputText117" value="#{studyPage.studyUI.metadata.placeOfAccess}" rendered="#{!empty studyPage.studyUI.metadata.placeOfAccess}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.originalArchiveLabel}" title="#{studybundle.originalArchiveHelpHeading} - #{studybundle.originalArchiveHelp}" rendered="#{studyPage.studyUI.metadata.originalArchive != '' and studyPage.studyUI.metadata.originalArchive != null}"/>
                                <ice:outputText id="outputText119" value="#{studyPage.studyUI.metadata.originalArchive}" rendered="#{!empty studyPage.studyUI.metadata.originalArchive}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.availabilityLabel}" title="#{studybundle.availabilityHelpHeading} - #{studybundle.availabilityHelp}" rendered="#{studyPage.studyUI.metadata.availabilityStatus != '' and studyPage.studyUI.metadata.availabilityStatus != null}"/>
                                <ice:outputText id="outputText121" value="#{studyPage.studyUI.metadata.availabilityStatus}" rendered="#{!empty studyPage.studyUI.metadata.availabilityStatus}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.collectionSizeLabel}" title="#{studybundle.collectionSizeHelpHeading} - #{studybundle.collectionSizeHelp}" rendered="#{studyPage.studyUI.metadata.collectionSize != '' and studyPage.studyUI.metadata.collectionSize != null}"/>
                                <ice:outputText id="outputText123" value="#{studyPage.studyUI.metadata.collectionSize}" rendered="#{!empty studyPage.studyUI.metadata.collectionSize}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.studyCompletionLabel}" title="#{studybundle.studyCompletionHelpHeading} - #{studybundle.studyCompletionHelp}" rendered="#{studyPage.studyUI.metadata.studyCompletion != '' and studyPage.studyUI.metadata.studyCompletion != null}"/>
                                <ice:outputText id="outputText125" value="#{studyPage.studyUI.metadata.studyCompletion}" rendered="#{!empty studyPage.studyUI.metadata.studyCompletion != '' and studyPage.studyUI.metadata.studyCompletion != null }" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.numberOfFilesLabel}" title="#{studybundle.numberOfFilesHelpHeading} - #{studybundle.numberOfFilesHelp}" rendered="#{studyPage.studyUI.studyVersion.numberOfFiles != '' and studyPage.studyUI.studyVersion.numberOfFiles != null}"/>
                                <ice:outputText id="outputText127" value="#{studyPage.studyUI.studyVersion.numberOfFiles}" rendered="#{!empty studyPage.studyUI.studyVersion.numberOfFiles}" escape="false"/>
                            </ice:panelGrid>
                            <div jsfc="ice:panelGroup" id="groupPanel14b" styleClass="vdcStudyInfoHeader" rendered="#{!studyPage.termsOfUseIsEmpty}">
                                <a name="termsofuse"><!--TERMS OF USE--></a>
                                <ice:outputText id="outputText115" value="Terms of Use"/>
                                <ice:commandButton id="commandButtonTermsOfUseContract" image="/resources/images/icon_expand.gif" title="Hide fields in this section" rendered="#{studyPage.studyUI.termsOfUsePanelIsRendered}" actionListener="#{studyPage.updateTermsOfUseDisplay}"/>
                                <ice:commandButton id="commandButtonTermsOfUseExpand" image="/resources/images/icon_contract.gif" title="Show fields in this section" rendered="#{!studyPage.studyUI.termsOfUsePanelIsRendered}" actionListener="#{studyPage.updateTermsOfUseDisplay}"/>
                            </div>

                            <ice:panelGrid binding="#{studyPage.termsOfUsePanel}" cellpadding="0" cellspacing="0"
                                           columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" id="gridPanelTermsOfUse" rendered="#{studyPage.studyUI.termsOfUsePanelIsRendered}"
                                           width="100%">
                                <!-- Study Terms of Use -->
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.confidentialityLabel}" title="#{studybundle.confidentialityHelpHeading} - #{studybundle.confidentialityHelp}" rendered="#{studyPage.studyUI.metadata.confidentialityDeclaration != '' and studyPage.studyUI.metadata.confidentialityDeclaration != null}"/>
                                <ice:outputText id="outputText129" value="#{studyPage.studyUI.metadata.confidentialityDeclaration}" rendered="#{!empty studyPage.studyUI.metadata.confidentialityDeclaration}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.specialPermissionsLabel}" title="#{studybundle.specialPermissionsHelpHeading} - #{studybundle.specialPermissionsHelp}" rendered="#{studyPage.studyUI.metadata.specialPermissions != '' and studyPage.studyUI.metadata.specialPermissions != null}"/>
                                <ice:outputText id="outputText131" value="#{studyPage.studyUI.metadata.specialPermissions}" rendered="#{!empty studyPage.studyUI.metadata.specialPermissions}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.restrictionsLabel}" title="#{studybundle.restrictionsHelpHeading} - #{studybundle.restrictionsHelp}" rendered="#{studyPage.studyUI.metadata.restrictions != '' and studyPage.studyUI.metadata.restrictions != null}"/>
                                <ice:outputText id="outputText133" value="#{studyPage.studyUI.metadata.restrictions}" rendered="#{!empty studyPage.studyUI.metadata.restrictions}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.contactLabel}" title="#{studybundle.contactHelpHeading} - #{studybundle.contactHelp}" rendered="#{studyPage.studyUI.metadata.contact != '' and studyPage.studyUI.metadata.contact != null}"/>
                                <ice:outputText id="outputText135" value="#{studyPage.studyUI.metadata.contact}" rendered="#{!empty studyPage.studyUI.metadata.contact}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.citationRequirementsLabel}" title="#{studybundle.citationRequirementsHelpHeading} - #{studybundle.citationRequirementsHelp}" rendered="#{studyPage.studyUI.metadata.citationRequirements != '' and studyPage.studyUI.metadata.citationRequirements != null}"/>
                                <ice:outputText id="outputText137" value="#{studyPage.studyUI.metadata.citationRequirements}" rendered="#{!empty studyPage.studyUI.metadata.citationRequirements}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.depositorRequirementsLabel}" title="#{studybundle.depositorRequirementsHelpHeading} - #{studybundle.depositorRequirementsHelp}" rendered="#{studyPage.studyUI.metadata.depositorRequirements != '' and studyPage.studyUI.metadata.depositorRequirements != null}"/>
                                <ice:outputText id="outputText139" value="#{studyPage.studyUI.metadata.depositorRequirements}" rendered="#{!empty studyPage.studyUI.metadata.depositorRequirements}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.conditionsLabel}" title="#{studybundle.conditionsHelpHeading} - #{studybundle.conditionsHelp}" rendered="#{studyPage.studyUI.metadata.conditions != '' and studyPage.studyUI.metadata.conditions != null}"/>
                                <ice:outputText id="outputText141" value="#{studyPage.studyUI.metadata.conditions}" rendered="#{!empty studyPage.studyUI.metadata.conditions}" escape="false"/>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.disclaimerLabel}" title="#{studybundle.disclaimerHelpHeading} - #{studybundle.disclaimerHelp}" rendered="#{studyPage.studyUI.metadata.disclaimer != '' and studyPage.studyUI.metadata.disclaimer != null}"/>
                                <ice:outputText id="outputText143" value="#{studyPage.studyUI.metadata.disclaimer}" rendered="#{!empty studyPage.studyUI.metadata.disclaimer}" escape="false"/>

                                <!-- Dataverse, Dataverse Network and Harvest Terms of Use -->
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.dataverseTermsofUseLabel}" title="#{studybundle.dataverseTermsofUseHelpHeading} - #{studybundle.dataverseTermsofUseHelp}" rendered="#{!empty studyPage.studyUI.dataverseTermsOfUse}"/>
                                <div jsfc="ice:panelGroup" rendered="#{!empty studyPage.studyUI.dataverseTermsOfUse}">
                                    <div jsfc="ice:panelGroup">
                                        <ice:outputLink value="#" onclick="return toggleTermsofUse(this)">
                                            <ice:outputText value="View Terms of Use [+]"/>
                                        </ice:outputLink>
                                        <div style="display:none;">
                                            <ice:outputText value="#{studyPage.studyUI.dataverseTermsOfUse}" escape="false" style="display:block"/>
                                        </div>
                                    </div>
                                </div>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.networkTermsofUseLabel}" title="#{studybundle.networkTermsofUseHelpHeading} - #{studybundle.networkTermsofUseHelp}" rendered="#{VDCRequest.vdcNetwork.downloadTermsOfUseEnabled}"/>
                                <div jsfc="ice:panelGroup" rendered="#{VDCRequest.vdcNetwork.downloadTermsOfUseEnabled}">
                                    <div jsfc="ice:panelGroup">
                                        <ice:outputLink value="#" onclick="return toggleTermsofUse(this)">
                                            <ice:outputText value="View Terms of Use [+]"/>
                                        </ice:outputLink>
                                        <div style="display:none;">
                                            <ice:outputText value="#{VDCRequest.vdcNetwork.downloadTermsOfUse}" escape="false" style="display:block"/>
                                        </div>
                                    </div>
                                </div>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.harvestedTermsofUseLabel}" title="#{studybundle.harvestedTermsofUseHelpHeading} - #{studybundle.harvestedTermsofUseHelp}" rendered="#{!empty studyPage.studyUI.metadata.harvestDVTermsOfUse}"/>
                                <div jsfc="ice:panelGroup" rendered="#{!empty studyPage.studyUI.metadata.harvestDVTermsOfUse}">
                                    <div jsfc="ice:panelGroup">
                                        <ice:outputLink value="#" onclick="return toggleTermsofUse(this)">
                                            <ice:outputText value="View Terms of Use [+]"/>
                                        </ice:outputLink>
                                        <div style="display:none;">
                                            <ice:outputText value="#{studyPage.studyUI.metadata.harvestDVTermsOfUse}" escape="false" style="display:block"/>
                                        </div>
                                    </div>
                                </div>

                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.networkHarvestedTermsofUseLabel}" title="#{studybundle.networkHarvestedTermsofUseHelpHeading} - #{studybundle.harvestedTermsofUseHelp}" rendered="#{!empty studyPage.studyUI.metadata.harvestDVNTermsOfUse}"/>
                                <div jsfc="ice:panelGroup" rendered="#{!empty studyPage.studyUI.metadata.harvestDVNTermsOfUse}">
                                    <div jsfc="ice:panelGroup">
                                        <ice:outputLink value="#" onclick="return toggleTermsofUse(this)">
                                            <ice:outputText value="View Terms of Use [+]"/>
                                        </ice:outputLink>
                                        <div style="display:none;">
                                            <ice:outputText value="#{studyPage.studyUI.metadata.harvestDVNTermsOfUse}" escape="false" style="display:block"/>
                                        </div>
                                    </div>
                                </div>

                            </ice:panelGrid>
                            <div jsfc="ice:panelGroup" id="groupPanel15" styleClass="vdcStudyInfoHeader" rendered="#{!studyPage.notesIsEmpty}">
                                <ice:outputText id="outputText144" value="Other Information"/>
                                <ice:commandButton id="commandButtonNotesContract" image="/resources/images/icon_expand.gif" title="Hide fields in this section" rendered="#{studyPage.studyUI.notesPanelIsRendered}" actionListener="#{studyPage.updateNotesDisplay}"/>
                                <ice:commandButton id="commandButtonNotesExpand" image="/resources/images/icon_contract.gif" title="Show fields in this section" rendered="#{!studyPage.studyUI.notesPanelIsRendered}" actionListener="#{studyPage.updateNotesDisplay}"/>
                            </div>
                            <ice:panelGrid  binding="#{studyPage.notesPanel}" cellpadding="0" cellspacing="0"
                                            columnClasses="vdcStudyInfoCol1, vdcStudyInfoCol2" columns="2" id="gridPanelNotes" rendered="#{studyPage.studyUI.notesPanelIsRendered}"
                                            width="100%">
                                <ice:outputText styleClass="dvnInlineHelpLabel dvnInlineHelpTip" value="#{studybundle.notesLabel}" title="#{studybundle.notesHelpHeading} - #{studybundle.notesHelp}" rendered="#{studyPage.studyUI.notes != ''}"/>
                                <ice:outputText id="outputText146" value="#{studyPage.studyUI.notes}" rendered="#{!empty studyPage.studyUI.notes}" escape="false"/>
                            </ice:panelGrid>
                            <!--
                            <div jsfc="ice:panelGroup" id="groupPanel3" styleClass="vdcStudyInfoDownload" rendered="false">
                                <ice:outputLink id="hyperlink2" value="http://www.sun.com/jscreator">
                                    <ice:outputText id="hyperlink2Text" value="Download the complete cataloging information in XML format (without variables)"/>
                                </ice:outputLink>
                            </div>
                            <div jsfc="ice:panelGroup" id="groupPanel2" styleClass="vdcStudyInfoDownload" rendered="false">
                                <ice:outputLink id="hyperlink1" value="http://www.sun.com/jscreator">
                                    <ice:outputText id="hyperlink1Text" value="Download the complete cataloging information in XML format (with variables)"/>
                                </ice:outputLink>
                            </div>
                            -->
                            <div jsfc="ice:panelGroup" id="groupPanel16" styleClass="dvn_padTop" rendered="#{!empty studyPage.apiMetadataUrl}">
                                <div jsfc="ice:panelGroup" id="groupPanel17" styleClass="dvn_padBot">
                                    <ice:graphicImage value="/resources/images/icon_info.gif" styleClass="dvn_icon"/>
                                    <ice:outputText value=" Download the cataloging information in XML format  -"/>
                                    
                                    <ice:outputLink value="#{studyPage.apiMetadataUrlWithoutDataSection}" rendered="#{!empty studyPage.apiMetadataUrlWithoutDataSection}">
                                        <ice:outputText value=" DDI (without variables)"/>
                                    </ice:outputLink>
                                    
                                    <ice:outputText value=" /" rendered="#{!empty studyPage.apiMetadataUrlWithoutDataSection}"/>
                                    
                                    <ice:outputLink value="#{studyPage.apiMetadataUrl}">
                                        <ice:outputText value=" DDI (full)"/>
                                    </ice:outputLink>
                                </div>
                            </div>
                        </div>
                    </ice:panelTab>
                    <!-- FILES -->
                    <ice:panelTab id="files" label="Data &amp; Analysis">
                        <f:param name="tab" value="files"/>
                        <ui:include src="StudyFilesFragment.xhtml">
                        </ui:include>
                    </ice:panelTab>
                    <!-- Study comments -->
                    <ice:panelTab id="comments" label="Comments (#{StudyCommentsFragment.studyCommentsCount})" rendered="#{studyPage.allowStudyComments}">
                        <ui:include src="StudyCommentsFragment.xhtml">
                        </ui:include>
                    </ice:panelTab>
                    <!-- end study comments -->
                    <ice:panelTab id="versions" label="Versions">
                        <ui:include src="StudyVersionsFragment.xhtml">
                        </ui:include>
                    </ice:panelTab>
                </ice:panelTabSet>
            </div>
        </div>
      </ice:form>

    <!-- Deacessioned study! -->
    <ui:include src="StudyDeaccessionedFragment.xhtml"/>
 
    </ui:define>
  </ui:composition>
</body>
</html>
